var dtArchiveMrf={dtInstance:null,pageDetails:function(){return $(".content-header h1").text("MRF"),$(".content-header h1").append("<small>Archive</small>"),this},render:function(t,e){return this.dtInstance=$("#dtArchiveMrf").DataTable({dom:"Blrtip",ordering:!1,autoWidth:!1,lengthMenu:[[10,25,50,-1],[10,25,50,"All"]],serverSide:!0,processing:!0,language:{processing:'<i class="fa fa-spinner fa-pulse fa-2x fa-fw"></i><span class="sr-only">Please wait - loading...</span>',infoEmpty:"No entries to show"},destroy:!0,responsive:!0,buttons:[{text:'<i class="fa fa-refresh" aria-hidden="true"></i>',tag:"a",className:"btn-refresh-mrf",action:function(t,e,a,r){self.dtArchiveMrf.dtInstance.ajax.reload(null,!0)}},{text:"Open Search Filter",className:"btn-search-archivemrf",action:function(t,e,a,r){$("#dthead-search-archivemrf").slideToggle("fast",function(){$(this).is(":visible")?a[0].innerText="Close Search Filter":(a[0].innerText="Open Search Filter",$("#dt-head-search input[type='text']").val(""),self.dtArchiveMrf.dtInstance.ajax.reload(null,!0))})}}],ajax:{url:assets+"php/mrf/getMachineRequestList.php",type:"GET",dataSrc:"records",data:function(t){t.form_no=$("#search-mrf-formno").val()||"",t.company=$("#search-mrf-company").val()||"",t.date_requested=$("#search-mrf-dateRequest").val()||"",t.date_delivery=$("#search-mrf-dateDelivery").val()||"",t.status=$("#search-mrf-status option:selected").val()||"",t.date_status=$("#search-mrf-date").val()||"",t.action_view="archive",t.id_user=Cookies.get("user_id"),t.id_branch=$("#archive-mrf-branchlist option:selected").val()}},columns:[{data:null,render:function(t,e,a,r){return r.row+1}},{data:null,render:function(t,e,a,r){return"<span class='text-center'>"+t.form_no+"</span>"}},{data:null,render:function(t,e,a,r){return"<span class='text-center'>"+t.company_name+"</span>"}},{data:null,render:function(t,e,a,r){return"<span class='text-center'>"+t.date_requested+"</span>"}},{data:null,render:function(t,e,a,r){return"<span class='text-center'>"+t.delivery_date+"</span>"}},{data:null,render:function(t,e,a,r){return"<span class='text-center'>"+t.requested_by+"</span>"}},{data:null,render:function(t,e,a,r){return"<span class='text-center'>"+t.branch_name+"</span>"}},{data:null,render:function(t,e,a,r){var n="",o=t.status.toUpperCase()||"";return"COMPLETE"==o?(n="badge-blue",o="APPROVED"):"DISAPPROVED"==o?n="badge-red":"CANCELLED"==o&&(n="badge-orange"),"<span class='badge "+n+"'>"+o+"</span>"}},{data:null,render:function(t,e,a,r){var n="",o=[1,43],s=null!=t.id_user_from?convertArrStrToInt(t.id_user_from):null;return n='<div class="col-md-4"><a title="View Request" class="btn btn-info btn-xs btn-flat btn-view-mrf" data-mrf="'+t.id+'"" data-toggle="modal" data-target="#modalFormArchiveViewMrf">VIEW</a></div>',n+='<div class="col-md-4"><button title="Comments" class="btn '+(t.no_received_message>0&&null!=s&&(s.indexOf(o[0])>=0||s.indexOf(o[1])>=0)?"btn-danger":t.no_received_message>0&&null!=s&&(-1==s.indexOf(o[0])||-1==s.indexOf(o[1]))?"btn-warning":"btn-info")+' btn-xs btn-flat btn-comment-mrf" data-mrf="'+t.id+'"" data-toggle="modal" data-target="#modalArchiveComments">COMMENTS</button></div>'}}],columnDefs:[{responsivePriority:1,target:0},{responsivePriority:2,target:1}],preDrawCallback:function(t){$(".btn-search-archivemrf, .btn-refresh-mrf").removeClass("dt-button").addClass("btn btn-primary btn-flat btn-sm").css({"margin-bottom":"0.5em","margin-right":"0.5em"})}}),this.dtInstance.button(".btn-refresh-mrf").nodes().attr("title","Refresh"),this},modalShow:function(){return $("#displayViewStepDetails").load(pages+"mrf/archive/view-request-form.html",function(){$(this).find("#modalFormArchiveViewMrf").on("hidden.bs.modal",function(){$(this).find("#frmCurrentViewMrf").trigger("reset"),$(this).find("#frmCurrentViewMrf input[type='hidden'], #frmViewAttachment input[type='hidden']").val(""),$(this).find("#tbl_view_frm_component_1 tbody tr, #tbl_view_frm_component_2 tbody tr").not(".view-loader").remove(),$(this).find("#tab-form-approve table tfoot, #tab-form-approve table > tfoot button").hide()}),$(this).find("#modalArchiveViewToner").on("hidden.bs.modal",function(){$("body").addClass("modal-open"),$("#tbl_view_s1_toner tbody tr").remove()})}),$("#modalArchiveComments").on("hidden.bs.modal",function(){$(this).find("#frmArchiveComment").trigger("reset"),$(this).find("#frmArchiveComment input[type='hidden']").val(""),$(".comment-box").empty()}),this},selectBranch:function(t,e){var a=null;if("approver"==t||"preparer"==t||"requestor,preparer"==t){a=function(t){var e;return $.ajax({type:"POST",url:assets+"php/mrf/misc/getBranchApprover.php",data:{id_user:t},async:!1,success:function(t){e=t.aaData[0].id_branch}}),e?convertArrStrToInt(e.split(",")):null}(Cookies.get("user_id"))}else a=convertArrStrToInt(Cookies.get("branch_mrf").split(","));return autoDrpDownMrf.getBranch("#archive-mrf-branchlist",!1,a,null,!0,!0),$("select#archive-mrf-branchlist").change(function(){dtArchiveMrf.dtInstance.ajax.reload()}),this},getDataViewRequestForm:function(t){if(""!=t&&void 0!=t){var e,a;$.ajax({type:"POST",url:assets+"php/mrf/mrf.php",data:{action:"view-toner-details",id_mrf:t},dataType:"json",cache:!1,beforeSend:function(){e=" ",a=" ",$(".view-loader").show()},success:function(t,r,n){var o=t.aaData[0],s="<tr ><td colspan='6'><div class='text-center'><span class='label label-info text-center'>No data available in table.</span></div></td></tr>";$(".post-list-attachment").html(fileUpload.postListFiles(o.attachment,!1)),$("#hdnIdCurrentViewMrf").val(o.id),$("#hdnIdBranchCurrentViewMrf").val(o.id_branch),$(".form-no #form-code").text(o.form_no),$("#requestedBy span").text(o.requested_by);var l=0;o.res_row_data_s1.length>0?$.each(o.res_row_data_s1,function(t,a){l=a.s1_quantity>0?a.s1_quantity:a.s1_serialnum.split(",").length,e+="<tr data-mrf-s1="+a.id+' class="parentRow">',e+='<td rowspan="3" class="first">'+(t+1)+"</td><td>"+l+"</td><td>"+a.brand_name+"</td><td>"+a.model_name+"</td><td>"+a.bn_rf+"</td><td>"+a.s1_accessories+"</td>",e+="</tr>",e+='<tr class="subRowSerial">',e+=self.dtArchiveMrf.buildSubRowSerial(a.s1_serialnum?a.s1_serialnum.split(","):0),e+="</tr>",e+="<tr><td colspan='8'><table class='subTableStyle'><thead><tr><th colspan='8'>Toner</th></tr><tr><th>Quantity</th><th>Mono/Colored</th><th>Toner Model</th><th>Unit Price</th><th>Yield</th><th>Total</th><th>Type</th><th>Rate</th></tr></thead><tbody>",o.res_row_data_s1_toner[a.id]?$.each(o.res_row_data_s1_toner[a.id],function(t,a){e+="<tr>",e+="<td>"+a.s1_toner_qty+"</td><td>"+a.type_name+"</td><td>"+a.s1_toner_model+"</td><td>"+a.s1_toner_price+"</td><td>"+a.s1_toner_yield+"</td><td>"+a.s1_toner_total+"</td><td>"+a.s1_billing_type+"</td><td>"+a.s1_toner_rate+"</td>",e+="</tr>"}):(e+="<tr>",e+='<td colspan="8"><div class="text-center"><span class="label label-info">No data available in table.</span></div></td>',e+="</tr>"),e+="</tbody></table></td></tr>"}):e+=s,$("#tbl_view_frm_component_1 tbody").append(e);var d=o.s2_radio_id;d>0&&($(".view-step-2 input[type=radio][value='"+d+"'").prop("checked",!0),o.s2_radio_nodays>0&&3==d?$("#no_of_days").text(o.s2_radio_nodays).show():$("#no_of_days").hide(),""!=o.s2_radio_others&&4==d?$("#view_others").text(o.s2_radio_others).show():$("#view_others").hide()),o.res_row_data_s2.length>0?$.each(o.res_row_data_s2,function(t,e){a+="<tr>",a+="<td>"+e.brand_name+"</td><td>"+e.model_name+"</td><td>"+e.s2_serialnum+"</td><td>"+e.s2_contact_p+"</td><td>"+e.s2_dept_branch+"</td>",a+="</tr>"}):a+=s,$("#tbl_view_frm_component_2 tbody").append(a),o.s3_id_purpose>0&&$(".view-step-3 input[type=radio][value='"+o.s3_id_purpose+"'").prop("checked",!0),$(".view-step-4 #dateRequest").text(o.date_requested),$(".view-step-4 #dateDelivery").text(o.date_delivery),$(".view-step-4 #txtCompany").text(o.company_name),$(".view-step-4 #txtShipTo").text(o.ship_to),$(".view-step-4 #txtBillTo").text(o.bill_to),$(".view-step-4 #txtContactPerson").text(o.contact_person),$(".view-step-4 #txtDepartment").text(o.department),$(".view-step-4 #txtTelNo").text(o.tel_no);var i=Cookies.get("user_id"),c=Cookies.get("user_type");if($.each(o.is_approver[0],function(t,e){e==i?($("#tab-form-approve table .tfoot_"+t).show(),$("#tab-form-approve table tfoot button[name="+t+"]").show(),5==c?$(".container-edit-sn").show():$(".container-edit-sn").hide()):$("#tab-form-approve table tfoot button[name="+t+"]").hide()}),o.user_approved.length>0){var p=[];$.each(o.user_approved,function(t,e){""!=e["1st_approver"]&&p.push("#tab-form-approve table > tfoot button[name=1st_approver]"),""!=e["2nd_approver"]&&p.push("#tab-form-approve table > tfoot button[name=2nd_approver], #tab-form-approve table > tfoot button[name=2nd_approver_2]"),""!=e["3rd_approver"]&&p.push("#tab-form-approve table > tfoot button[name=3rd_approver]"),""!=e["4th_approver"]&&p.push("#tab-form-approve table > tfoot button[name=4th_approver]"),""!=e["5th_approver"]&&p.push("#tab-form-approve table > tfoot button[name=5th_approver]"),$("#1st_approve_name").text(e["1st_approver"]),$("#1st_approve_date").text(e["1st_date"]),$("#2nd_approve_name").text(e["2nd_approver"]),$("#2nd_approve_date").text(e["2nd_date"]),$("#3rd_approve_name").text(e["3rd_approver"]),$("#3rd_approve_date").text(e["3rd_date"]),$("#4th_approve_name").text(e["4th_approver"]),$("#4th_approve_date").text(e["4th_date"]),$("#4th_dr_number").val(e["4th_dr_number"]),$("#4th_edr_number").val(e["4th_edr_number"]),$("#4th_inv_number").val(e["4th_inv_number"]),$("#5th_approve_name").text(e["5th_approver"]),$("#5th_approve_date").text(e["5th_date"]),$("#5th_delivery_date").val(e["5th_delivery_date"]),$("#5th_received_by").val(e["5th_received_by"]),$("#5th_delivered_by").val(e["5th_delivered_by"])}),p.length>0&&$(p.join(",")).hide()}Cookies.get("user_type")>1&&$(".attachment-upload-container").remove();var u="";o.res_row_data_s1.length>0?$.each(o.res_row_data_s1,function(t,e){u+="<tr data-id-edit-sn="+e.id+">",u+="<td>"+e.brand_name+"</td><td>"+e.model_name+'</td><td><input type="text" class="mrf-material frm-s1 s1_serialnum" name="s1_serialnum" value="'+e.s1_serialnum+'"></td>',u+="</tr>"}):u+=s,$("#edit-table-sn tbody").html(u)},complete:function(){$(".view-loader").hide()},error:function(t,e){alert("Something went wrong!")}})}else alert("ID is empty");return this},getTonerDetails:function(t){var e=" ",a=null;return a=$(t).closest("tr").data("toner-values"),e=" ",void 0!=a&&null!=a&&""!=a?$.each(a,function(t,a){e+="<tr>",e+="<td>"+a.s1_toner_qty+"</td><td>"+a.type_name+"</td><td>"+a.s1_toner_model+"</td><td>"+a.s1_toner_price+"</td><td>"+a.s1_toner_yield+"</td>",e+="</tr>"}):e+="<tr ><td colspan='6'><div class='text-center'><span class='label label-info text-center'>No data available in table.</span></div></td></tr>",$("#tbl_view_s1_toner tbody").append(e),this},actions:function(){return $("#archiveMrfList").on("click","button, a",function(t){t.preventDefault();var e=$(this),a=e.text().toLowerCase();if(e.closest("tr").hasClass("selected")||(self.dtArchiveMrf.dtInstance.$("tr.selected").removeClass("selected"),e.closest("tr").addClass("selected")),"search"==a&&self.dtArchiveMrf.dtInstance.ajax.reload(null,!0),"reset"==a&&($("#dthead-search-archivemrf input[type='text'], #dthead-search-archivemrf select").val(""),self.dtArchiveMrf.dtInstance.ajax.reload(null,!0)),"view"==a){var r=$(this).data("mrf");self.dtArchiveMrf.getDataViewRequestForm(r)}if("comments"==a){var n=$(this).data("mrf"),o=Cookies.get("user_id");comment.display(n,o)}}),this},buildSubRowSerial:function(t){var e=t;if(t.length>0){var a,r=[],n=0;for(n=0,j=e.length;n<j;n++)n%5==0&&(a&&r.push(a),a=[]),a.push(e[n]);a&&r.push(a);var o=document.createElement("table"),s=document.createElement("tbody"),l=document.createElement("thead"),d=document.createElement("th"),i=document.createElement("tr");return o.className="subTableStyle",d.appendChild(document.createTextNode("Serial Numbers")),d.setAttribute("colspan",5),i.appendChild(d),l.appendChild(i),o.appendChild(l),r.forEach(function(t,e){var a=document.createElement("tr");for(var r in t){var n=document.createElement("td"),o=document.createTextNode(t[r]);n.appendChild(o),a.appendChild(n)}s.appendChild(a)}),o.appendChild(s),"<td colspan='8'><div>"+o.outerHTML+"</div></td>"}return""}},comment={auto_refresh:null,display:function(t,e){var a;t?$.ajax({type:"POST",dataType:"json",url:assets+"php/mrf/comments.php",data:{action:"view-id",id_mrf:t},beforeSend:function(){$(".comment-box").empty()},success:function(t){a="",t.aaData.length>0?$.each(t.aaData,function(t,r){r.id_user_from!=e?a+="<div class='comment-msg left clearFix'><div class='comment-date'>"+r.date_sent+'</div><div class="comments-text-box"><span class="comment-name">'+r.from_name+'</span>: <span class="comments-text">'+r.comments+"</span></div></div>":a+="<div class='comment-msg right clearFix'><div class='comment-date'>"+r.date_sent+'</div><div class="comments-text-box"><span class="comments-text">'+r.comments+'</span> :<span class="comment-name">ME</span></div></div>'}):a="<h5>No messages send.</h5>",$(".comment-box").html(a)}}):alert("ID is not exist")},send:function(t){var e=$("#txtComment").val()||"",a=Cookies.get("user_id"),r=$("#btnCommentSubmit, #btnCommentClear");null!=t&&""!=e?$.ajax({type:"POST",dataType:"json",url:assets+"php/mrf/comments.php",data:{action:"add",id_mrf:t,id_user:a,comments:e},beforeSend:function(){r.button("loading")},success:function(e){"success"==e.aaData[0]&&(self.comment.display(t),$("#txtComment").val(""))},complete:function(){r.button("reset")}}):alert("ID / message text is required.")}},dtCurrentMrf={dtInstance:null,selectedBranch:null,tableValuesDeleteS1:[],tableValuesDeleteS2:[],tableValuesDeleteToner:[],pageDetails:function(){return $(".content-header h1").text("MRF"),$(".content-header h1").append("<small>Current</small>"),this},tableAddRow:function(t){return"object"!=typeof t&&null==t&&void 0==t?(console.error("Argument must be object and non-empty."),!1):($(t.elemBtnAdd).click(function(e){var a=document.getElementById(t.elemTable),r=a.querySelector("tbody"),n=r.rows.length+1,o=a.rows[0].cells.length;if($(r).find("[data-row-num^='parentRow']").length+1<=5){var s=r.insertRow(-1);s.setAttribute("data-row-num","parentRow-"+randomNum());r.insertRow(-1).className="subRowSerial";r.insertRow(-1).className="subRow";for(var l=0,d="",i="";l<o;l++)cell=s.insertCell(l),void 0!=t.customCell&&null!=t.customCell&&(l==t.customCell[l].cellNo&&"default"==t.customCell[l].elem?(d=t.customCell[l].idElem,i=t.customCell[l].attr,cell.innerHTML='<input type="text" class="mrf-material '+d+'" id= "'+d+'" name= "'+d+'" '+i+" />"):(void 0!=t.customCell[l].elem&&t.customCell[l].elem instanceof Function&&(cell.innerHTML=t.customCell[l].elem(n)),void 0!=t.customCell[l].elem&&"string"==typeof t.customCell[l].elem&&(cell.innerHTML=t.customCell[l].elem),void 0!=t.customCell[l].callBack&&t.customCell[l].callBack instanceof Function&&t.customCell[l].callBack(t.customCell[l].idElem)))}else alert("Maximum of five(5) rows can add.")}),$("#"+t.elemTable).on("click",".delete_row",function(e){e.preventDefault();var a=$(this).closest("tr"),r=a.attr("data-row-num");a.fadeOut(400,function(){1==t.deleleteSubRow&&$("#"+t.elemTable+" tbody tr[data-row-num^='"+r+"']").nextAll(":lt(2)").fadeOut(400,function(){$(this).remove()}),$(this).remove()})}),this)},render:function(t,e,a){return this.dtInstance=$("#dtCurrentMrf").DataTable({dom:"Blrtip",ordering:!1,autoWidth:!1,lengthMenu:[[10,25,50,-1],[10,25,50,"All"]],pageLength:25,serverSide:!0,processing:!0,language:{processing:'<i class="fa fa-spinner fa-pulse fa-2x fa-fw"></i><span class="sr-only">Please wait - loading...</span>',infoEmpty:"No entries to show"},destroy:!0,responsive:!0,buttons:[{text:'<i class="fa fa-refresh" aria-hidden="true"></i>',tag:"a",className:"btn-refresh-mrf",action:function(t,e,a,r){self.dtCurrentMrf.dtInstance.ajax.reload(null,!0)}},{text:"Add Request Form",tag:"a",className:"btn-add-mrf",action:function(t,e,a,r){$("#modalFormCurrentMrf .modal-title").text("Add Machine Request"),$("#modalFormCurrentMrf #dateRequest").val(getTodayDateStandard()),$("#btn_cancel, #download").hide(),$("table tbody tr").each(function(){$(this).removeAttr("data-mrf-s1 data-mrf-s2")}),$("#tbl_frm_component_1 tbody").append('<tr class="subRowSerial first-subRow"></tr><tr class="subRow first-subRow"></tr>')}},{text:"Open Search Filter",className:"btn-search-mrf",action:function(t,e,a,r){$("#dthead-search-mrf").slideToggle("fast",function(){$(this).is(":visible")?a[0].innerText="Close Search Filter":(a[0].innerText="Open Search Filter",$("#dt-head-search input[type='text'], #search-for-approver").val(""),dtCurrentMrf.dtInstance.ajax.reload(null,!0))})}}],ajax:{url:assets+"php/mrf/getMachineRequestList.php",type:"GET",dataSrc:"records",data:function(t){t.form_no=$("#search-mrf-formno").val()||"",t.company=$("#search-mrf-company").val()||"",t.date_requested=$("#search-mrf-dateRequest").val()||"",t.requested_by=$("#search-mrf-requestedBy").val()||"",t.status=$("#search-for-approver option:selected").val()||"",t.action_view="current",t.id_user=Cookies.get("user_id"),t.id_branch=$("#current-mrf-branchlist option:selected").val()}},columns:[{data:null,render:function(t,e,a,r){return r.row+1}},{data:null,render:function(t,e,a,r){return"<span class='text-center'>"+t.form_no+"</span>"}},{data:null,render:function(t,e,a,r){return"<span class='text-center'>"+t.company_name+"</span>"}},{data:null,render:function(t,e,a,r){var n=t.date_requested.split(" ");return"<span class='text-center'>"+("00:00:00"==n[1]?n[0]:t.date_requested)+"</span>"}},{data:null,render:function(t,e,a,r){return"<span class='text-center'>"+t.requested_by+"</span>"}},{data:null,render:function(t,e,a,r){return"<span class='text-center'>"+t.branch_name+"</span>"}},{data:null,render:function(t,e,a,r){return"<span class='badge badge-orange'>"+t.age+"</span>"}},{data:null,render:function(t,e,a,r){var n="";return"<span class='badge "+(n=t.status_approval.split("|"))[1]+"'>"+n[0]+"</span>"}},{data:null,render:function(t,e,a,r){var n="",o=Cookies.get("user_mrf_flag"),s=[1,43],l=null!=t.id_user_from?convertArrStrToInt(t.id_user_from):null;return n+="requestor"==o?'<div class="col-md-4"><a title="Edit Request" class="btn btn-success btn-xs btn-flat btn-edit-mrf" data-mrf="'+t.id+'"" data-toggle="modal" data-target="#modalFormCurrentMrf">EDIT</a></div>':'<div class="col-md-4"><a title="View Request" class="btn btn-info btn-xs btn-flat btn-view-mrf" data-mrf="'+t.id+'"" data-toggle="modal" data-target="#modalFormCurrentViewMrf">VIEW</a></div>',n+='<div class="col-md-4"><button title="Comments" class="btn '+(t.no_received_message>0&&null!=l&&(l.indexOf(s[0])>=0||l.indexOf(s[1])>=0)?"btn-danger":t.no_received_message>0&&null!=l&&(-1==l.indexOf(s[0])||-1==l.indexOf(s[1]))?"btn-warning":"btn-info")+' btn-xs btn-flat btn-comment-mrf" data-mrf="'+t.id+'"" data-toggle="modal" data-target="#modalComments">COMMENTS</button></div>'}}],columnDefs:[{responsivePriority:1,target:0},{responsivePriority:2,target:1}],preDrawCallback:function(t){$(".btn-search-mrf, .btn-add-mrf, .btn-refresh-mrf").removeClass("dt-button").addClass("btn btn-primary btn-flat btn-sm").css({"margin-bottom":"0.5em","margin-right":"0.5em"})},fnDrawCallback:function(){this.api();$(".btn-add-mrf").attr("data-toggle","modal"),$(".btn-add-mrf").attr("data-target","#modalFormCurrentMrf"),"approver"!=a&&"preparer"!=a||$(".btn-add-mrf").remove();var t=JSON.parse(Cookies.get("app_module_action"));null==t?$(".btn-edit-mrf, .btn-comment-mrf, .btn-add-mrf").remove():"r"==t.action_mrf&&$(".btn-edit-mrf, .btn-comment-mrf, .btn-add-mrf").remove()}}),this.dtInstance.button(".btn-refresh-mrf").nodes().attr("title","Refresh"),this},modalShow:function(t){return"requestor"==t&&$("#displayFormMrfEntry").load(pages+"mrf/current/form.html",function(){var t={elemTable:"tbl_frm_component_1",elemBtnAdd:"#btn_add_row_s1",deleleteSubRow:!0,customCell:[{cellNo:0,elem:'<input type="text" id="s1_quantity" disabled="disabled" class="s1_quantity mrf-material frm-s1 not-full-width" name="s1_quantity"/>'},{cellNo:1,elem:function(){if(0!=autoDrpDown.cacheOptBrands.length)return $('<select id="s1_brand"  class="form-control s1_brand frm-s1 chosen-select" data-s1-brand-row="'+arguments[0]+'" name="s1_brand"></select>').html(autoDrpDown.cacheOptBrands[0].join(""))[0].outerHTML},callBack:function(){0!=autoDrpDown.cacheOptBrands.length&&($(arguments[0]).chosen({no_results_text:"No records found.",width:"100%",search_contains:!0}),self.dtCurrentMrf.showModelByBrand(".s1_brand","s1-brand-row",".s1_model_row_"))},idElem:".s1_brand"},{cellNo:1,elem:function(){if(0!=autoDrpDownInvnt.cacheOptModel.length)return $('<select id="s1_id_model"  class="mrf-material s1_id_model frm-s1 chosen-select s1_model_row_'+arguments[0]+'" name="s1_id_model"></select>').html(autoDrpDownInvnt.cacheOptModel[0].join(""))[0].outerHTML},callBack:function(){0!=autoDrpDownInvnt.cacheOptModel.length&&$(arguments[0]).chosen({no_results_text:"No records found.",width:"100%",search_contains:!0})},idElem:".s1_id_model"},{cellNo:3,elem:'<select id="s1_bn_rf" class="mrf-material s1_bn_rf frm-s1" name="s1_bn_rf"><option value="">---</option><option value="1">Brand New (BN)</option><option value="2">Refurbished (RF)</option></select>'},{cellNo:4,elem:"default",idElem:"s1_accessories"},{cellNo:5,elem:'<button type="button" onClick="dtCurrentMrf.getTrIndexSerial(this)" class="btn btn-flat btn-success btn-xs btn_s1_add_toner" title="Add Serial Number" data-toggle="modal" data-target="#modalS1Serial">+</button><input type="hidden" id="s1_serialnum" class="s1_serialnum mrf-material frm-s1 validate-hidden-text" name="s1_serialnum" value=""/> '},{cellNo:6,elem:'<button type="button" onClick="dtCurrentMrf.getTrIndex(this)" class="btn btn-flat btn-success btn-xs btn_s1_add_toner" title="Add Toner" data-toggle="modal" data-target="#modalS1Toner">+</button><input type="hidden" id="s1_toner" class="s1_toner validate-hidden-text" name="s1_toner" value=""/> '},{cellNo:7,elem:'<button type="button" title="Delete" class="btn btn-flat btn-danger btn-xs delete_row ">X</button>'}]},e={elemTable:"tbl_frm_component_2",elemBtnAdd:"#btn_add_row_s2",customCell:[{cellNo:0,elem:function(){if(0!=autoDrpDown.cacheOptBrands.length)return $('<select id="s2_id_brand"  class="form-control s2_id_brand frm-s1 chosen-select" data-s2-brand-row="'+arguments[0]+'" name="s2_id_brand"></select>').html(autoDrpDown.cacheOptBrands[0].join(""))[0].outerHTML},callBack:function(){0!=autoDrpDown.cacheOptBrands.length&&($(arguments[0]).chosen({no_results_text:"No records found.",width:"100%",search_contains:!0}),self.dtCurrentMrf.showModelByBrand(".s2_id_brand","s2-brand-row",".s2_model_row_"))},idElem:".s2_id_brand"},{cellNo:1,elem:function(){if(0!=autoDrpDownInvnt.cacheOptModel.length)return $('<select id="s2_id_model"  class="mrf-material s2_id_model frm-s1 chosen-select s2_model_row_'+arguments[0]+'" name="s2_id_model"></select>').html(autoDrpDownInvnt.cacheOptModel[0].join(""))[0].outerHTML},callBack:function(){0!=autoDrpDownInvnt.cacheOptModel.length&&$(arguments[0]).chosen({no_results_text:"No records found.",width:"100%",search_contains:!0})},idElem:".s2_id_model"},{cellNo:2,elem:"default",idElem:"s2_serialnum"},{cellNo:3,elem:"default",idElem:"s2_contact_p"},{cellNo:4,elem:"default",idElem:"s2_dept_branch"},{cellNo:5,elem:'<button type="button" title="Delete" class="btn btn-flat btn-danger btn-xs delete_row ">X</button>'}]};self.dtCurrentMrf.tableAddRow(t),self.dtCurrentMrf.tableAddRow({elemTable:"tbl_frm_s1_toner",elemBtnAdd:"#btn_add_row_s1_toner",customCell:[{cellNo:0,elem:'<input type="text" class="mrf-material s1_toner_qty" name="s1_toner_qty" onkeyup="dtCurrentMrf.autoComputeTonerTotal(this)">'},{cellNo:1,elem:'<select  class="mrf-material frm-s1 s1_toner_monocolor" name="s1_toner_monocolor"><option value="">---</option><option value="1">Mono</option><option value="2">Color</option></select>'},{cellNo:2,elem:'<input type="text" class="mrf-material s1_toner_model"  name="s1_toner_model">'},{cellNo:3,elem:'<input type="text" class="mrf-material s1_toner_price" name="s1_toner_price" onkeyup="dtCurrentMrf.autoComputeTonerTotal(this)">'},{cellNo:4,elem:'<input type="text" class="mrf-material s1_toner_yield" name="s1_toner_yield">'},{cellNo:5,elem:'<input type="text" class="mrf-material s1_toner_total" name="s1_toner_total" disabled="disabled">'},{cellNo:6,elem:'<select class="mrf-material frm-s1 s1_toner_type" name="s1_toner_type"><option value="">---</option><option value="1">Outright</option><option value="2">Meter Reading</option><option value="3">Fixed Monthly</option></select>'},{cellNo:7,elem:"default",idElem:"s1_toner_rate"},{cellNo:8,elem:'<button type="button" title="Delete" class="btn btn-flat btn-danger btn-xs delete_row ">X</button>'}]}),self.dtCurrentMrf.tableAddRow(e),self.dtCurrentMrf.autoComplete().update_cancel(),self.dtCurrentMrf.showModelByBrand(".s1_brand","s1-brand-row",".s1_model_row_"),self.dtCurrentMrf.showModelByBrand(".s2_id_brand","s2-brand-row",".s2_model_row_"),self.dtCurrentMrf.getTableRowDeleteId({elemTable:"#tbl_frm_component_1",attrTr:"mrf-s1"}),self.dtCurrentMrf.getTableRowDeleteId({elemTable:"#tbl_frm_component_2",attrTr:"mrf-s2"}),self.dtCurrentMrf.getTableRowDeleteId({elemTable:"#tbl_frm_s1_toner",attrTr:"mrf-s1-toner"}),$(this).find("#dateDelivery").inputmask(),$(".radioBtn-group-c2").on("change",function(){3==$(this).val()?$("#txtDemoRental").prop("disabled",!1).focus():$("#txtDemoRental").val("").prop("disabled",!0),4==$(this).val()?$("#txtOthers").prop("disabled",!1).focus():$("#txtOthers").val("").prop("disabled",!0)}),autoDrpDown.getBrandName("#s1_brand",!0),autoDrpDownInvnt.getModelByBrand("#s1_id_model",!0),autoDrpDown.getBrandName("#s2_id_brand",!0),autoDrpDownInvnt.getModelByBrand("#s2_id_model",!0),autoDrpDownMrf.getBranch("#slctBranchRequest",!1,convertArrStrToInt(Cookies.get("branch_mrf")),null,!0,!1),$(this).find("#modalFormCurrentMrf").on("hidden.bs.modal",function(){$(this).find("#frmCurrentMrf").trigger("reset"),$(this).find("#frmCurrentMrf input[type='hidden']").val(""),$(this).find("#txtCompany").attr("data-value",0),$(this).find("#s1_brand, #s1_id_model, #s2_id_brand, #s2_id_model").val("").trigger("chosen:updated"),$(this).find("input, select").parents(".col-sm-6").removeClass("has-error has-success"),$(this).find("em.help-block").remove(),$(this).find("#tbl_frm_component_1 tbody tr, #tbl_frm_component_2 tbody tr").not(".not-tr").remove(),$(this).find("#tbl_frm_component_1 tbody tr.first-subRow").empty(),navigateForm(0,!0),$("#tbl_frm_component_1, #tbl_frm_component_2, #tbl_frm_s1_toner").removeData("del-id"),$("#tbl_frm_component_1 tbody tr").eq(0).removeData("toner-values"),self.dtCurrentMrf.tableValuesDeleteS1.length=0,self.dtCurrentMrf.tableValuesDeleteS2.length=0,self.dtCurrentMrf.tableValuesDeleteToner.length=0,$("#slctBranchRequest").prop("disabled",!1),$(this).find("#form-code").text(""),$(this).find(".pre-list-attachment, .post-list-attachment").html("")}),$(this).find("#modalS1Toner").on("hidden.bs.modal",function(){$("body").addClass("modal-open"),$(this).find("#frmS1Toner").trigger("reset"),$(this).find("#frmS1Toner input[type='hidden']").val(""),$(this).find("em.help-block").remove(),$(this).find("#tbl_frm_s1_toner tbody tr").eq(0).removeAttr("data-mrf-s1-toner"),$("#tbl_frm_s1_toner tbody tr").remove(),$(this).find("#frmS1Toner #grandTotal").text("----")}),$(this).find("#modalS1Serial").on("hidden.bs.modal",function(){$("body").addClass("modal-open"),$(this).find("#frmS1Serial").trigger("reset"),$(this).find("#frmS1Serial input[type='hidden']").val(""),$(this).find("#frmS1Serial #newSerialFields").empty()})}),"approver"==t&&$("#displayViewStepDetails").load(pages+"mrf/current/view-request-form.html",function(){$(this).find("#modalFormCurrentViewMrf").on("hidden.bs.modal",function(){$(this).find("#frmCurrentViewMrf").trigger("reset"),$(this).find("#frmCurrentViewMrf input[type='hidden'], #frmViewAttachment input[type='hidden']").val(""),$("#tbl_view_frm_component_1 tbody tr, #tbl_view_frm_component_2 tbody tr").not(".view-loader").remove(),$("#tab-form-approve table tfoot, #tab-form-approve table > tfoot button").hide(),$(this).find(".pre-list-attachment").html("")}),$(this).find("#modalS1ViewToner").on("hidden.bs.modal",function(){$("body").addClass("modal-open"),$("#tbl_view_s1_toner tbody tr").remove()})}),$("#displayComments").load(pages+"mrf/current/comments.html",function(){var t=null;$(this).find("#modalComments").on("shown.bs.modal",function(){var e=Cookies.get("user_id"),a=$("#hdnIdMRF").val();t=setInterval(function(){comment.display(a,e)},5e3)}),$(this).find("#modalComments").on("hidden.bs.modal",function(){$(this).find("#frmComment").trigger("reset"),$(this).find("#frmComment input[type='hidden']").val(""),$(".comment-box").empty(),clearInterval(t)})}),this},selectBranch:function(t,e){var a=null;if("approver"==t||"preparer"==t||"requestor,preparer"==t){a=function(t){var e;return $.ajax({type:"POST",url:assets+"php/mrf/misc/getBranchApprover.php",data:{id_user:t},async:!1,success:function(t){e=t.aaData[0].id_branch}}),e?convertArrStrToInt(e.split(",")):null}(Cookies.get("user_id"))}else a=convertArrStrToInt(Cookies.get("branch_mrf").split(","));return autoDrpDownMrf.getBranch("#current-mrf-branchlist",!1,a,null,!0,!0),$("select#current-mrf-branchlist").change(function(){dtCurrentMrf.dtInstance.ajax.reload()}),this},add:function(t){var e=$(".btn_submit, .btn_next"),a=getTableRowValue({elemTable:"#tbl_frm_component_1",selectorInput:"input, select",trAttr:"mrf-s1",inputElem:[{name:"s1_quantity",getValueByChosen:!1},{name:"s1_brand",getValueByChosen:!0},{name:"s1_id_model",getValueByChosen:!0},{name:"s1_bn_rf",getValueByChosen:!1},{name:"s1_serialnum",getValueByChosen:!1},{name:"s1_accessories",getValueByChosen:!1}]}),r=getTableRowArbitraryValue({elemTable:"#tbl_frm_component_1",trAttrToner:"toner-values"}),n=getTableRowValue({elemTable:"#tbl_frm_component_2",selectorInput:"input, select",trAttr:"mrf-s2",inputElem:[{name:"s2_id_brand",getValueByChosen:!0},{name:"s2_id_model",getValueByChosen:!0},{name:"s2_serialnum",getValueByChosen:!1},{name:"s2_contact_p",getValueByChosen:!1},{name:"s2_dept_branch",getValueByChosen:!1}]}),o=$(".radioBtn-group-c2:checked").val()||0,s=$("#txtDemoRental").val()||0,l=$("#txtOthers").val()||"",d=$(".radioBtn-group-c3:checked").val()||0,i=$("#form-code").text(),c=$("#dateRequest").val(),p=$("#txtCompany").attr("data-value"),u=$("#txtShipTo").val(),m=$("#txtBillTo").val(),_=$("#txtContactPerson").val(),f=$("#txtDepartment").val(),h=$("#txtTelNo").val(),b=Cookies.get("user_id"),v=Cookies.get("branch_mrf"),y=Cookies.get("email"),g=Cookies.get("fullname"),w=$("#attachment")[0].files;return fileUpload.upload(w,{action:"add_files"},function(){var w=arguments[0].attachment_status||"",x=arguments[0].attachment_message||"";if("true"==w){var C=arguments[0].attachment_uploaded||"",M={action:"add",s1_row_data:a.insert,s1_row_toner_data:r,s2_row_data:removeEmptyObjectInArray(n.insert,"s2_id_brand"),s2_radio_id:o,form_no:i,email:y,fullname:g,s2_radio_nodays:s,s2_radio_others:l,s3_id_purpose:d,date_request:c,id_company:p,ship_to:u,bill_to:m,contact_p:_,dept:f,tel_no:h,id_user_requestor:b,branch:v,attachment_name:C};$.ajax({type:"POST",url:assets+"php/mrf/mrf.php",data:M,dataType:"json",beforeSend:function(){e.button("loading")},success:function(e,a,r){"success"==e.aaData[0]&&(promptMSG("success-add","Machine Request",null,null,!0,!0),t(),self.dtCurrentMrf.dtInstance.ajax.reload(null,!1))},error:function(t,e){alert("Something went wrong!")},complete:function(t,a){e.button("reset")}})}else alert(x)}),this},update:function(t,e){var a=$("button[type='submit'], .btn_cancel, .btn_next"),r=$("#hdnIdCurrentMrf").val(),n=getTableRowValue({getTrTonerAttr:!0,elemTable:"#tbl_frm_component_1",selectorInput:"input, select",trAttr:"mrf-s1",inputElem:[{name:"s1_bn_rf",getValueByChosen:!1},{name:"s1_quantity",getValueByChosen:!1},{name:"s1_brand",getValueByChosen:!0},{name:"s1_id_model",getValueByChosen:!0},{name:"s1_serialnum",getValueByChosen:!1},{name:"s1_accessories",getValueByChosen:!1}]}),o=getTableRowValue({elemTable:"#tbl_frm_component_2",selectorInput:"input, select",trAttr:"mrf-s2",inputElem:[{name:"s2_id_brand",getValueByChosen:!0},{name:"s2_id_model",getValueByChosen:!0},{name:"s2_serialnum",getValueByChosen:!1},{name:"s2_contact_p",getValueByChosen:!1},{name:"s2_dept_branch",getValueByChosen:!1}]},"s2_serialnum"),s=$("#tbl_frm_s1_toner").data("del-id"),l=$("#tbl_frm_component_1").data("del-id"),d=$("#tbl_frm_component_2").data("del-id"),i=$(".radioBtn-group-c2:checked").val()||0,c=$("#txtDemoRental").val()||0,p=$("#txtOthers").val()||"",u=$(".radioBtn-group-c3:checked").val()||0,m=$("#txtCompany").attr("data-value"),_=$("#txtShipTo").val(),f=$("#txtBillTo").val(),h=$("#txtContactPerson").val(),b=$("#txtDepartment").val(),v=$("#txtTelNo").val(),y=$("#attachment")[0].files,g=$(".hdnAttachmentName").val()||"";return fileUpload.upload(y,{action:"update_files",file_name:g},function(){var y=arguments[0].attachment_status||"",w=arguments[0].attachment_message||"";if("true"==y){var x=arguments[0].attachment_uploaded||g,C={action:"update",id_mrf:r,s1_row_data:n,s1_row_del_data:l,s2_row_data:o,s2_row_del_data:d,s1_row_toner_del_data:s,s2_radio_id:i,s2_radio_nodays:c,s2_radio_others:p,id_company:m,ship_to:_,bill_to:f,s3_id_purpose:u,contact_p:h,dept:b,tel_no:v,attachment_name:x};""!=t?$.ajax({type:"POST",url:assets+"php/mrf/mrf.php",data:C,dataType:"json",beforeSend:function(){a.button("loading")},success:function(t,a,r){promptMSG("success-update","Machine Request",null,null,!0,!0),e(),self.dtCurrentMrf.dtInstance.ajax.reload(null,!1)},error:function(t,e){alert("Something went wrong!")},complete:function(){a.button("reset")}}):alert("ID is empty")}else alert(w)}),this},getData:function(t,e){if(""!=t&&void 0!=t){var a=$("#btn_add_row_s1, #btn_next, .btn_submit, #btn_cancel"),r="",n="";$.ajax({type:"POST",url:assets+"php/mrf/mrf.php",data:{action:"view-id",id_mrf:t},dataType:"json",cache:!1,beforeSend:function(){a.button("loading"),1==e&&void 0!=e&&($("#tbl_frm_component_1 tbody tr, #tbl_frm_component_2 tbody tr").not(".not-tr").remove(),$("#tbl_frm_component_1 input, #tbl_frm_component_2 input").not(":hidden").val(""))},success:function(t,e,a){var o=t.aaData[0],s=function(t){var e="";return $.each(autoDrpDown.cacheOptBrands[0],function(a,r){$(r).attr("value")==t&&(e+=$(r).attr("selected","selected")[0].outerHTML),e+=r}),e},l=function(t){var e="";return $.each(autoDrpDownInvnt.cacheOptModel[0],function(a,r){$(r).attr("value")==t&&(e+=$(r).attr("selected","selected")[0].outerHTML),e+=r}),e};$("#hdnIdCurrentMrf").val(o.id),$(".hdnAttachmentName").val(o.attachment),$(".form-no #form-code").text(o.form_no),$(".post-list-attachment").html(fileUpload.postListFiles(o.attachment,!0)),$.each(o.res_row_data_s1,function(t,e){0==t?($("#tbl_frm_component_1 tbody tr").eq(0).attr("data-mrf-s1",e.id),$("#s1_quantity").val(e.s1_quantity),$("#s1_brand").val(e.s1_id_brand).trigger("chosen:updated"),$("#s1_id_model").val(e.s1_id_model).trigger("chosen:updated"),$("#s1_bn_rf").val(e.s1_bn_rf),$("#s1_serialnum").val(e.s1_serialnum),$("#s1_accessories").val(e.s1_accessories)):(r+="<tr data-mrf-s1="+e.id+" data-row-num='parentRow-"+randomNum()+"'>",r+='<td><input type="text" id="s1_quantity" disabled="disabled" class="s1_quantity mrf-material frm-s1 not-full-width" value="'+e.s1_quantity+'" name="s1_quantity" style="width: 50px" /></td><td><select id="s1_brand" class="s1_brand frm-s1 chosen-select" name="s1_brand" data-s1-brand-row='+(t+1)+">"+s(e.s1_id_brand)+'</select></td><td><select id="s1_id_model" class="s1_id_model frm-s1 chosen-select s1_model_row_'+(t+1)+'" name="s1_id_model" >'+l(e.s1_id_model)+'</select></td><td><select id="s1_bn_rf" class="mrf-material s1_bn_rf frm-s1" name="s1_bn_rf"><option value="">---</option><option value="1" '+(1==e.s1_bn_rf?"selected":"")+'>Brand New (BN)</option><option value="2" '+(2==e.s1_bn_rf?"selected":"")+'>Refurbished (RF)</option></select></td><td><input type="text" class="mrf-material" id="s1_accessories" name="s1_accessories" value="'+e.s1_accessories+'"></td><td><button type="button" onClick="dtCurrentMrf.getTrIndexSerial(this)" class="btn btn-flat btn-success btn-xs btn_s1_add_toner" title="Add Serial Number" data-toggle="modal" data-target="#modalS1Serial">+</button><input type="hidden" id="s1_serialnum" class="s1_serialnum mrf-material frm-s1 validate-hidden-text" name="s1_serialnum" value="'+e.s1_serialnum+'"/> </td><td><button type="button" onClick="dtCurrentMrf.getTrIndex(this)" class="btn btn-flat btn-success btn-xs btn_s1_add_toner" title="Add Toner" data-toggle="modal" data-target="#modalS1Toner">+</button><input type="hidden" id="s1_toner" class="s1_toner validate-hidden-text" name="s1_toner" value=""/></td><td><button type="button" title="Delete" class="btn btn-flat btn-danger btn-xs delete_row">X</button></td>',r+="</tr>"),r+='<tr class="subRowSerial">',r+=self.dtCurrentMrf.buildSubRowSerial(e.s1_serialnum?e.s1_serialnum.split(","):0),r+="</tr>",r+="<tr class='subRow'><td colspan='8'><table class='subTableStyle'><thead><tr><th colspan='8'>Toner</th></tr><tr><th>Quantity</th><th>Mono/Colored</th><th>Toner Model</th><th>Unit Price</th><th>Yield</th><th>Total</th><th>Type</th><th>Rate</th></tr></thead><tbody>",null!=o.res_row_data_s1_toner&&$.each(o.res_row_data_s1_toner_sub[e.id],function(t,e){r+="<tr>",r+="<td>"+e.s1_toner_qty+"</td><td>"+e.type_name+"</td><td>"+e.s1_toner_model+"</td><td>"+e.s1_toner_price+"</td><td>"+e.s1_toner_yield+"</td><td>"+e.s1_toner_total+'</td><td class="capitalizeText">'+e.s1_billing_type+"</td><td>"+e.s1_toner_rate+"</td>",r+="</tr>"}),r+="</tbody></table></td></tr>"});document.querySelector("#tbl_frm_component_1 tbody tr.not-tr").insertAdjacentHTML("afterend",r);if($.each(o.res_row_data_s1_toner,function(t,e){var a={update:{},insert:[]};$("#tbl_frm_component_1 tbody tr").each(function(r,n){var o=$(this).attr("data-mrf-s1");t==o&&(a.update=e,$(this).data("toner-values",a),$(this).find(".s1_toner").val(jQuery.isEmptyObject(e)?"":1))})}),o.res_row_data_s2.length>0){$.each(o.res_row_data_s2,function(t,e){0==t?($("#tbl_frm_component_2 tbody tr").eq(0).attr("data-mrf-s2",e.s2_id),$(".s2_id_brand").val(e.s2_id_brand).trigger("chosen:updated"),$(".s2_id_model").val(e.s2_id_model).trigger("chosen:updated"),$(".s2_serialnum").val(e.s2_serialnum),$(".s2_contact_p").val(e.s2_contact_p),$(".s2_dept_branch").val(e.s2_dept_branch)):(n+="<tr data-mrf-s2="+e.s2_id+" data-row-num='parentRow-"+randomNum()+"'>",n+='<td><select id="s2_id_brand" class="s2_id_brand frm-s1 chosen-select" name="s2_id_brand" data-s2-brand-row='+(t+1)+">"+s(e.s2_id_brand)+'</select></td><td><select id="s2_id_model" class="s2_id_model frm-s1 chosen-select s2_model_row_'+(t+1)+'" name="s2_id_model">'+l(e.s2_id_model)+'</select></td><td><input type="text" class="mrf-material" id="s2_serialnum" name="s2_serialnum" value="'+e.s2_serialnum+'"></td><td><input type="text" class="mrf-material" id="s2_contact_p" name="s2_contact_p" value="'+e.s2_contact_p+'"></td><td><input type="text" class="mrf-material" id="s2_dept_branch" name="s2_dept_branch" value="'+e.s2_dept_branch+'"></td><td><button type="button" title="Delete" class="btn btn-flat btn-danger btn-xs delete_row">X</button></td>',n+="</tr>")});document.querySelector("#tbl_frm_component_2 tbody tr.not-tr").insertAdjacentHTML("afterend",n)}var d=o.s2_radio_id;d>0&&($(".form-component-2 .section-one input[type=radio][value='"+d+"'").prop("checked",!0),parseInt(o.s2_radio_nodays,10)>0&&3==d?$("#txtDemoRental").val(o.s2_radio_nodays).prop("disabled",!1):$("#txtDemoRental").prop("disabled",!0),""!=o.s2_radio_others&&4==d?$("#txtOthers").val(o.s2_radio_others).prop("disabled",!1):$("#txtOthers").prop("disabled",!0)),o.s3_id_purpose>0&&$(".form-component-2 .section-two input[type=radio][value='"+o.s3_id_purpose+"'").prop("checked",!0),$("#dateRequest").val(o.date_requested),$("#txtCompany").val(o.company_name).attr("data-value",o.id_company),$("#txtShipTo").val(o.ship_to),$("#txtBillTo").val(o.bill_to),$("#txtContactPerson").val(o.contact_person),$("#txtDepartment").val(o.department),$("#txtTelNo").val(o.tel_no),$("#slctBranchRequest").val(o.id_branch).prop("disabled",!0),""!=o.attachment?($("#download").show(),$("#download-message-error").hide()):($("#download-message-error").show(),$("#download").hide())},error:function(t,e){alert("Something went wrong!")},complete:function(){self.dtCurrentMrf.autoComplete(),$(".s1_brand, .s1_id_model, .s2_id_brand, .s2_id_model").chosen({no_results_text:"No records found.",width:"100%",search_contains:!0}),a.button("reset")}})}else alert("ID is empty");return this},showModelByBrand:function(t,e,a){return $(t).change(function(){var t=$(this).val()||null,r=$(this).data(e),n=a+r;null!=t?$.ajax({type:"GET",dataType:"json",url:assets+"php/misc/inventory_misc.php",data:{action:"model_by_brand",id_brand:t},beforeSend:function(){$(n).val(0).trigger("chosen:updated")},success:function(t){if($(n+" option").hide().trigger("chosen:updated"),null!=t.aaData[0].id_model){var e=convertArrStrToInt(t.aaData[0].id_model),a=0;for(a=0;a<e.length;a++)$(n).prop("disabled",!1).trigger("chosen:updated"),$(n+" option[value='"+e[a]+"']").show().trigger("chosen:updated")}},error:function(t,e){alert(t+e)}}):$(n).prop("disabled",!0).val(0).trigger("chosen:updated")}),this},autoComplete:function(){return $("#txtCompany").autocomplete({dropdownWidth:"100%",appendMethod:"replace",valid:function(){return!0},source:[function(t,e){return""!=t&&$.getJSON(assets+"php/mrf/misc/getCompanyList.php?search=notall&company_name="+encodeURIComponent(t),function(t){e(t)}),null}],getTitle:function(t){return t.company_name},getValue:function(t){return t.company_name}}).on("selected.xdsoft",function(t,e){$(this).attr("data-value",e.id),$("#txtShipTo").val(e.address),$("#txtBillTo").val(e.address)}),$(window).on("resize",function(){$(".form-component-3 .xdsoft_autocomplete ").css({width:"100%"})}),this},actions:function(){return $("#currentMrfList").on("click","button, a",function(t){t.preventDefault();var e=$(this),a=e.text().toLowerCase();if(e.closest("tr").hasClass("selected")||(self.dtCurrentMrf.dtInstance.$("tr.selected").removeClass("selected"),e.closest("tr").addClass("selected")),"search"==a&&self.dtCurrentMrf.dtInstance.ajax.reload(null,!0),"reset"==a&&($("#dthead-search-mrf input[type='text'], #search-for-approver").val(""),self.dtCurrentMrf.dtInstance.ajax.reload(null,!0)),"edit"==a){$("#modalFormCurrentMrf .modal-title").text("Edit Machine Request"),$("#btn_cancel, #download").show();var r=$(this).data("mrf");self.dtCurrentMrf.getData(r)}if("view"==a){var n=$(this).data("mrf");self.dtCurrentMrf.getDataViewRequestForm(n)}if("comments"==a){var o=$(this).data("mrf"),s=Cookies.get("user_id");$("#hdnIdMRF").val(o),comment.display(o,s)}}),this},g_form_no:function(){var t="";return $.ajax({type:"GET",dataType:"json",url:assets+"php/mrf/misc/generateFormNo.php",async:!1,cache:!1,success:function(e,a,r){t=e[0]},error:function(){alert("Something went wrong!")}}),t},getTableRowDeleteId:function(t){var e=this;return $(t.elemTable).on("click",".delete_row",function(a){a.preventDefault();var r=t.attrTr||"",n=$(this).closest("tr").data(r);"#tbl_frm_component_1"==t.elemTable&&(""!=n&&void 0!=n&&e.tableValuesDeleteS1.push(n),$(t.elemTable).data("del-id",e.tableValuesDeleteS1)),"#tbl_frm_component_2"==t.elemTable&&(""!=n&&void 0!=n&&e.tableValuesDeleteS2.push(n),$(t.elemTable).data("del-id",e.tableValuesDeleteS2)),"#tbl_frm_s1_toner"==t.elemTable&&(""!=n&&void 0!=n&&e.tableValuesDeleteToner.push(n),$(t.elemTable).data("del-id",e.tableValuesDeleteToner))}),this},getDataViewRequestForm:function(t){if(""!=t&&void 0!=t){var e,a,r="<tr ><td colspan='6'><div class='text-center'><span class='label label-info text-center'>No data available in table.</span></div></td></tr>",n=JSON.parse(Cookies.get("app_module_action")),o=Cookies.get("user_id"),s=Cookies.get("user_type");$.ajax({type:"POST",url:assets+"php/mrf/mrf.php",data:{action:"view-toner-details",id_mrf:t},dataType:"json",cache:!1,beforeSend:function(){e=" ",a=" ",$(".view-loader").show()},success:function(t,l,d){var i=t.aaData[0];$(".hdnAttachmentName").val(i.attachment),$(".post-list-attachment").html(fileUpload.postListFiles(i.attachment,!0)),$("#hdnIdCurrentViewMrf").val(i.id),$("#hdnIdBranchCurrentViewMrf").val(i.id_branch),$(".form-no #form-code").text(i.form_no),$("#requestedBy span").text(i.requested_by);var c;i.res_row_data_s1.length>0?$.each(i.res_row_data_s1,function(t,a){c=a.s1_quantity>0?a.s1_quantity:a.s1_serialnum.split(",").length,e+="<tr data-mrf-s1="+a.id+' class="parentRow" data-toner-values='+(i.res_row_data_s1_toner[a.id]?encodeURIComponent(JSON.stringify(i.res_row_data_s1_toner[a.id])):"")+">",e+='<td rowspan="3" class="first">'+(t+1)+"</td><td>"+c+"</td><td>"+a.brand_name+"</td><td>"+a.model_name+"</td><td>"+a.bn_rf+"</td><td>"+a.s1_accessories+"</td>",e+="</tr>",e+='<tr class="subRowSerial">',e+=self.dtCurrentMrf.buildSubRowSerial(a.s1_serialnum?a.s1_serialnum.split(","):0),e+="</tr>",e+="<tr><td colspan='8'><table class='subTableStyle'><thead><tr><th colspan='8'>Toner</th></tr><tr><th>Quantity</th><th>Mono/Colored</th><th>Toner Model</th><th>Unit Price</th><th>Yield</th><th>Total</th><th>Type</th><th>Rate</th></tr></thead><tbody>",null!=i.res_row_data_s1_toner_sub?$.each(i.res_row_data_s1_toner_sub[a.id],function(t,a){e+="<tr>",e+="<td>"+a.s1_toner_qty+"</td><td>"+a.type_name+"</td><td>"+a.s1_toner_model+"</td><td>"+a.s1_toner_price+"</td><td>"+a.s1_toner_yield+"</td><td>"+a.s1_toner_total+'</td><td class="capitalizeText">'+a.s1_billing_type+"</td><td>"+a.s1_toner_rate+"</td>",e+="</tr>"}):(e+="<tr>",e+='<td colspan="8"><div class="text-center"><span class="label label-info">No data available in table.</span></div></td>',e+="</tr>"),e+="</tbody></table></td></tr>"}):e+=r,$("#tbl_view_frm_component_1 tbody").append(e);var p=i.s2_radio_id;if(p>0&&($(".view-step-2 input[type=radio][value='"+p+"']").prop("checked",!0),i.s2_radio_nodays>0&&3==p?$("#no_of_days").text(i.s2_radio_nodays).show():$("#no_of_days").hide(),""!=i.s2_radio_others&&4==p?$("#view_others").text(i.s2_radio_others).show():$("#view_others").hide()),i.res_row_data_s2.length>0?$.each(i.res_row_data_s2,function(t,e){a+="<tr>",a+="<td>"+e.brand_name+"</td><td>"+e.model_name+"</td><td>"+e.s2_serialnum+"</td><td>"+e.s2_contact_p+"</td><td>"+e.s2_dept_branch+"</td>",a+="</tr>"}):a+=r,$("#tbl_view_frm_component_2 tbody").append(a),i.s3_id_purpose>0&&$(".view-step-3 input[type=radio][value='"+i.s3_id_purpose+"']").prop("checked",!0),$(".view-step-4 #dateRequest").text(i.date_requested),$(".view-step-4 #dateDelivery").text(i.date_delivery),$(".view-step-4 #txtCompany").text(i.company_name),$(".view-step-4 #txtShipTo").text(i.ship_to),$(".view-step-4 #txtBillTo").text(i.bill_to),$(".view-step-4 #txtContactPerson").text(i.contact_person),$(".view-step-4 #txtDepartment").text(i.department),$(".view-step-4 #txtTelNo").text(i.tel_no),$.each(i.is_approver[0],function(t,e){e==o&&"wr"==n.action_mrf?($("#tab-form-approve table .tfoot_"+t).show(),$("#tab-form-approve table tfoot button[name="+t+"]").show(),$("#modalFormCurrentViewMrf .modal-footer button[name="+t+"]").show()):($("#tab-form-approve table tfoot button[name="+t+"]").hide(),$("#modalFormCurrentViewMrf .modal-footer button[name="+t+"]").hide())}),i.user_approved.length>0){var u=[];$.each(i.user_approved,function(t,e){""!=e["1st_approver"]&&u.push("#tab-form-approve table > tfoot button[name=1st_approver]"),""!=e["2nd_approver"]&&u.push("#tab-form-approve table > tfoot button[name=2nd_approver], #tab-form-approve table > tfoot button[name=2nd_approver_2], #details_approver_2_btn button[name=2nd_approver], #details_approver_2_btn button[name=2nd_approver_2]"),""!=e["3rd_approver"]&&u.push("#tab-form-approve table > tfoot button[name=3rd_approver]"),""!=e["4th_approver"]&&u.push("#tab-form-approve table > tfoot button[name=4th_approver], #tab-form-approve table > tfoot button[name=4th_approver_2]"),""!=e["5th_approver"]&&u.push("#tab-form-approve table > tfoot button[name=5th_approver], #tab-form-approve table > tfoot button[name=5th_approver_2]"),""!=e["4th_approver"]&&6==s?$("#btn_edit_acc").show():$("#btn_edit_acc").hide(),$("#1st_approve_name").text(e["1st_approver"]),$("#1st_approve_date").text(e["1st_date"]),$("#2nd_approve_name").text(e["2nd_approver"]),$("#2nd_approve_date").text(e["2nd_date"]),$("#3rd_approve_name").text(e["3rd_approver"]),$("#3rd_approve_date").text(e["3rd_date"]),$("#4th_approve_name").text(e["4th_approver"]),$("#4th_approve_date").text(e["4th_date"]),$("#4th_dr_number").val(e["4th_dr_number"]),$("#4th_edr_number").val(e["4th_edr_number"]),$("#4th_inv_number").val(e["4th_inv_number"]),$("#5th_approve_name").text(e["5th_approver"]),$("#5th_approve_date").text(e["5th_date"]),$("#5th_delivery_date").val(e["5th_delivery_date"])}),u.length>0&&$(u.join(",")).hide()}s>1?$(".attachment-upload-container, .remove-attachment").remove():"r"==n.action_mrf&&$(".attachment-upload-container, .remove-attachment").remove();var m="";i.res_row_data_s1.length>0&&5==s&&"wr"==n.action_mrf?$.each(i.res_row_data_s1,function(t,e){var a=e.s1_serialnum.split(",");m+="<tr data-id-edit-sn="+e.id+">",m+="<td>"+a.length+"</td><td>"+e.brand_name+"</td><td>"+e.model_name+"</td><td>"+e.bn_rf+"</td>",m+='<td data-row="serial">',$.each(a,function(t,e){m+='<input type="text" class="mrf-material frm-s1 s1_serialnum" name="s1_serialnum" value="'+e+'">'}),m+="</td>",m+="</tr>"}):m+=r,$("#edit-table-sn tbody").html(m),5==s?$(".container-edit-sn").show():$(".container-edit-sn").hide()},complete:function(){$(".view-loader").hide()},error:function(t,e){alert("Something went wrong!")}})}else alert("ID is empty");return this},updateAttachmentViewRequestForm:function(t){var e=$("#attachment-view")[0].files,a=$("#hdnIdCurrentViewMrf").val()||"",r=$(".hdnAttachmentName").val()||"";return e.length>0?(t.button("loading"),fileUpload.upload(e,{action:"update_files",file_name:r},function(){var e=arguments[0].attachment_status||"",r=arguments[0].attachment_message||"";if("true"==e){var n=arguments[0].attachment_uploaded||"",o={action:"update_view_request",id_mrf:a,attachment_name:n};""!=a?$.ajax({type:"POST",url:assets+"php/mrf/mrf.php",data:o,dataType:"json",success:function(t,e,a){resetForm("#frmViewAttachment"),promptMSG("success-update","Machine Request",null,null,!0,!0),$(".hdnAttachmentName").val(n),$(".post-list-attachment").html(fileUpload.postListFiles(n,!0))},error:function(t,e){alert("Something went wrong!")},complete:function(){t.button("reset")}}):alert("ID is empty")}else alert(r)})):(promptMSG("warning","No files selected."),$(".mif-modalPromptMSG").on("hidden.bs.modal",function(){$("body").addClass("modal-open")})),!1},update_status:function(t){var e=$(t),a=e.data("id-status"),r=e.text()||"",n=e.attr("name"),o=$("#4th_dr_number").val(),s=$("#4th_edr_number").val(),l=$("#4th_inv_number").val(),d=$("#5th_delivery_date").val(),i=$("#5th_received_by").val(),c=$("#5th_delivered_by").val(),p=$("#form-code").text();return 2==$(".radioBtn-group-c2:checked").val()?(promptMSG("warning","Sorry, can't Disapprove/Approve request. Please ask requestor to update machine is <strong>FOR UPGRADE or REPLACE</strong> unit.","",null,!1,!0),!1):"4th_approver"!=n&&"4th_approver_2"!=n||o?"5th_approver"!=n&&"5th_approver_2"!=n||d&&i&&c?(promptMSG("custom","Are you sure you want to <strong>"+e.text()+"</strong> this request?","Confirmation","yn",!1,!0,function(){var t=Cookies.get("user_id"),e=$("#hdnIdCurrentViewMrf").val(),u=$("#hdnIdBranchCurrentViewMrf").val(),m=$('button[name*="approver"]');$.ajax({type:"POST",dataType:"json",data:{action:"update_status",id_user_logged:t,id_mrf:e,branch:u,id_status:a,field_name:n,dr_number:o,edr_number:s,inv_number:l,delivery_date:d,form_no:p,received_by:i,delivered_by:c},url:assets+"php/mrf/mrf.php",beforeSend:function(){m.button("loading"),$(".mif-modalPromptMSG").modal("hide")},success:function(t,a){setTimeout(function(){"true"==t.aaData.result?(promptMSG("success-custom","Machine Request has been successfully <strong>"+r+"</strong>","",null,!1,!0),$(".mif-modalPromptMSG").on("click","button",function(){$("#modalFormCurrentViewMrf").modal("hide")}),self.dtCurrentMrf.getDataViewRequestForm(e),self.dtCurrentMrf.dtInstance.ajax.reload(null,!0)):promptMSG("custom",t.aaData.message,"Warning!",null,!1,!0)},300)},complete:function(){m.button("reset")}})}),this):(alert("Delivery Date/ Received by/ Delivered by is required."),!1):(alert("DR Number is required"),!1)},edit_engr:function(t,e){var a={update:{}};if($("#edit-table-sn tbody tr").each(function(t,e){var r={},n=$(this).closest("tr").attr("data-id-edit-sn"),o=$(this).find("td[data-row^='serial'] input[name='s1_serialnum']").map(function(){if(""!=$(this).val())return $(this).val()}).get().join(",");r.s1_serialnum=o,a.update[n]=r}),Object.keys(a.update).length>0){t=t;var r=$(e);$.ajax({type:"POST",dataType:"json",data:{action:"edit_approve_data",action_approver:"engr",id_mrf:t,row_data_sn:a},url:assets+"php/mrf/mrf.php",beforeSend:function(){r.button("loading")},success:function(t,e){promptMSG("success-update","Serial Number",null,null,!0,!0)},complete:function(){r.button("reset")}})}else alert("Something went wrong.");return this},edit_acc:function(t,e){t=t;var a=$("#4th_dr_number").val();if(!a)return alert("DR Number is required"),!1;var r=$("#4th_edr_number").val(),n=$("#4th_inv_number").val(),o=$(e);return $.ajax({type:"POST",dataType:"json",data:{action:"edit_approve_data",action_approver:"acc",id_mrf:t,dr_num:a,edr_num:r,inv_num:n},url:assets+"php/mrf/mrf.php",beforeSend:function(){o.button("loading")},success:function(t,e){promptMSG("success-update","DR #/ EDR #/ INV #",null,null,!0,!0)},complete:function(){o.button("reset")}}),this},update_cancel:function(){return $("#btn_cancel").click(function(){var t=$(this).val()||"";promptMSG("custom","Are you sure you want to <strong>"+t+"</strong>?","Confirmation","yn",!1,!0,function(){var t=$("#hdnIdCurrentMrf").val()||"";""!=t?$.ajax({type:"POST",dataType:"json",data:{action:"update_cancel",id_mrf:t},url:assets+"php/mrf/mrf.php",async:!1,beforeSend:function(){$("#modalFormCurrentMrf").modal("hide"),$(".mif-modalPromptMSG").modal("hide")},success:function(t,e){setTimeout(function(){"true"==t.aaData.result?(promptMSG("success-custom",t.aaData.message),self.dtCurrentMrf.dtInstance.ajax.reload(null,!1)):promptMSG("custom",t.aaData.message,"Warning!")},300)}}):alert("ID form is empty.")})}),this},attachTableTonerData:function(t){var e=t,a=getTableRowValue({elemTable:"#tbl_frm_s1_toner",trAttr:"mrf-s1-toner",selectorInput:"input, select",inputElem:[{name:"s1_toner_qty",getValueByChosen:!1},{name:"s1_toner_monocolor",getValueByChosen:!1},{name:"s1_toner_model",getValueByChosen:!1},{name:"s1_toner_price",getValueByChosen:!1},{name:"s1_toner_yield",getValueByChosen:!1},{name:"s1_toner_total",getValueByChosen:!1},{name:"s1_toner_type",getValueByChosen:!1},{name:"s1_toner_rate",getValueByChosen:!1}]}),r=getTableRowText({elemTable:"#tbl_frm_s1_toner",trAttr:"mrf-s1-toner",selectorInput:"input, select",inputElem:[{name:"s1_toner_qty",getValueByChosen:!1},{name:"s1_toner_monocolor",getValueByChosen:!1},{name:"s1_toner_model",getValueByChosen:!1},{name:"s1_toner_price",getValueByChosen:!1},{name:"s1_toner_yield",getValueByChosen:!1},{name:"s1_toner_total",getValueByChosen:!1},{name:"s1_toner_type",getValueByChosen:!1},{name:"s1_toner_rate",getValueByChosen:!1}]});a.insert.length>0||!jQuery.isEmptyObject(a.update)?$("#tbl_frm_component_1 tbody tr[data-row-num^='"+e+"'] .s1_toner").val(1):$("#tbl_frm_component_1 tbody tr[data-row-num^='"+e+"'] .s1_toner").val(""),$("#tbl_frm_component_1 tbody tr[data-row-num^='"+e+"']").data("toner-values",a);var n=[];return jQuery.isEmptyObject(r.update)||$.each(r.update,function(t,e){n.push(e)}),r.insert.length>0&&$.each(r.insert,function(t,e){n.push(e)}),$("#tbl_frm_component_1 tbody tr[data-row-num^='"+e+"']").next("tr").next(".subRow").html(self.dtCurrentMrf.buildSubRow(["Quantity","Mono/Colored","Toner Model","Unit Price","Yield","Total","Type","Rate"],n,"Toner")),this},buildSubRow:function(t,e,a){var r=t,n=e;if(null!=n){var o=document.createElement("table"),s=document.createElement("thead"),l=document.createElement("tbody"),d=document.createElement("tr"),i=document.createElement("tr"),c=document.createElement("th");return o.className="subTableStyle",r.forEach(function(t){var e=document.createElement("th");e.appendChild(document.createTextNode(t)),d.appendChild(e)}),c.appendChild(document.createTextNode(a)),c.setAttribute("colspan",r.length),i.appendChild(c),s.appendChild(i),s.appendChild(d),o.appendChild(s),n.forEach(function(t){var e=document.createElement("tr");for(var a in t){var r=document.createElement("td"),n=document.createTextNode(t[a]);r.appendChild(n),e.appendChild(r)}l.appendChild(e)}),o.appendChild(l),"<td colspan='8'><div>"+o.outerHTML+"</div></td>"}return""},getTrIndex:function(t){var e=" ",a=null,r=$(t).closest("tr"),n=$(t).closest("tr").attr("data-row-num"),o=[];return a=r.data("toner-values"),e=" ",$("#hdnTrIndexToner").val(n),void 0!=a&&null!=a&&($.each(a.update,function(t,e){o.push(e)}),$.each(a.insert,function(t,e){o.push(e)}),$.each(o,function(t,a){var r=void 0==a.id||""==a.id?"":a.id;e+='<tr data-mrf-s1-toner="'+r+'" data-row-num="parentRow">',e+='<td><input type="text" class="mrf-material s1_toner_qty" name="s1_toner_qty" value="'+a.s1_toner_qty+'" onkeyup="dtCurrentMrf.autoComputeTonerTotal(this)"></td><td><select class="mrf-material frm-s1" name="s1_toner_monocolor"><option value="">---</option><option value="1" '+(1==a.s1_toner_monocolor?"selected":"")+'>Mono</option><option value="2" '+(2==a.s1_toner_monocolor?"selected":"")+'>Color</option></select></td><td><input type="text" class="mrf-material s1_toner_model"  name="s1_toner_model" value="'+a.s1_toner_model+'" ></td><td><input type="text" class="mrf-material s1_toner_price"  name="s1_toner_price" value="'+a.s1_toner_price+'" onkeyup="dtCurrentMrf.autoComputeTonerTotal(this)"></td><td><input type="text" class="mrf-material s1_toner_yield"  name="s1_toner_yield" value="'+a.s1_toner_yield+'"></td><td><input type="text" class="mrf-material s1_toner_total"  name="s1_toner_total" value="'+a.s1_toner_total+'" disabled="disabled"></td><td><select class="mrf-material frm-s1 s1_toner_type" name="s1_toner_type"><option value="">---</option><option value="1" '+(1==a.s1_toner_type?"selected":"")+'>Outright</option><option value="2" '+(2==a.s1_toner_type?"selected":"")+'>Meter Reading</option><option value="3" '+(3==a.s1_toner_type?"selected":"")+'>Fixed Monthly</option></select></td><td><input type="text" class="mrf-material s1_toner_rate" name="s1_toner_rate" value="'+a.s1_toner_rate+'"></td><td><button type="button" title="Delete" class="btn btn-flat btn-danger btn-xs delete_row">X</button></td>',e+="</tr>"}),$("#tbl_frm_s1_toner tbody").append(e)),this},getTonerDetails:function(t){var e=" ",a=null,r=$(t).closest("tr");return a=decodeURIComponent(r.data("toner-values")),e=" ",void 0!=a&&null!=a&&""!=a?$.each(JSON.parse(a),function(t,a){e+="<tr>",e+="<td>"+a.s1_toner_qty+"</td><td>"+a.type_name+"</td><td>"+a.s1_toner_model+"</td><td>"+a.s1_toner_price+"</td><td>"+a.s1_toner_yield+"</td><td>"+a.s1_toner_total+"</td><td>"+a.s1_billing_type+"</td><td>"+a.s1_toner_rate+"</td>",e+="</tr>"}):e+="<tr ><td colspan='6'><div class='text-center'><span class='label label-info text-center'>No data available in table.</span></div></td></tr>",$("#tbl_view_s1_toner tbody").html(e),this},addFieldsSerial:function(){$("#add").on("click",function(){var t=$("div#newSerialFields").children("div"),e=$("#qty").val()||0;e+1&&(e>t.length?function(t,e){var a=0;for(a=e.length;a<t;a++)$("<div><label>"+(a+1)+'</label>. <input type="text" class="s1_serial" name="s1_serial"/></div>').appendTo("#newSerialFields")}(e,t):function(t,e){var a=e.slice(t).remove();e=e.not(a)}(e,t))});return this},getTrIndexSerial:function(t){var e=" ",a=$(t).closest("tr").attr("data-row-num"),r=$("#tbl_frm_component_1 tbody tr[data-row-num^='"+a+"'] #s1_serialnum").val(),n=$("#tbl_frm_component_1 tbody tr[data-row-num^='"+a+"'] #s1_quantity").val();if($("#hdnTrIndexSN").val(a),$("#qty").val(n),r){var o=r.split(",");for(key in o)e+="<div><label>"+(parseInt(key)+1)+'</label>. <input type="text" class="s1_serial" name="s1_serial" value='+o[key]+"></div>";$("#frmS1Serial #newSerialFields").html(e)}},getTrIndexViewSerial:function(t){var e=" ",a=$(t).closest("tr").attr("data-row-num"),r=$("#tbl_view_frm_component_1 tbody tr[data-row-num^='"+a+"'] #s1_serialnum").val();if(r){var n=r.split(",");e+="<ul class='list-style-none'>";for(key in n)e+="<li>"+n[key]+"</li>";e+="</ul>",$("#frmViewSerial .newFields").html(e)}},saveSerialNumber:function(t){var e=getMultipleValue(".s1_serial");$("#qty").val();$("#tbl_frm_component_1 tbody tr[data-row-num^='"+t+"'] .s1_serialnum").val(e),$("#tbl_frm_component_1 tbody tr[data-row-num^='"+t+"'] .s1_quantity").val(e?e.split(",").length:0),$("#tbl_frm_component_1 tbody tr[data-row-num^='"+t+"']").next("tr.subRowSerial").html(self.dtCurrentMrf.buildSubRowSerial(e?e.split(","):0))},buildSubRowSerial:function(t){var e=t;if(t.length>0){var a,r=[],n=0;for(n=0,j=e.length;n<j;n++)n%5==0&&(a&&r.push(a),a=[]),a.push(e[n]);a&&r.push(a);var o=document.createElement("table"),s=document.createElement("tbody"),l=document.createElement("thead"),d=document.createElement("th"),i=document.createElement("tr");return o.className="subTableStyle",d.appendChild(document.createTextNode("Serial Numbers")),d.setAttribute("colspan",5),i.appendChild(d),l.appendChild(i),o.appendChild(l),r.forEach(function(t,e){var a=document.createElement("tr");for(var r in t){var n=document.createElement("td"),o=document.createTextNode(t[r]);n.appendChild(o),a.appendChild(n)}s.appendChild(a)}),o.appendChild(s),"<td colspan='8'><div>"+o.outerHTML+"</div></td>"}return""},autoComputeTonerTotal:function(t){var e=$(t),a=e.closest("tr"),r=["s1_toner_qty","s1_toner_price"],n=r.indexOf(e.attr("name"));r.splice(n,1);var o=$("#tbl_frm_s1_toner tbody tr:eq("+a.index()+") input[name='"+r+"']").val()||0;$("#tbl_frm_s1_toner tbody tr:eq("+a.index()+") .s1_toner_total").val(o*e.val());var s=$(".s1_toner_total").map(function(){if(""!=$(this).val())return parseInt($(this).val())}).get().reduce(function(t,e){return t+e});$("#grandTotal").text(s>0?formatNumber(s):"----")}},dtMrfApprover={dtInstance:{},pageDetails:function(){return $(".content-header h1").text("MRF"),$(".content-header h1").append("<small>Settings</small>"),this},render:function(){return this.dtInstance=$("#dtMrfApprover").DataTable({dom:"fBlrtip",autoWidth:!1,responsive:!0,pageLength:10,lengthMenu:[[10,25,50,-1],[10,25,50,"All"]],oLanguage:{bProcessing:!0,sLoadingRecords:'<i class="fa fa-spinner fa-pulse fa-3x fa-fw"></i><span class="sr-only">Please wait - loading...</span>',sInfoEmpty:"No entries to show"},bDestroy:!0,bStateSave:!0,ordering:!1,ajax:{url:assets+"php/mrf/settings/approver_setup.php",type:"GET",data:{action:"view-all"}},buttons:[{text:'<i class="fa fa-refresh" aria-hidden="true"></i>',tag:"a",className:"btn-refresh-approver",action:function(t,e,a,r){self.dtMrfApprover.dtInstance.ajax.reload(null,!1),autoDrpDownMrf.cacheOptAccountMrf.splice(0,1)}}],columns:[{data:null,render:function(t,e,a,r){return"<span class='text-center'>"+t.branch_name+"</span>"}},{data:null,render:function(t,e,a,r){return"<span class='text-center'>"+t["1st_approver"]+"</span>"}},{data:null,render:function(t,e,a,r){return"<span class='text-center'>"+t["2nd_approver"]+"<br>"+t["2nd_approver_2"]+"</span>"}},{data:null,render:function(t,e,a,r){return"<span class='text-center'>"+t["3rd_approver"]+"</span>"}},{data:null,render:function(t,e,a,r){return"<span class='text-center'>"+t["4th_approver"]+"<br>"+t["4th_approver_2"]+"</span>"}},{data:null,render:function(t,e,a,r){return"<span class='text-center'>"+t["5th_approver"]+"<br>"+t["5th_approver_2"]+"</span>"}},{data:null,render:function(t,e,a,r){return"<button class='btn btn-xs btn-success btn-flat btnUpdateMrfApprover' data-mrf-approver='"+t.id+"' data-toggle='modal' data-target='#modalFormMrfSettingsApprover'>Update</button>"}}],columnDefs:[{responsivePriority:1,target:0}],preDrawCallback:function(t){$(".btn-refresh-approver").removeClass("dt-button").addClass("btn btn-primary btn-flat btn-xs").css({"margin-bottom":"0.5em","margin-right":"0.5em"})},deferRender:!0}),this},modalShow:function(t){return $("#displayFormMrfEntry").load(pages+"mrf/settings/form-approver.html",function(t,e,a){autoDrpDownMrf.getAccountHasMrf("#slct1stApprover",1),autoDrpDownMrf.getAccountHasMrf("#slct2ndApprover",1),autoDrpDownMrf.getAccountHasMrf("#slct2ndApprover_2",1),autoDrpDownMrf.getAccountHasMrf("#slct3rdApprover",5),autoDrpDownMrf.getAccountHasMrf("#slct4thApprover",6),autoDrpDownMrf.getAccountHasMrf("#slct4thApprover_2",6),autoDrpDownMrf.getAccountHasMrf("#slct5thApprover",7),autoDrpDownMrf.getAccountHasMrf("#slct5thApprover_2",7),$("#modalFormMrfSettingsApprover").on("hidden.bs.modal",function(){$(this).find("input").parent(".col-sm-5").removeClass("has-error has-success"),$(this).find("em").remove(),$(this).find("#frmSettingMrfApprover input:hidden").val(""),$(this).find("#frmSettingMrfApprover").trigger("reset")})}),this},getData:function(t){if(""!=t){var e=$("button[type='submit']");$.ajax({type:"GET",url:assets+"php/mrf/settings/approver_setup.php",data:{action:"view-id",id_setup:t},dataType:"json",beforeSend:function(){e.button("loading")},success:function(t){$.each(t.aaData,function(t,e){$("#hdnIdMrfSettingsApprover").val(e.id),$("#hdnIdMrfSettingsApproverBranch").val(e.id_branch),$("#lblMrfSettingApproverBranch").text(e.branch_name),$("#slct1stApprover").val(e["1st_approver"]),$("#slct2ndApprover").val(e["2nd_approver"]),$("#slct2ndApprover_2").val(e["2nd_approver_2"]),$("#slct3rdApprover").val(e["3rd_approver"]),$("#slct4thApprover").val(e["4th_approver"]),$("#slct4thApprover_2").val(e["4th_approver_2"]),$("#slct5thApprover").val(e["5th_approver"]),$("#slct5thApprover_2").val(e["5th_approver_2"])})},error:function(t,e,a){alert("ID Machine not exist.")},complete:function(){e.button("reset")}})}else alert("ID is empty.")},update:function(){var t=$("button[type='submit']"),e=$("#hdnIdMrfSettingsApprover").val(),a=$("#slct1stApprover option:selected").val(),r=$("#slct2ndApprover option:selected").val(),n=$("#slct2ndApprover_2 option:selected").val(),o=$("#slct3rdApprover option:selected").val(),s=$("#slct4thApprover option:selected").val(),l=$("#slct4thApprover_2 option:selected").val(),d=$("#slct5thApprover option:selected").val(),i=$("#slct5thApprover_2 option:selected").val(),c=Cookies.get("user_id"),p=$("#hdnIdMrfSettingsApproverBranch").val();$.ajax({type:"POST",url:assets+"php/mrf/settings/approver_setup.php",data:{action:"update",id_setup:e,id_user:c,branch:p,approver_1:a,approver_2:r,approver_2_2:n,approver_3:o,approver_4:s,approver_4_2:l,approver_5:d,approver_5_2:i},dataType:"json",beforeSend:function(){t.button("loading")},success:function(t){self.dtMrfApprover.dtInstance.ajax.reload(null,!1),autoDrpDownMrf.cacheOptAccountMrf.splice(0,1)},error:function(t,e,a){alert("Something went wrong.")},complete:function(){t.button("reset")}})},actions:function(){return $("table#dtMrfApprover").on("click","button",function(){var t=$(this);if(t.closest("tr").hasClass("selected")||(self.dtMrfApprover.dtInstance.$("tr.selected").removeClass("selected"),t.closest("tr").addClass("selected")),t.hasClass("btnUpdateMrfApprover")){var e=$(this).data("mrf-approver");self.dtMrfApprover.getData(e)}}),$("#addInventoryBranch").click(function(t){self.dtMrfApprover.modalShow()}),this}};