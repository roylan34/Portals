var machineCharts={brandDataOpt:[],dtInstance:{},dtInstanceLoc:{},pageDetails:function(){return $(".content-header h1").text("Machine in Field"),$(".content-header h1").append("<small>Home</small>"),this},brands:function(){var t=[],a=null;return $.getJSON(assets+"php/charts/machine-charts.php",{type_chart:"brands"},function(a){$.each(a.aaData,function(a,e){t.push({y:parseInt(e.total_brands),label:e.brand_name,indexLabel:formatNumber(e.total_brands),id_brand:e.id_brand})})}).complete(function(){var e={animationEnabled:!0,title:{text:"Summary MIF Brands",culture:"es"},axisY:{gridThickness:1,interval:2e3},axisX:{labelFormatter:function(t){return null==t.label?"empty brand name":t.label},labelFontColor:"#00a65a",interval:1,labelAngle:0},data:[{click:function(t){var a=t.dataPoint.id_brand||0;self.machineCharts.showModels(a,t.dataPoint.label)},type:"column",color:"#23BFAA",fillOpacity:.9,dataPoints:t,indexLabelFontColor:"#dd4b39"}]};$("#chartBrands").ready(function(){$("#chartBrands").CanvasJSChart(e),$("button[type='button']").click(function(){var t=$(this);"on"==t.data("toggle")?(a=setInterval(function(){self.machineCharts.brands()},5e3),t.addClass("active"),$(".real-off").removeClass("active")):(window.clearInterval(a),t.addClass("active"),$(".real-on").removeClass("active"))})})}),this},showModels:function(t,a){$("#displayModelChart").load(pages+"charts/model.html",function(){$("#modalChartModel").modal("show"),autoDrpDown.getBrandName("#slctChartBrand"),$("#modalChartModel").find(".modal-title").text(a),self.machineCharts.renderModels(t),$("#slctChartBrand").change(function(){id_brand=$(this).val()||0,brand_text=0!=id_brand?$(this).find("option:selected").text():"w/o brand name",$("#modalChartModel").find(".modal-title").text(brand_text),self.machineCharts.renderModels(id_brand)})})},renderModels:function(t){return this.dtInstance=$("#dtChartModel").DataTable({dom:"flrtip",autoWidth:!1,responsive:!0,pageLength:10,lengthMenu:[[10,25,50,-1],[10,25,50,"All"]],oLanguage:{bProcessing:!0,sLoadingRecords:'<i class="fa fa-spinner fa-pulse fa-3x fa-fw"></i><span class="sr-only">Please wait - loading...</span>',sInfoEmpty:"No entries to show"},bDestroy:!0,bStateSave:!0,ordering:!1,ajax:{url:assets+"php/charts/machine-charts.php",type:"GET",data:{type_chart:"models",idBrand:t}},columns:[{data:null,render:function(t,a,e,n){return n.row+1}},{data:null,render:function(t,a,e,n){return"<span class='text-center'>"+t.model+"</span>"}},{data:null,render:function(t,a,e,n){return"<span class='text-center'>"+(t.total_machine||0)+"</span>"}}],columnDefs:[{responsivePriority:1,target:0}],deferRender:!0,footerCallback:function(t,a,e,n,s){var l=this.api(),o=l.column(2).data(),r=0;$.each(o,function(t,a){null!=a.total_machine&&(r+=parseInt(a.total_machine))}),$(l.column(2).footer()).html("Overall Total: "+formatNumber(r))}}),this},location:function(){return this.dtInstanceLoc=$("#chartlocation").DataTable({dom:"flrtip",autoWidth:!1,responsive:!0,pageLength:10,lengthMenu:[[10,25,50,-1],[10,25,50,"All"]],oLanguage:{bProcessing:!0,sLoadingRecords:'<i class="fa fa-spinner fa-pulse fa-3x fa-fw"></i><span class="sr-only">Please wait - loading...</span>',sInfoEmpty:"No entries to show"},bDestroy:!0,bStateSave:!0,ordering:!1,ajax:{url:assets+"php/charts/machine-charts.php",type:"GET",data:{type_chart:"location"}},columns:[{data:null,render:function(t,a,e,n){return n.row+1}},{data:null,render:function(t,a,e,n){return"<span class='text-center'>"+(null!=t.branch_name?t.branch_name:"empty location")+"</span>"}},{data:null,render:function(t,a,e,n){var s=t.total_machine_location||0;return"<span class='text-center badge'>"+formatNumber(s)+"</span>"}}],columnDefs:[{responsivePriority:1,target:0}],deferRender:!0,footerCallback:function(t,a,e,n,s){var l=this.api(),o=l.column(2).data(),r=0;$.each(o,function(t,a){null!=a.total_machine_location&&(r+=parseInt(a.total_machine_location))}),$(l.column(2).footer()).html("Overall Total: "+formatNumber(r))}}),this}},dtArchiveCompany={dtInstance:{},dtInstanceLogs:null,btn:$("button[type='submit']"),render:function(t){return this.dtInstance=$("#dtArchiveCompany").DataTable({dom:"Blrtip",autoWidth:!1,responsive:!0,pageLength:25,lengthMenu:[[10,25,50,-1],[10,25,50,"All"]],language:{processing:'<i class="fa fa-spinner fa-pulse fa-2x fa-fw"></i><span class="sr-only">Please wait - loading...</span>',infoEmpty:"No entries to show"},processing:!0,serverSide:!0,bDestroy:!0,ordering:!1,ajax:{url:assets+"php/company/getCompanyList.php",type:"POST",dataSrc:"records",beforeSend:function(){$(".dt-buttons a").addClass("disabled")},data:function(a){var e=$("#search-archive-branch").chosen().val();a.company=$("#search-archive-companyname").val(),a.category=$("#search-archive-category").val(),a.address=$("#search-archive-address").val(),a.s_branch=1==t?e:e||t,a.contactno=$("#search-archive-contactno").val(),a.accmngr=$("#search-archive-accmngr").chosen().val(),a.s_location=$("#search-archive-location").chosen().val(),a.action_view="archive_company",a.branch="1"==t?null:t},complete:function(){$(".dt-buttons a").removeClass("disabled")}},buttons:[{extend:"excel",className:"dt-company-excel hidden-xs",exportOptions:{columns:[1,2,3,4,5,6,7,8,9],stripNewlines:!1},filename:"Archive Company "+getTodayDate()},{extend:"print",exportOptions:{columns:[0,1,2,3,4,5,6,7,8,9],format:{body:function(t,a,e){return 5===a?t.replace(/<br\s*\/?>/gi,'"\r\n"'):t}}},className:"dt-company-print hidden-xs",customize:function(t){$(t.document.body).find(".dt-column-branches").css("max-height","0px !important")}},{text:"Open Search Filter",className:"dt-button-search",action:function(t,a,e,n){$("#dt-head-search").slideToggle("fast",function(){$(this).is(":visible")?e[0].innerText="Close Search Filter":(e[0].innerText="Open Search Filter",$("#dt-head-search input[type='text']").val(""),$("#search-company-branch, #search-company-accmngr, #search-company-location").val(0).trigger("chosen:updated"),self.dtArchiveCompany.dtInstance.ajax.reload(null,!0))})}}],columns:[{data:null,render:function(t,a,e,n){return n.row+1}},{data:null,render:function(t,a,e,n){var s=t.sap_code||null;return null!=s?"<span class='text-center'><a href='#' title='View SAP Details' id='modalSapDetails'>"+s+"</a></span>":"---"}},{data:null,render:function(t,a,e,n){var s="",l=t.delsan_company;return"dosc"==l?s="green":"dbic"==l&&(s="blue"),"<span class='badge badge-"+s+"'>"+l.toUpperCase()+"</span>"}},{data:null,render:function(t,a,e,n){return"<span class=''>"+t.company_name+"</span>"}},{data:null,render:function(t,a,e,n){return"<span class='text-center'>"+t.client_category+"</span>"}},{data:null,width:"20%",render:function(t,a,e,n){return"<span class='text-center'><a href='#' title='View Map' id='modalMap' data-toggle='modal' data-target='#modalMap'>"+t.address+"</a></span>"}},{data:null,render:function(t,a,e,n){return"<div class='text-left dt-column-branches'>"+isEmpty(t.main_location)+"</div>"}},{data:null,render:function(t,a,e,n){return"<div class='text-left dt-column-branches'>"+isEmpty(t.branches)+"</div>"}},{data:null,render:function(t,a,e,n){return"<span class='text-center'>"+isEmpty(t.contact_no)+"</span>"}},{data:null,render:function(t,a,e,n){return"<span class='text-center'>"+isEmpty(t.account_mngr_name)+"</span>"}},{data:null,render:function(t,a,e,n){return"<span class='text-left' style='color:#dd4b39'> BLOCKED </span>"}},{data:null,render:function(t,a,e,n){return"<span class='text-center'>"+isEmpty(t.date_last_visit)+"</span>"}},{data:null,render:function(t,a,e,n){var s=JSON.parse(Cookies.get("app_module_action"));if(s&&"wr"==s.action_mif)return"<button class='btn btn-xs btn-success btn-flat btnEditComp' data-comp='"+t.id+"'>Retrieve</button>"}}],columnDefs:[{responsivePriority:1,target:0},{responsivePriority:2,target:1}],deferRender:!0,preDrawCallback:function(t){$(".dt-button-search, .dt-company-excel, .dt-company-print, .dt-button-add").removeClass("dt-button").addClass("btn btn-primary btn-flat btn-sm").css({"margin-bottom":"0.5em","margin-right":"0.5em"}),$(".dt-company-print").text("").html("<i class='glyphicon glyphicon-print'></i>").attr("title","Print"),$(".dt-company-excel").text("").html("<i class='fa fa-file-excel-o'></i>").attr("title","Export to Excel")}}),this},modalShow:function(t){$("#displayFormCompany").load(pages+"archive/retrieve-company.html",function(a,e,n){$("#modalArchiveCompanyList").modal("show");var s=Cookies.get("location");if(autoDrpDown.getBranchNameMulti("#slctCompanyBranch","100%",s,!0),autoDrpDown.getBranchNameMulti("#slctCompanyLocation","100%",s,!0),autoDrpDown.getClientName("#slctClientMngr","100%"),autoDrpDown.getSapCompany("#txtSapCompany",!0),null!=t){var l=$("button[type='submit']");$.ajax({type:"GET",url:assets+"php/company/getCompanyById.php",data:{idcompany:t},dataType:"json",beforeSend:function(){l.button("loading")},success:function(t){var a=t.aaData[0];$("#hdnIdCompany").val(a.id),$("#txtEditCompany").val(a.company_name),$("#txtSapCode").val(a.sap_code),$("#txtSapCompany").val(a.sap_code).trigger("chosen:updated"),$("#OldhdnEditCompany").val(a.company_name),$("#txtEditCategory").val(a.client_category),$("#txtEditAddress").val(a.address),$("#txtContactNo").val(a.contact_no),$("input[name='delsanCompany'][value='"+a.delsan_company+"']").prop("checked",!0),$("#OldhdnClientMngr").val(a.id_client_mngr),$("#slctClientMngr").val(a.id_client_mngr).trigger("chosen:updated"),$("#slctCompanyBranch").val(null==a.id_branches?null:a.id_branches.split(",")).trigger("chosen:updated"),$("#slctCompanyLocation").val(null==a.main_location?null:a.main_location).trigger("chosen:updated"),$("#OldIdBranches").val(a.id_branches),$("#slctStatus").val(a.status),$("#txtLastVisit").val(a.date_last_visit)},error:function(t,a,e){promptMSG("warning","ID Machine not exist.")},complete:function(){l.button("reset")}})}})},retrieve:function(){var t=$("button[type='submit']"),a=$("#hdnIdCompany").val(),e=$("#txtEditCompany").val(),n=$("#txtEditCategory").val(),s=$("#txtEditAddress").val(),l=$("#slctCompanyBranch").chosen().val()?$("#slctCompanyBranch").chosen().val().toString():"",o=$("#slctCompanyLocation").chosen().val()?$("#slctCompanyLocation").chosen().val().toString():"",r=$("#txtContactNo").val(),c=$("#txtSapCode").val(),i=$("input[name='delsanCompany']:checked").val(),d={idcompany:a,company:e,category:n,address:s,location:o,branch:l,contactno:r,accmngr:$("#slctClientMngr").chosen().val(),oldaccmngr:$("#OldhdnClientMngr").val(),oldbranch:$("#OldIdBranches").val(),status:$("#slctStatus option:selected").val(),user_id:Cookies.get("user_id"),last_visit:$("#txtLastVisit").val(),sap_code:c,delsan_comp:i};$.ajax({type:"POST",url:assets+"php/company/updateCompany.php",data:d,dataType:"json",beforeSend:function(){t.button("loading")},success:function(t){self.dtArchiveCompany.dtInstance.ajax.reload(null,!1),autoDrpDown.cacheOptComp.splice(0,1),promptMSG("success-update","Company",null,null,!0,!0)},error:function(t,a){alert(t+a)},complete:function(){t.button("reset")}})},actions:function(){return $("table#dtArchiveCompany").on("click","button, a",function(t){t.preventDefault();var a=$(this),e=a.text().toLowerCase();if(a.closest("tr").hasClass("selected")||(self.dtArchiveCompany.dtInstance.$("tr.selected").removeClass("selected"),a.closest("tr").addClass("selected")),"retrieve"==e){var n=$(this).data("comp");self.dtArchiveCompany.modalShow(n)}"search"==e&&self.dtArchiveCompany.dtInstance.ajax.reload(null,!0),"reset"==e&&($("#dt-head-search input[type='text']").val(""),$("#search-archive-branch, #search-archive-accmngr, #search-archive-location").val(0).trigger("chosen:updated"),self.dtArchiveCompany.dtInstance.ajax.reload(null,!0))}),this}},dtArchiveMachine={dtMArchiveInstance:null,dtRenderDom:null,pageDetails:function(){return $(".content-header h1").text("Machine in Field"),$(".content-header h1").append("<small>Archive</small>"),this},render:function(){this.dtMArchiveInstance=$("#dtArchiveMachine").DataTable({dom:"Blrtip",autoWidth:!1,responsive:!0,pageLength:10,lengthMenu:[[10,25,50,-1],[10,25,50,"All"]],oLanguage:{sLoadingRecords:'<i class="fa fa-spinner fa-pulse fa-3x fa-fw"></i><span class="sr-only">Please wait - loading...</span>',sInfoEmpty:"No entries to show"},bDestroy:!0,sPaginationType:"full_numbers",ordering:!1,ajax:{url:assets+"php/archive/machine.php",data:{action:"view-all"},type:"GET"},buttons:[{extend:"excel",className:"dt-archMachine-excel hidden-xs",exportOptions:{columns:[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15]},filename:"MIF Archive "+getTodayDate()},{extend:"print",exportOptions:{columns:[0,1,2,3,4,5,6,7,8,9,11,12,13,14,15]},className:"dt-archMachine-print hidden-xs",customize:function(t){$(t.document.body).find("h1").remove()}},{text:"Open Search Filter",className:"dt-button-machinesearch",action:function(t,a,e,n){$(".dt-head-machinesearch").slideToggle("fast",function(){$(this).is(":visible")?e[0].innerText="Close Search Filter":(e[0].innerText="Open Search Filter",$(".dt-head-machinesearch input[type='text'], select").val(""),self.dtArchiveMachine.dtMArchiveInstance.ajax.reload(null,!0))})}}],columns:[{data:null,render:function(t,a,e,n){return n.row+1}},{data:null,title:"Company name",render:function(t,a,e,n){return"<span class='text-center'>"+isEmpty(t.company_name)+"</span>"}},{data:null,title:"S/N",render:function(t,a,e,n){return"<span class='text-left'>"+isEmpty(t.serialnumber)+"</span>"}},{data:null,title:"Brand",render:function(t,a,e,n){return"<span class='text-left'>"+isEmpty(t.brand_name)+"</span>"}},{data:null,title:"Model",render:function(t,a,e,n){return"<span class='text-left'>"+isEmpty(t.model)+"</span>"}},{data:null,title:"Category",render:function(t,a,e,n){return"<span class='text-left'>"+isEmpty(t.category)+"</span>"}},{data:null,title:"Type",render:function(t,a,e,n){return"<span class='text-left'>"+isEmpty(t.type)+"</span>"}},{data:null,title:"Page Count",render:function(t,a,e,n){return"<span class='text-left'>"+isEmpty(t.page_count)+"</span>"}},{data:null,title:"Location Area",render:function(t,a,e,n){return"<span class='text-left'>"+isEmpty(t.location_area)+"</span>"}},{data:null,title:"Department",render:function(t,a,e,n){return"<span class='text-left'>"+isEmpty(t.department)+"</span>"}},{data:null,title:"No. of User",render:function(t,a,e,n){return"<span class='text-left'>"+t.no_of_user+"</span>"}},{data:null,title:"Remarks",render:function(t,a,e,n){return"<span class='text-left'>"+isEmpty(t.remarks)+"</span>"}},{data:null,title:"Date Installed",render:function(t,a,e,n){return"<span class='text-left'>"+isEmpty(t.date_installed)+"</span>"}},{data:null,title:"Unit Owned",render:function(t,a,e,n){return"<span class='text-left'>"+isEmpty(t.unit_owned_by)+"</span>"}},{data:null,title:"Billing Type",render:function(t,a,e,n){return"<span class='text-left'>"+isEmpty(t.billing_type)+"</span>"}},{data:null,title:"Location",render:function(t,a,e,n){return"<span class='text-left'>"+isEmpty(t.branch_name)+"</span>"}},{data:null,title:"",render:function(t,a,e,n){return 1==parseInt(t.is_hard_delete)?"<button class='btn btn-xs btn-success btn-flat btn-archive-marchine' data-target='#modalFormArchiveMachine' data-toggle='modal' data-idmachine='"+t.id+"'>Retrieve</button>":""}}],columnDefs:[{targets:10,className:"never"}],deferRender:!0,fnDrawCallback:function(t){var a=JSON.parse(Cookies.get("app_module_action")),e=Cookies.get("is_client_user");return null==a||1==e?$(".btn-archive-marchine").remove():"r"==a.action_mif&&$(".btn-archive-marchine").remove(),!1},preDrawCallback:function(t){$(".dt-archMachine-excel, .dt-button-machinesearch, .dt-archMachine-print").removeClass("dt-button").addClass("btn btn-primary btn-flat btn-sm").css({"margin-bottom":"0.5em","margin-right":"0.5em"}),$(".dt-archMachine-print").text("").html("<i class='glyphicon glyphicon-print'></i>").attr("title","Print"),$(".dt-archMachine-excel").text("").html("<i class='fa fa-file-excel-o'></i>").attr("title","Export to Excel")}});var t=new $.fn.dataTable.ColumnFilter(this.dtMArchiveInstance,{1:{html:"input",type:"text",width:"70px"},2:{html:"input",type:"text",width:"70px"},3:{html:"select",type:"select",width:"80px",values:[{value:"HP",label:"HP"},{value:"OKI",label:"OKI"},{value:"CANON",label:"CANON"},{value:"EPSON",label:"EPSON"},{value:"RICOH",label:"RICOH"},{value:"KODAK",label:"KODAK"},{value:"FUJITSU",label:"FUJITSU"},{value:"SAMSUNG",label:"SAMSUNG"},{value:"BROTHER",label:"BROTHER"},{value:"FUJI_XEROX",label:"FUJI_XEROX"}]},4:{html:"input",type:"text",width:"60px"},5:{html:"select",type:"select",width:"50px",values:[{value:"MFP",label:"MFP"},{value:"SFP",label:"SFP"}]},6:{html:"select",type:"select",width:"90px",values:[{value:"MONOCHROME",label:"MONOCHROME"},{value:"COLOR",label:"COLOR"}]},7:{html:"input",type:"text",width:"50px"},8:{html:"input",type:"text",width:"100px"},9:{html:"input",type:"text",width:"100px"},10:{html:"input",type:"text",width:"50px"},11:{html:"input",type:"text",width:"50px"},12:{html:"input",type:"text",width:"70px"},13:{html:"input",type:"text",width:"70px"},14:{html:"select",type:"select",width:"90px",values:[{value:"METER READING",label:"METER READING"},{value:"PER CARTRIDGE",label:"PER CARTRIDGE"},{value:"FSMA",label:"FSMA"},{value:"FIXED MONTHLY",label:"FIXED MONTHLY"},{value:"OUTRIGHT",label:"OUTRIGHT"}]},15:{html:"input",type:"text",width:"70px"}}),a=t.dataTable.table().header();return $(a).find("tr").eq(1).addClass("dt-head-machinesearch").css("display","none"),$(t.dataTable.table().node()).off("column-visibility.dt"),this},getData:function(t){if(""!=t){var a=$("button[type='submit']");$.ajax({type:"GET",url:assets+"php/machine/machine.php",data:{action:"view_id",idmachine:t},dataType:"json",beforeSend:function(){a.button("loading")},success:function(t){$.each(t.aaData,function(t,a){$("#hdnId").val(a.id),$("#txtArchiveSerialNum").val(a.serialnumber),$("#slctArchiveBrand").val(a.brand),$("#txtArchiveModel").val(a.model),$("#slctArchiveCategory").val(isUpperCase(a.category)),$("#slctArchiveType").val(isUpperCase(a.type)),$("#txtArchivePageCount").val(a.page_count),$("#txArchiveLocation").val(a.location_area),$("#txtArchiveDepartment").val(a.department),$("#txtArchiveNoUser").val(a.no_of_user),$("#txtArchiveRemarks").val(a.remarks),$("#txtArchiveDateInstall").val(a.date_installed),$("#txtArchiveUnitOwn").val(a.unit_owned_by),$("#slctArchiveBilling").val(isUpperCase(a.billing_type)),$("#txtArchiveBranch").val(a.branches).trigger("chosen:updated"),$("#slctArchiveCompany").val(a.company_id).trigger("chosen:updated")})},error:function(t,a,e){promptMSG("warning","ID Machine not exist.")},complete:function(){a.button("reset")}})}},retrieve:function(){var t=$("button[type='submit']"),a=$("#hdnId").val(),e=$("#slctArchiveCompany").chosen().val(),n=$("#txtArchiveSerialNum").val(),s=$("#slctArchiveBrand option:selected").val(),l=$("#txtArchiveModel").val(),o=$("#slctArchiveCategory option:selected").val(),r=$("#slctArchiveType option:selected").val(),c=$("#txtArchivePageCount").val(),i=$("#txArchiveLocation").val(),d=$("#txtArchiveDepartment").val(),p=$("#txtArchiveNoUser").val(),u=$("#txtArchiveRemarks").val(),m=$("#txtArchiveDateInstall").val(),h=$("#slctArchiveBilling option:selected").val(),f=$("#txtArchiveBranch").chosen().val(),v=$("#txtArchiveUnitOwn").val(),g={action:"retrieve",user_id:Cookies.get("user_id"),id:a,company_id:e,serialnum:n,brand:s,model:l,category:o,type:r,pagecount:c,location:i,department:d,nouser:p,remarks:u,dateinstall:m,billing:h,branch:f,unit_own:v};$.ajax({type:"POST",url:assets+"php/archive/machine.php",data:g,dataType:"json",beforeSend:function(){t.button("loading")},success:function(t){0==t.aaData[0].status?promptMSG("custom","Can't retrieve due to company selected is <strong>Blocked!</strong>","<i class='fa fa-warning'></i>",null,!1,!0):self.dtArchiveMachine.dtMArchiveInstance.ajax.reload(function(){promptMSG("success-retrieve","Machine",null,null,!1,!1),$("#modalFormArchiveMachine").modal("hide")},!1)},error:function(t,a){console.log(t+a)},complete:function(){t.button("reset")}})},modalShowArchiveMachine:function(){$("#displayFormArchiveMachine").load(pages+"archive/retrieve-form.html",function(){autoDrpDown.getAllCompany("#slctArchiveCompany","100%"),autoDrpDown.getBranchNameOne("#txtArchiveBranch","100%",[1],!1),autoDrpDown.getBrandName("#slctArchiveBrand"),$("#txtArchiveSerialNum, #slctArchiveBrand, #txtArchiveModel").prop("disabled",!0)})},actions:function(){return $("#dtArchiveMachine tbody").on("click","button",function(t){t.preventDefault();var a=$(this);a.closest("tr").hasClass("selected")||(self.dtArchiveMachine.dtMArchiveInstance.$("tr.selected").removeClass("selected"),a.closest("tr").addClass("selected"));var e=a.data("idmachine");self.dtArchiveMachine.getData(e)}),this}},dtCompany={dtInstance:{},dtInstanceLogs:null,dtInstanceInOut:null,btn:$("button[type='submit']"),pageDetails:function(){return $(".content-header h1").text("Machine in Field"),$(".content-header h1").append("<small>Current</small>"),this},render:function(t){return this.dtInstance=$("#dtCompany").DataTable({dom:'Bl<"FilterMachine col-md-2 col-xs-12"><"DisplayMap">rtip',autoWidth:!1,responsive:!0,pageLength:25,lengthMenu:[[10,25,50,-1],[10,25,50,"All"]],language:{processing:'<i class="fa fa-spinner fa-pulse fa-2x fa-fw"></i><span class="sr-only">Please wait - loading...</span>',infoEmpty:"No entries to show"},processing:!0,serverSide:!0,bDestroy:!0,ordering:!1,ajax:{url:assets+"php/company/getCompanyList.php",type:"POST",dataSrc:"records",beforeSend:function(){$(".dt-buttons a").addClass("disabled")},data:function(a){var e=$("#search-company-branch").chosen().val();a.company=$("#search-company-companyname").val(),a.category=$("#search-company-category").val(),a.address=$("#search-company-address").val(),a.s_branch=1==t?e:e||t,a.contactno=$("#search-company-contactno").val(),a.accmngr=$("#search-company-accmngr").chosen().val(),a.s_location=$("#search-company-location").chosen().val(),a.delsan_comp=$("#search-company-delsan option:checked").val(),a.action_view="company",a.branch="1"==t?null:t},complete:function(){$(".dt-buttons a").removeClass("disabled")}},buttons:[{extend:"excel",className:"dt-company-excel hidden-xs",exportOptions:{columns:[1,2,3,4,5,6,7,8,9,10,11,12],stripNewlines:!1},filename:"MIF Customer "+getTodayDate()},{extend:"print",exportOptions:{columns:[0,1,2,3,4,5,6,7,8,9,10,11,12],format:{body:function(t,a,e){return 6===a?t.toString().replace(/<br\s*\/?>/gi,'"\r\n"'):t}}},className:"dt-company-print hidden-xs",customize:function(t){$(t.document.body).find(".dt-column-branches").css("max-height","0px !important")}},{text:"Add New Company",className:"dt-button-add",action:function(t,a,e,n){self.dtCompany.modalShow()}},{text:"Open Search Filter",className:"dt-button-search",action:function(t,a,e,n){$("#dt-head-search").slideToggle("fast",function(){$(this).is(":visible")?e[0].innerText="Close Search Filter":(e[0].innerText="Open Search Filter",$("#dt-head-search input[type='text']").val(""),$("#search-company-branch, #search-company-accmngr, #search-company-location").val(0).trigger("chosen:updated"),self.dtCompany.dtInstance.ajax.reload(null,!0))})}}],columns:[{data:null,render:function(t,a,e,n){return n.row+1}},{data:null,render:function(t,a,e,n){var s=t.sap_code||null;return null!=s?"<span class='text-center'><a href='#' title='View SAP Details' id='modalSapDetails' data-toggle='modal' data-target='#modalSapDetails'>"+s+"</a></span>":"---"}},{data:null,render:function(t,a,e,n){var s="",l=t.delsan_company;return"dosc"==l?s="green":"dbic"==l&&(s="blue"),"<span class='badge badge-"+s+"'>"+l.toUpperCase()+"</span>"}},{data:"company_name"},{data:"client_category"},{data:"number_of_machines"},{data:null,width:"20%",render:function(t,a,e,n){return"<span class='text-center'><a href='#' title='View Map' id='modalMap' data-toggle='modal' data-target='#modalMap'>"+t.address+"</a></span>"}},{data:null,render:function(t,a,e,n){return"<div class='text-left dt-column-branches'>"+isEmpty(t.main_location)+"</div>"}},{data:null,render:function(t,a,e,n){return"<div class='text-left dt-column-branches'>"+isEmpty(t.branches)+"</div>"}},{data:null,render:function(t,a,e,n){return"<span class='text-center'>"+isEmpty(t.contact_no)+"</span>"}},{data:null,render:function(t,a,e,n){return"<span class='text-center'>"+isEmpty(t.account_mngr_name)+"</span>"}},{data:null,render:function(t,a,e,n){return"<span class='text-center'>"+isEmpty(t.date_last_visit)+"</span>"}},{data:null,render:function(t,a,e,n){return"<button class='btn btn-xs btn-success btn-flat btnSalesHist' data-sapcode='"+t.sap_code+"'>Sales</button>"}},{data:null,render:function(t,a,e,n){return"<button class='btn btn-xs btn-success btn-flat btnEditComp' data-comp='"+t.id+"'>Edit</button>"}},{data:null,render:function(t,a,e,n){var s=t.status;return 1==s?'<a title="View MIF" class="btn btn-xs btn-success btn-flat btnViewPrinter" data-comp="'+t.id+'" data-branch="'+t.id_branch+'" data-status="'+s+'" data-compname="'+encodeURIComponent(t.company_name)+'"><i class="fa fa-list"></i></a>':""}},{data:null,render:function(t,a,e,n){return'<a title="Activity Logs" class="btn btn-xs btn-default-logs btn-flat viewMifLogs" data-comp="'+t.id+'" data-branch="'+t.id_branch+'"><i class="fa fa-clock-o"></i></a>'}}],columnDefs:[{responsivePriority:1,target:0},{responsivePriority:2,target:1},{targets:15,className:"none"}],deferRender:!0,fnDrawCallback:function(t){var a=JSON.parse(Cookies.get("app_module_action"));return null==a?$(".btnEditComp, .dt-button-add, .viewMifLogs").remove():"r"==a.action_mif&&$(".btnEditComp, .dt-button-add, .viewMifLogs").remove(),!1},preDrawCallback:function(t){$(".dt-button-search, .dt-company-excel, .dt-company-print, .dt-button-add").removeClass("dt-button").addClass("btn btn-primary btn-flat btn-sm").css({"margin-bottom":"0.5em","margin-right":"0.5em"}),$(".dt-company-print").text("").html("<i class='glyphicon glyphicon-print'></i>").attr("title","Print"),$(".dt-company-excel").text("").html("<i class='fa fa-file-excel-o'></i>").attr("title","Export to Excel")},footerCallback:function(a,e,n,s,l){var o=this.api(),r=function(t){return"string"==typeof t?1*t.replace(/[\$,]/g,""):"number"==typeof t?t:0},c=0;c=o.column(5,{page:"current"}).data().reduce(function(t,a){return r(t)+r(a)},0);var i=0,d=$("#search-company-branch").chosen().val()?$("#search-company-branch").chosen().val():t;$.ajax({type:"GET",url:assets+"php/misc/countmachines.php",data:{branch:d},dataType:"json",async:!1,success:function(t){i=t[0]},error:function(t,a,e){}}),$(o.column(4).footer()).html("Page Total:"+formatNumber(c)+" (Overall Total: "+formatNumber(i)+")").css("font-size","12px")}}),$("div.FilterMachine").html('<a href="#" id="filter-machine"><i class="fa fa-filter"></i>Filter Machine</a>'),this},modalShow:function(t){$("#displayFormCompany").load(pages+"company/form.html",function(a,e,n){$("#modalEditCompanyList").modal("show");var s=Cookies.get("location");if(autoDrpDown.getBranchNameMulti("#slctCompanyBranch","100%",s,!0),autoDrpDown.getBranchNameMulti("#slctCompanyLocation","100%",s,!0),autoDrpDown.getClientName("#slctClientMngr","100%"),autoDrpDown.getSapCompany("#txtSapCompany",!0),null!=t){$(this).find(".modal-title").text("Edit");var l=$("button[type='submit']");$.ajax({type:"GET",url:assets+"php/company/getCompanyById.php",data:{idcompany:t},dataType:"json",beforeSend:function(){l.button("loading")},success:function(t){var a=t.aaData[0];$("#hdnIdCompany").val(a.id),$("#txtEditCompany").val(a.company_name),$("#txtSapCode").val(a.sap_code),$("#txtSapCompany").val(a.sap_code).trigger("chosen:updated"),$("#OldhdnEditCompany").val(a.company_name),$("#txtEditCategory").val(a.client_category),$("#txtEditAddress").val(a.address),$("#txtContactNo").val(a.contact_no),$("input[name='delsanCompany'][value='"+a.delsan_company+"']").prop("checked",!0),$("#OldhdnClientMngr").val(a.id_client_mngr),$("#slctClientMngr").val(a.id_client_mngr).trigger("chosen:updated"),$("#slctCompanyBranch").val(null==a.id_branches?null:a.id_branches.split(",")).trigger("chosen:updated"),$("#slctCompanyLocation").val(null==a.main_location?null:a.main_location).trigger("chosen:updated"),$("#OldIdBranches").val(a.id_branches),$("#slctStatus").val(a.status),$("#txtLastVisit").val(a.date_last_visit)},error:function(t,a,e){promptMSG("warning","ID Machine not exist.")},complete:function(){l.button("reset")}})}else $(this).find(".modal-title").text("Add"),$("#slctCompanyBranch, #slctClientMngr, #slctCompanyLocation").val(0).trigger("chosen:updated")})},edit:function(){var t=$("button[type='submit']"),a=$("#hdnIdCompany").val(),e=$("#txtEditCompany").val(),n=$("#txtEditCategory").val(),s=$("#txtEditAddress").val(),l=$("#slctCompanyBranch").chosen().val()?$("#slctCompanyBranch").chosen().val().toString():"",o=$("#slctCompanyLocation").chosen().val()?$("#slctCompanyLocation").chosen().val().toString():"",r=$("#txtContactNo").val(),c=$("#txtSapCode").val(),i=$("input[name='delsanCompany']:checked").val(),d={idcompany:a,company:e,category:n,address:s,location:o,branch:l,contactno:r,accmngr:$("#slctClientMngr").chosen().val(),oldaccmngr:$("#OldhdnClientMngr").val(),oldbranch:$("#OldIdBranches").val(),status:$("#slctStatus option:selected").val(),user_id:Cookies.get("user_id"),last_visit:$("#txtLastVisit").val(),sap_code:c,delsan_comp:i};$.ajax({type:"POST",url:assets+"php/company/updateCompany.php",data:d,dataType:"json",beforeSend:function(){t.button("loading")},success:function(t){self.dtCompany.dtInstance.ajax.reload(null,!1),autoDrpDown.cacheOptComp.splice(0,1),promptMSG("success-update","Company",null,null,!0,!0)},error:function(t,a){alert(t+a)},complete:function(){t.button("reset")}})},add:function(){var t=$("button[type='submit']"),a=$("#txtEditCompany").val(),e=$("#txtEditCategory").val(),n=$("#txtEditAddress").val(),s=$("#slctCompanyBranch").chosen().val()?$("#slctCompanyBranch").chosen().val().toString():"",l=$("#slctCompanyLocation").chosen().val()?$("#slctCompanyLocation").chosen().val().toString():"",o=$("#txtContactNo").val(),r=$("#txtSapCode").val(),c=$("input[name='delsanCompany']:checked").val(),i=$("#slctClientMngr").chosen().val(),d=$("#slctStatus option:selected").val(),p=Cookies.get("user_id"),u=$("#txtLastVisit").val(),m={company:a,category:e,address:n,location:l,branch:removeDblQuote(s),contactno:o,accmngr:i,status:d,user_id:p,last_visit:u,sap_code:r,delsan_comp:c};$.ajax({type:"POST",url:assets+"php/company/addCompany.php",data:m,dataType:"json",beforeSend:function(){$("#dt-head-search input[type='text']").val(""),t.button("loading")},success:function(t,a,e){self.dtCompany.dtInstance.ajax.reload(null,!1),promptMSG("success-add","Company",null,null,!0,!0)},error:function(t,a){alert(t+a)},complete:function(){resetForm("#frmCompany"),$("#slctCompanyBranch, #slctClientMngr").val(0).trigger("chosen:updated"),t.button("reset")}})},actions:function(){return $("table#dtCompany").on("click","button, a",function(t){t.preventDefault();var a=$(this),e=a.text().toLowerCase();if(a.closest("tr").hasClass("selected")||(self.dtCompany.dtInstance.$("tr.selected").removeClass("selected"),a.closest("tr").addClass("selected")),"edit"==e){var n=$(this).data("comp");self.dtCompany.modalShow(n)}else if($(a[0]).hasClass("btnViewPrinter")){n=a.data("comp");var s=decodeURIComponent(a.data("compname")),l=a.data("branch");dtMachine.render(n,s,l)}else if($(a[0]).hasClass("viewMifLogs")){n=a.data("comp");self.dtCompany.modal_mif_logs(n)}else if("sales"==e){var o=a.data("sapcode");dtSalesHistory.render(o)}else if("search"==e)self.dtCompany.dtInstance.ajax.reload(null,!0);else if("reset"==e)$("#dt-head-search input[type='text'], #search-company-delsan").val(""),$("#search-company-branch, #search-company-accmngr, #search-company-location").val(0).trigger("chosen:updated"),self.dtCompany.dtInstance.ajax.reload(null,!0);else if($(a[0]).is("#modalMap")){var r=a.text();self.dtCompany.view_map_by_address(r)}else if($(a[0]).is("#modalSapDetails")){var c=a.text();self.dtCompany.view_sap_details(c)}}),this},modal_mif_logs:function(t){return $("#displayViewMifLogs").load(pages+"company/logs.html",function(){$("#modalMifLogs").modal("show"),self.dtCompany.dataTable_mif_logs(t)}),this},dataTable_mif_logs:function(t){var a=$("#btnSearchMifLogs");return this.dtInstanceLogs=$("#dtMifLogs").DataTable({dom:"<'search-toolbar'>lrtip",autoWidth:!1,processing:!0,serverSide:!0,ordering:!1,destroy:!0,responsive:!0,ajax:{url:assets+"php/company/mifLogs.php",type:"POST",dataSrc:"records",beforeSend:function(){a.button("loading")},data:function(a){a.company_id=t||0,a.search={value:$("#txtSearchLogs").val()||null}}},columns:[{data:null},{data:"serialnumber"},{data:"fullname"},{data:"updated_at"},{data:null},{data:null}],columnDefs:[{targets:0,render:function(t,a,e,n){return n.row+1}},{targets:4,render:function(t,a,e,n){var s="",l=t.action;return"CREATE"==l?s="badge-blue":"UPDATE"==l?s="badge-green":"REMOVE"==l&&(s="badge-red"),"<span class='badge "+s+"'>"+l+"</span>"}},{targets:5,render:function(t,a,e,n){var s=t.reason;return""!=s?'<a href="#" style="color: #c34838" data-toggle="popover" title="Reason" data-placement="right" data-content="'+s+'" data-trigger="focus"><i class="fa fa-comment"></i></a>':""}}],drawCallback:function(){$('[data-toggle="popover"]').popover().on("click",function(t){t.preventDefault()})}}),$("div.search-toolbar").html("<div class='pull-right'><input type='search' id='txtSearchLogs' placeholder='Search' style='margin-right:10px'/><a href='#' class='btn btn-flat btn-xs btn-primary' id='btnSearchMifLogs'><i class='fa fa-search' title='Search'></i></a></div>"),$("#btnSearchMifLogs").click(function(t){t.preventDefault(),self.dtCompany.dtInstanceLogs.ajax.reload()}),this},view_map_by_address:function(t){return $("#modalMap").on("shown.bs.modal",function(){$(this).find(".modal-body").html('<div><iframe width="570" height="450" frameborder="0" style="border:0" src="https://www.google.com/maps/embed/v1/place?q='+t+'&key=AIzaSyBGYTiq91KR14P14yQJAzIioEbJAl8Y9pQ" allowfullscreen></iframe></div>');var a=$(this).find("iframe").closest("div");$(window).on("resize",function(){var t=a.width();$(this).find("iframe").width(t)}.bind($(this)))}),this},view_sap_details:function(t){"---"!=t?$.ajax({type:"GET",url:assets+"php/misc/sap_details.php",data:{action:"all",sap_code:t},dataType:"json",success:function(t){var a=t.aaData;a.length>0?($("#sap_code").text(a[0].sap_code),$("#sap_company").text(a[0].company_name),$("#sap_category").text(a[0].client_category),$("#sap_address").text(a[0].address),$("#sap_location").text(a[0].location),$("#sap_contact").text(a[0].contact_no),$("#sap_acct_mngr").text(a[0].account_mngr),$(".sap-message").hide()):($(".sap-val").text("---"),$(".sap-message").show())},error:function(t,a,e){alert("Something went wrong!")}}):alert("Empty SAP Code.")},countMachines:function(t){var a=$("#date-from").val(),e=$("#date-to").val(),n=setInterval(function(){$.ajax({type:"GET",url:assets+"php/misc/countmachines.php",data:{branch:t,dateFrom:a,dateTo:e},dataType:"json",beforeSend:function(){$(".mif-info-box h3.total-mif").fadeTo("fast",.33)},success:function(t){$(".mif-info-box .inner h3.total-mif").text(t[0]),$(".mif-info-box .inner ul li h4.total-client-active").text("ACTIVE: "+t[1]),$(".mif-info-box .inner ul li h4.total-client-blocked").text("BLOCKED: "+t[2]),$(".mif-info-box .inner #total-in a").text(t[3]),$(".mif-info-box .inner #total-out a").text(t[4])},error:function(t,a,e){},complete:function(){$(".mif-info-box, .mif-info-box h3.total-mif").fadeTo("slow",1)}}),"current"!=window.location.hash.slice(2)&&window.clearInterval(n)},2e4);return this},countInOutMachine:function(){var t=$("#date-from").val(),a=$("#date-to").val();$.ajax({type:"GET",url:assets+"php/misc/count_in_out_machines.php",data:{dateFrom:t,dateTo:a},dataType:"json",success:function(t){$("#total-in a").text(t[0]),$("#total-out a").text(t[1])},error:function(t,a,e){alert("Something went wrong!")}})},viewInOutMachine:function(t){var a=t;if(a){var e=a.getAttribute("data-type").toUpperCase()+" Machines ";$("#modalInOut .modal-title").text(e),this.dtInstanceInOut=$("#dtInOut").DataTable({dom:"Blrtip",ordering:!1,autoWidth:!1,lengthMenu:[[10,25,50,-1],[10,25,50,"All"]],pageLength:15,serverSide:!0,processing:!0,language:{processing:'<i class="fa fa-spinner fa-pulse fa-2x fa-fw"></i><span class="sr-only">Please wait - loading...</span>',infoEmpty:"No entries to show"},destroy:!0,responsive:!0,buttons:[{extend:"excel",className:"btn-excel-inout hidden-xs",exportOptions:{columns:[1,2,3,4,5]},filename:e+getTodayDate()},{extend:"print",exportOptions:{columns:[0,1,2,3,4,5]},className:"btn-print-inout hidden-xs",customize:function(t){var a=$(t.document.body);a.find("h1").remove(),a.prepend("<h4>"+e+"</h4>")}}],ajax:{url:assets+"php/misc/listInOutMachines.php",type:"POST",dataSrc:"records",data:function(t){t.serialnumber=$("#search-inout-serial").val()||"",t.brand=$("#search-inout-brand option:selected").val()||"",t.model=$("#search-inout-model").val()||"",t.company=$("#search-inout-company").val()||"",t.type=a.getAttribute("data-type"),t.dateFrom=$("#date-from").val()||"",t.dateTo=$("#date-to").val()||""}},columns:[{data:null},{data:"serialnumber"},{data:"brand_name"},{data:"model"},{data:"company_name"},{data:"date"}],columnDefs:[{targets:0,render:function(t,a,e,n){return n.row+1}}],preDrawCallback:function(t){$(".btn-excel-inout, .btn-print-inout").removeClass("dt-button").addClass("btn btn-primary btn-flat btn-sm").css({"margin-bottom":"0.5em","margin-right":"0.5em"}),$(".btn-print-inout").text("").html("<i class='glyphicon glyphicon-print'></i>").attr("title","Print"),$(".btn-excel-inout").text("").html("<i class='fa fa-file-excel-o'></i>").attr("title","Export to Excel")}})}return this}},dtMachine={dtMInstance:null,dtRenderDom:null,render:function(t,a,e){return this.dtRenderDom=$("#displayViewMachine").load(pages+"machine/modal/index.html",function(n,s,l){if("success"==s){$("#modalMachineList").modal("show");var o=null==e||""==e?null:convertArrStrToInt(e);$(this).find("#machine-company").text("Machine list in "+a),self.dtMachine.dataTable(t,o).addButton(t).actions(),self.dtMachine.modalShowMachine(o)}else alert(l.status+"File not found.")}),this},dataTable:function(t,a){var e="1"==Cookies.get("location")?null:Cookies.get("location");this.dtMInstance=$("#dtMachine").DataTable({dom:"Blrtip",autoWidth:!1,responsive:!0,pageLength:10,lengthMenu:[[10,25,50,-1],[10,25,50,"All"]],oLanguage:{sLoadingRecords:'<i class="fa fa-spinner fa-pulse fa-3x fa-fw"></i><span class="sr-only">Please wait - loading...</span>',sInfoEmpty:"No entries to show"},bDestroy:!0,sPaginationType:"full_numbers",ordering:!1,ajax:{url:assets+"php/machine/getMachineListByCompany.php",data:{company_id:t,branch:e},type:"GET",beforeSend:function(){$(".btnViewPrinter").prop("disabled",!0)},complete:function(t){$.each($(".btnViewPrinter"),function(t,a){1==$(this).data("status")?$(this).prop("disabled",!1):$(this).prop("disabled",!0)})}},buttons:[{extend:"excel",className:"dt-company-excel hidden-xs",exportOptions:{columns:[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18]},filename:"MIF "+getTodayDate()},{extend:"print",exportOptions:{columns:[0,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18]},className:"dt-machine-print hidden-xs",customize:function(t){var a=$(t.document.body);a.find("h1").remove();var e=$("#modalMachineList").find(".modal-title").text();a.prepend("<h4>"+e+"</h4>")}},{text:"Open Search Filter",className:"dt-button-machinesearch",action:function(t,a,e,n){$(".dt-head-machinesearch").slideToggle("fast",function(){$(this).is(":visible")?e[0].innerText="Close Search Filter":(e[0].innerText="Open Search Filter",$(".dt-head-machinesearch input[type='text'], select").val(""),self.dtMachine.dtMInstance.ajax.reload(null,!0))})}}],columns:[{data:null,render:function(t,a,e,n){return n.row+1}},{data:null,title:"Company name",render:function(t,a,e,n){return"<span class='text-center'>"+isEmpty(t.company_name)+"</span>"}},{data:null,title:"S/N",render:function(t,a,e,n){return"<span class='text-left'>"+isEmpty(t.serialnumber)+"</span>"}},{data:null,title:"Brand",render:function(t,a,e,n){return"<span class='text-left'>"+isEmpty(t.brand_name)+"</span>"}},{data:null,title:"Model",render:function(t,a,e,n){return"<span class='text-left'>"+isEmpty(t.model)+"</span>"}},{data:null,title:"Toner",render:function(t,a,e,n){return"<span class='text-left'>"+isEmpty(t.toner)+"</span>"}},{data:null,title:"Category",render:function(t,a,e,n){return"<span class='text-left'>"+isEmpty(t.category)+"</span>"}},{data:null,title:"Type",render:function(t,a,e,n){return"<span class='text-left'>"+isEmpty(t.type)+"</span>"}},{data:null,title:"Page Count",render:function(t,a,e,n){return"<span class='text-left'>"+isEmpty(t.page_count)+"</span>"}},{data:null,title:"Location Area",render:function(t,a,e,n){return"<span class='text-left'>"+isEmpty(t.location_area)+"</span>"}},{data:null,title:"Department",render:function(t,a,e,n){return"<span class='text-left'>"+isEmpty(t.department)+"</span>"}},{data:null,title:"No. of User",render:function(t,a,e,n){return"<span class='text-left'>"+t.no_of_user+"</span>"}},{data:null,title:"Remarks",render:function(t,a,e,n){return"<span class='text-left'>"+isEmpty(t.remarks)+"</span>"}},{data:null,title:"Date Installed",render:function(t,a,e,n){return"<span class='text-left'>"+isEmpty(t.date_installed)+"</span>"}},{data:null,title:"Unit Owned",render:function(t,a,e,n){return"<span class='text-left'>"+isEmpty(t.unit_owned_by)+"</span>"}},{data:null,title:"Account Manager",render:function(t,a,e,n){return"<span class='text-left'>"+isEmpty(t.account_manager)+"</span>"}},{data:null,title:"Date last visit",render:function(t,a,e,n){return"<span class='text-left'>"+isEmpty(t.date_last_visit)+"</span>"}},{data:null,title:"Billing Type",render:function(t,a,e,n){return"<span class='text-left'>"+isEmpty(t.billing_type)+"</span>"}},{data:null,title:"Location",render:function(t,a,e,n){return"<span class='text-left'>"+isEmpty(t.branches)+"</span>"}},{data:null,render:function(t,a,e,n){return"<button class='btn btn-xs btn-success btn-flat btnViewUpdateMachine' data-target='#modalFormMachine' data-toggle='modal' data-machine='"+t.id+"'>Update</button>"}},{data:null,render:function(t,a,e,n){return"<a href='#' class='btn btn-xs btn-warning btn-flat btnRemoveMachine' data-machine='"+t.id+"' title='Remove'><i class='fa fa-trash'></i></a>"}}],columnDefs:[{targets:1,className:"never"},{targets:15,className:"none"},{targets:16,className:"none"}],deferRender:!0,fnDrawCallback:function(t){var a=JSON.parse(Cookies.get("app_module_action")),e=Cookies.get("is_client_user");return null==a||1==e?$(".btnViewUpdateMachine, .dt-button-machineadd, .btnRemoveMachine").remove():"r"==a.action_mif&&$(".btnViewUpdateMachine, .dt-button-machineadd, .btnRemoveMachine").remove(),!1},preDrawCallback:function(t){$(".dt-company-excel, .dt-button-machinesearch, .dt-machine-print").removeClass("dt-button").addClass("btn btn-primary btn-flat btn-sm").css({"margin-bottom":"0.5em","margin-right":"0.5em"}),$(".dt-machine-print").text("").html("<i class='glyphicon glyphicon-print'></i>").attr("title","Print"),$(".dt-company-excel").text("").html("<i class='fa fa-file-excel-o'></i>").attr("title","Export to Excel")}});var n=new $.fn.dataTable.ColumnFilter(this.dtMInstance,{1:{html:"input",type:"text",width:"70px"},2:{html:"input",type:"text",width:"70px"},3:{html:"select",type:"select",width:"80px",values:[{value:"HP",label:"HP"},{value:"OKI",label:"OKI"},{value:"CANON",label:"CANON"},{value:"EPSON",label:"EPSON"},{value:"RICOH",label:"RICOH"},{value:"KODAK",label:"KODAK"},{value:"FUJITSU",label:"FUJITSU"},{value:"SAMSUNG",label:"SAMSUNG"},{value:"BROTHER",label:"BROTHER"},{value:"FUJI_XEROX",label:"FUJI_XEROX"}]},4:{html:"input",type:"text",width:"60px"},5:{html:"input",type:"text",width:"60px"},6:{html:"select",type:"select",width:"50px",values:[{value:"MFP",label:"MFP"},{value:"SFP",label:"SFP"}]},7:{html:"select",type:"select",width:"90px",values:[{value:"MONOCHROME",label:"MONOCHROME"},{value:"COLOR",label:"COLOR"}]},8:{html:"input",type:"text",width:"50px"},9:{html:"input",type:"text",width:"100px"},10:{html:"input",type:"text",width:"100px"},11:{html:"input",type:"text",width:"50px"},12:{html:"input",type:"text",width:"50px"},13:{html:"input",type:"text",width:"70px"},14:{html:"input",type:"text",width:"70px"},15:{html:"select",type:"select",width:"90px",values:[{value:"METER READING",label:"METER READING"},{value:"PER CARTRIDGE",label:"PER CARTRIDGE"},{value:"FSMA",label:"FSMA"},{value:"FIXED MONTHLY",label:"FIXED MONTHLY"},{value:"OUTRIGHT",label:"OUTRIGHT"}]},16:{html:"input",type:"text",width:"70px"}}),s=n.dataTable.table().header();return $(s).find("tr").eq(1).addClass("dt-head-machinesearch").css("display","none"),$(n.dataTable.table().node()).off("column-visibility.dt"),this},modalShowMachine:function(t){$("#displayFormMachine").load(pages+"machine/modal/form.html",function(){$("#modalFormMachine .modal-title").attr("data-update-opt","1"),autoDrpDown.getAllCompany("#slctCompany","60%"),autoDrpDown.getBranchNameOne("#txtBranch","100%",t,!0),autoDrpDown.getBrandName("#slctBrands")})},getData:function(t){if(null!=t){$("#displayFormMachine").find(".modal-title").text("Update Machine");var a=$("button[type='submit']");$.ajax({type:"GET",url:assets+"php/machine/machine.php",data:{action:"view_id",idmachine:t},dataType:"json",beforeSend:function(){a.button("loading")},success:function(t){$.each(t.aaData,function(t,a){$("#hdnId").val(a.id),$("#hdnOldSerial, #txtSerialNum").val(a.serialnumber),$("#slctBrands").val(a.brand),$("#txtModel").val(a.model),$("#slctCategory").val(isUpperCase(a.category)),$("#slctType").val(isUpperCase(a.type)),$("#txtPageCount").val(a.page_count),$("#txtLocation").val(a.location_area),$("#txtDepartment").val(a.department),$("#txtNoUser").val(a.no_of_user),$("#txtRemarks").val(a.remarks),$("#txtDateInstall").val(a.date_installed),$("#txtUnitOwn").val(a.unit_owned_by),$("#slctBilling").val(isUpperCase(a.billing_type)),$("#txtBranch").val(a.branches).trigger("chosen:updated"),$(autoDrpDown.cacheOptCompInst).val(a.company_id).trigger("chosen:updated"),$(autoDrpDown.cacheOptCompInst).prop("disabled",!1).trigger("chosen:updated")})},error:function(t,a,e){promptMSG("warning","ID Machine not exist.")},complete:function(){a.button("reset")}})}else $("#displayFormMachine").find(".modal-title").text("Add New Machine")},update:function(){var t=$("button[type='submit']"),a={action:"update",idmachine:$("#hdnId").val(),company_id:$("#slctCompany").chosen().val(),serialnum:$("#txtSerialNum").val(),brand:$("#slctBrands option:selected").val(),model:$("#txtModel").val(),category:$("#slctCategory option:selected").val(),type:$("#slctType option:selected").val(),pagecount:$("#txtPageCount").val(),location:$("#txtLocation").val(),department:$("#txtDepartment").val(),nouser:$("#txtNoUser").val(),remarks:$("#txtRemarks").val(),dateinstall:$("#txtDateInstall").val(),billing:$("#slctBilling option:selected").val(),branch:$("#txtBranch").chosen().val(),unit_own:$("#txtUnitOwn").val(),user_id:Cookies.get("user_id")};$.ajax({type:"POST",url:assets+"php/machine/machine.php",data:a,dataType:"json",beforeSend:function(){t.button("loading")},success:function(t){0==t.aaData[0].status?promptMSG("custom","Can't update due to company selected is <strong>Blocked!</strong>","<i class='fa fa-warning'></i>",null,!1,!0):self.dtMachine.dtMInstance.ajax.reload(function(){promptMSG("success-update","Machine",null,"",!1,!0),dtCompany.dtInstance.ajax.reload(null,!1)},!1)},error:function(t,a){alert(t+a)},complete:function(){t.button("reset")}})},addButton:function(t){var a=$('<a class="btn btn-primary btn-flat btn-sm dt-button-machineadd" href="#" data-target="#modalFormMachine" style="margin-right:0.5em; margin-bottom:0.5em" data-toggle="modal"><span>Add New Machine</span></a>').insertBefore(".dt-button-machinesearch");return $(a).on("click",function(){$(autoDrpDown.cacheOptCompInst).val(t).trigger("chosen:updated"),$(autoDrpDown.cacheOptCompInst).prop("disabled",!0).trigger("chosen:updated"),$("#displayFormMachine").find(".modal-title").text("Add New Machine"),$("#txtBranch").val(0).trigger("chosen:updated"),$("#btnSubmit").text("Save")}),this},add:function(){var t=$("button[type='submit']"),a={action:"add",company_id:$("#slctCompany").chosen().val(),serialnum:$("#txtSerialNum").val(),brand:$("#slctBrands option:selected").val(),model:$("#txtModel").val(),category:$("#slctCategory option:selected").val(),type:$("#slctType option:selected").val(),pagecount:$("#txtPageCount").val(),location:$("#txtLocation").val(),department:$("#txtDepartment").val(),nouser:$("#txtNoUser").val(),remarks:$("#txtRemarks").val(),dateinstall:$("#txtDateInstall").val(),billing:$("#slctBilling option:selected").val(),branch:$("#txtBranch").chosen().val(),unit_own:$("#txtUnitOwn").val(),user_id:Cookies.get("user_id")};$.ajax({type:"POST",url:assets+"php/machine/machine.php",data:a,dataType:"json",beforeSend:function(){$(".dt-head-machinesearch input[type='text'], .dt-head-machinesearch select").val(""),t.button("loading")},success:function(t,a,e){self.dtMachine.dtMInstance.ajax.reload(function(){promptMSG("success-add","Machine",null,"",!1,!0),dtCompany.dtInstance.ajax.reload(null,!1)},!1).page("last")},error:function(t,a){alert(t+a)},complete:function(){t.button("reset"),$("#frmMachine input ,#frmMachine select:not('#slctCompany')").val(""),$("#txtBranch").val(0).trigger("chosen:updated")}})},showRemove:function(t){var a=t;$("#displayRemoveMachine").load(pages+"archive/remove-machine.html",function(t){$("#modalRemoveMachine").modal("show"),$("#modalRemoveMachine .modal-title").attr("data-remove-opt","1"),$("#removehdnId").val(a),autoDrpDown.getMachineStatus("#slctMachineStatus")})},remove:function(t){var a=$("button[type='submit']"),e={action:"remove",id:$("#removehdnId").val(),reason:$("#txtReason").val(),status:$("#slctMachineStatus option:selected").val(),status_action:$("#slctMachineStatus option:selected").data("action"),user_id:Cookies.get("user_id")};$.ajax({type:"POST",url:assets+"php/archive/machine.php",data:e,dataType:"json",beforeSend:function(){a.button("loading")},success:function(t,a,e){self.dtMachine.dtMInstance.ajax.reload(function(){promptMSG("remove","Machine",null,null,!1),dtCompany.dtInstance.ajax.reload(null,!1),$(".mif-modalPromptMSG").on("click","button",function(){$("#modalRemoveMachine").modal("hide")})},!0)},error:function(t,a){alert(t+a)},complete:function(){resetForm("#frmRemoveMachine"),a.button("reset")}})},actions:function(){return $("#dtMachine tbody").on("click","button,a",function(t){t.preventDefault();var a=$(this);if(a.closest("tr").hasClass("selected")||(self.dtMachine.dtMInstance.$("tr.selected").removeClass("selected"),a.closest("tr").addClass("selected")),$(this).hasClass("btnViewUpdateMachine")){var e=a.data("machine");self.dtMachine.getData(e),$("#btnSubmit").text("Update")}if($(a[0]).hasClass("btnRemoveMachine")){var n=$(this).data("machine");self.dtMachine.showRemove(n)}}),this}},dtFilterMachine={dtFInstance:null,dtRenderDom:null,showModal:function(){return $("#filter-machine").click(function(t){t.preventDefault(),$("#displayFilterMachine").load(pages+"company/filter-machine.html",function(t,a,e){if($("#modalFilterMachine").modal("show"),"success"==a){var n=convertArrStrToInt(Cookies.get("location"))||[1],s="1"!=Cookies.get("location");autoDrpDown.getBrandName("#fltr-slctbrand"),autoDrpDown.getAllCompany("#fltr-slctcompany","150px"),autoDrpDown.getBranchNameOne("#fltr-slctlocation","120px",n,s),self.dtFilterMachine.autoComplete().showFormMachine().actions(),$("#fltr-slctcompany, #fltr-slctlocation").val(0).trigger("chosen:updated")}else alert(e.status+"File not found.")})}),this},autoComplete:function(){return $("#fltr-serialnum").autocomplete({dropdownWidth:"auto",appendMethod:"replace",source:[function(t,a){return""!=t&&$.getJSON("assets/php/misc/serialnumberlist.php?serialnumber="+encodeURIComponent(t),function(t){a(t)}),null}]}),$("#fltr-model").autocomplete({dropdownWidth:"auto",appendMethod:"replace",style:{display:"inline"},source:[function(t,a){return""!=t&&$.getJSON("assets/php/misc/models.php?model="+encodeURIComponent(t),function(t){a(t)}),null}]}),this},render:function(t){var a=$("button#btnFilterSearch");return this.dtFInstance=$("#dtFilterMachine").DataTable({dom:"lBtip",autoWidth:!1,responsive:!0,pageLength:10,lengthMenu:[[10,25,50,-1],[10,25,50,"All"]],oLanguage:{bProcessing:!0,sProcessing:"Loading...",sLoadingRecords:'<i class="fa fa-spinner fa-pulse fa-3x fa-fw"></i><span class="sr-only">Please wait - loading...</span>'},destroy:!0,sPaginationType:"full_numbers",buttons:[{extend:"excel",className:"dt-searchSN-excel hidden-xs",exportOptions:{columns:[1,2,3,4,5,6,7,8,9,10,11,12,14,15]},filename:"MIF "+getTodayDate()}],ordering:!1,ajax:{url:assets+"php/machine/getMachineListByCompany.php",data:function(t){t.serialnumber=$("#fltr-serialnum").val(),t.brand=$("#fltr-slctbrand option:selected").val()||null,t.model=$("#fltr-model").val(),t.category=$("#fltr-slctcategory option:selected").val()||"",t.type=$("#fltr-slcttype option:selected").val()||"",t.company=$("#fltr-slctcompany").chosen().val()||null,t.branch=$("#fltr-slctlocation").chosen().val()||null},type:"GET",beforeSend:function(){a.button("loading")},complete:function(){a.button("reset")}},columns:[{data:null,render:function(t,a,e,n){return n.row+1}},{data:null,title:"Company name",render:function(t,a,e,n){return"<span class='text-center'>"+isEmpty(t.company_name)+"</span>"}},{data:null,title:"S/N",render:function(t,a,e,n){return"<span class='text-left'>"+isEmpty(t.serialnumber)+"</span>"}},{data:null,title:"Brand",render:function(t,a,e,n){return"<span class='text-left'>"+isEmpty(t.brand_name)+"</span>"}},{data:null,title:"Model",render:function(t,a,e,n){return"<span class='text-left'>"+isEmpty(t.model)+"</span>"}},{data:null,title:"Toner",render:function(t,a,e,n){return"<span class='text-left'>"+isEmpty(t.toner)+"</span>"}},{data:null,title:"Category",render:function(t,a,e,n){return"<span class='text-left'>"+isEmpty(t.category)+"</span>"}},{data:null,title:"Type",render:function(t,a,e,n){return"<span class='text-left'>"+isEmpty(t.type)+"</span>"}},{data:null,title:"Page Count",render:function(t,a,e,n){return"<span class='text-left'>"+isEmpty(t.page_count)+"</span>"}},{data:null,title:"Location Area",render:function(t,a,e,n){return"<span class='text-left'>"+isEmpty(t.location_area)+"</span>"}},{data:null,title:"Department",render:function(t,a,e,n){return"<span class='text-left'>"+isEmpty(t.department)+"</span>"}},{data:null,title:"No. of User",render:function(t,a,e,n){return"<span class='text-left'>"+t.no_of_user+"</span>"}},{data:null,title:"Remarks",render:function(t,a,e,n){return"<span class='text-left'>"+isEmpty(t.remarks)+"</span>"}},{data:null,title:"Date Installed",render:function(t,a,e,n){return"<span class='text-left'>"+isEmpty(t.date_installed)+"</span>"}},{data:null,title:"Unit Owned",render:function(t,a,e,n){return"<span class='text-left'>"+isEmpty(t.unit_owned_by)+"</span>"}},{data:null,title:"Billing Type",render:function(t,a,e,n){return"<span class='text-left'>"+isEmpty(t.billing_type)+"</span>"}},{data:null,title:"Location",render:function(t,a,e,n){return"<span class='text-left'>"+isEmpty(t.branches)+"</span>"}},{data:null,title:"",render:function(t,a,e,n){return"<button class='btn btn-xs btn-success btn-flat btnViewUpdateMachine' data-target='#modalFormMachine' data-toggle='modal' data-machine='"+t.id+"'>Update</button>"}},{data:null,title:"",render:function(t,a,e,n){return"<a href='#' class='btn btn-xs btn-warning btn-flat btnRemoveMachine' data-machine='"+t.id+"' title='Remove'><i class='fa fa-trash'></i></a>"}}],deferRender:!0,fnDrawCallback:function(t){var a=JSON.parse(Cookies.get("app_module_action"));return null==a?$(".btnViewUpdateMachine, .btnRemoveMachine").remove():"r"==a.action_mif&&$(".btnViewUpdateMachine, .btnRemoveMachine").remove(),!1},preDrawCallback:function(t){$(".dt-searchSN-print, .dt-searchSN-excel").removeClass("dt-button").addClass("btn btn-primary btn-flat btn-sm").css({"margin-bottom":"0.5em","margin-right":"0.5em"}),$(".dt-searchSN-print").text("").html("<i class='glyphicon glyphicon-print'></i>"),$(".dt-searchSN-excel").text("").html("<i class='fa fa-file-excel-o'></i>").attr("title","Export to Excel")}}),this},showFormMachine:function(){return $("#displayFormMachine").load(pages+"machine/modal/form.html",function(){$("#modalFormMachine .modal-title").attr("data-update-opt","2");var t=convertArrStrToInt(Cookies.get("location"))||[1],a="1"!=Cookies.get("location");autoDrpDown.getBranchNameOne("#txtBranch","100%",t,a),autoDrpDown.getAllCompany("#slctCompany","60%"),autoDrpDown.getBrandName("#slctBrands")}),this},getData:function(t){null!=t?($("#displayFormMachine").find(".modal-title").text("Update Machine"),$.ajax({type:"GET",url:assets+"php/machine/machine.php",data:{action:"view_id",idmachine:t},dataType:"json",success:function(t){$.each(t.aaData,function(t,a){$("#hdnId").val(a.id),$("#hdnOldSerial").val(a.serialnumber),$("#txtSerialNum").val(a.serialnumber),$("#slctBrands").val(a.brand),$("#txtModel").val(a.model),$("#slctCategory").val(isUpperCase(a.category)),$("#slctType").val(isUpperCase(a.type)),$("#txtPageCount").val(a.page_count),$("#txtLocation").val(a.location_area),$("#txtDepartment").val(a.department),$("#txtNoUser").val(a.no_of_user),$("#txtRemarks").val(a.remarks),$("#txtDateInstall").val(a.date_installed),$("#txtUnitOwn").val(a.unit_owned_by),$("#slctBilling").val(isUpperCase(a.billing_type)),$("#txtBranch").val(a.branches).trigger("chosen:updated"),$("#slctCompany").val(a.company_id).trigger("chosen:updated")})},error:function(t,a,e){}})):$("#displayFormMachine").find(".modal-title").text("Add New Machine")},update:function(){var t={action:"update",idmachine:$("#hdnId").val(),company_id:$("#slctCompany").chosen().val(),serialnum:$("#txtSerialNum").val(),brand:$("#slctBrands option:selected").val(),model:$("#txtModel").val(),category:$("#slctCategory option:selected").val(),type:$("#slctType option:selected").val(),pagecount:$("#txtPageCount").val(),location:$("#txtLocation").val(),department:$("#txtDepartment").val(),nouser:$("#txtNoUser").val(),remarks:$("#txtRemarks").val(),dateinstall:$("#txtDateInstall").val(),unit_own:$("#txtUnitOwn").val(),billing:$("#slctBilling option:selected").val(),branch:$("#txtBranch").chosen().val(),user_id:Cookies.get("user_id")};$.ajax({type:"POST",url:assets+"php/machine/machine.php",data:t,dataType:"json",success:function(t){0==t.aaData[0].status?promptMSG("custom","Can't update due to company selected is <strong>Blocked!</strong>","<i class='fa fa-warning'></i>",null,!1,!0):self.dtFilterMachine.dtFInstance.ajax.reload(function(){promptMSG("success-update","Machine",null,null,!0,!0),dtCompany.dtInstance.ajax.reload(null,!1),$(".mif-modalPromptMSG").on("click","button",function(){$("#modalRemoveMachine").modal("hide")})},!1)},error:function(t,a){alert(t+a)}})},showRemove:function(t){var a=t;$("#displayRemoveMachine").load(pages+"archive/remove-machine.html",function(t){$("#modalRemoveMachine").modal("show"),$("#modalRemoveMachine .modal-title").attr("data-remove-opt","2"),$("#removehdnId").val(a),autoDrpDown.getMachineStatus("#slctMachineStatus")})},remove:function(t){var a={action:"remove",id:$("#removehdnId").val(),reason:$("#txtReason").val(),status:$("#slctMachineStatus option:selected").val(),status_action:$("#slctMachineStatus option:selected").data("action"),user_id:Cookies.get("user_id")};$.ajax({type:"POST",url:assets+"php/archive/machine.php",data:a,dataType:"json",success:function(t,a,e){self.dtFilterMachine.dtFInstance.ajax.reload(function(){promptMSG("remove","Machine",null,null,!1),dtCompany.dtInstance.ajax.reload(null,!1),$(".mif-modalPromptMSG").on("click","button",function(){$("#modalRemoveMachine").modal("hide")})},!0)},error:function(t,a){alert(t+a)},complete:function(){resetForm("#frmRemoveMachine")}})},actions:function(){return $("#modalFilterMachine").on("shown.bs.modal",function(){$(this).on("click","button,a",function(t){t.preventDefault();var a=$(this).data("machine");if($(this).hasClass("btnViewUpdateMachine")&&(self.dtFilterMachine.getData(a),$("#btnSubmit").text("Update")),$(this).hasClass("btnRemoveMachine")){var e=$(this).data("machine");self.dtFilterMachine.showRemove(e)}})}),this}},dtSalesHistory={dtInstance:null,dtRenderedDom:null,render:function(t){return $("#displaySalesHistory").load(pages+"company/sap-sales-history.html",function(){$("#modalSalesHistory").modal("show"),self.dtSalesHistory.dataTable(t).actions()}),this},dataTable:function(t){return this.dtInstance=$("#dtSalesHistory").DataTable({dom:"Blrtip",autoWidth:!1,responsive:!0,pageLength:10,lengthMenu:[[10,25,50,-1],[10,25,50,"All"]],oLanguage:{sLoadingRecords:'<i class="fa fa-spinner fa-pulse fa-3x fa-fw"></i><span class="sr-only">Please wait - loading...</span>',sInfoEmpty:"No entries to show"},processing:!0,serverSide:!0,bDestroy:!0,ordering:!1,ajax:{url:assets+"php/company/sapSalesHistory.php",type:"POST",dataSrc:"records",data:function(a){delete a.columns,a.sap_code=t,a.company=$("#search-sales-company").val()||"",a.acc_manager=$("#search-sales-acctmngr").val()||"",a.fiscal_year=$("#search-sales-year").val()||"",a.month=$("#search-sales-month").val()||""}},buttons:[{extend:"excel",className:"dt-company-excel hidden-xs",exportOptions:{columns:[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15]},filename:"Sales History "+getTodayDate()},{extend:"print",exportOptions:{columns:[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15]},className:"dt-machine-print hidden-xs",customize:function(t){var a=$(t.document.body);a.find("h1").remove(),a.prepend("<h4>SAP Sales History</h4>")}},{text:"Open Search Filter",className:"dt-button-machinesearch",action:function(t,a,e,n){$(".dt-headsearch").slideToggle("fast",function(){$(this).is(":visible")?e[0].innerText="Close Search Filter":(e[0].innerText="Open Search Filter",$(".dt-head-headsearch input[type='text'], select").val(""),self.dtSalesHistory.dtInstance.ajax.reload(null,!0))})}}],columns:[{data:null,render:function(t,a,e,n){return n.row+1}},{data:null,render:function(t,a,e,n){return"<span class='text-left'>"+isEmpty(t.company_name)+"</span>"}},{data:null,render:function(t,a,e,n){return"<span class='text-left'>"+isEmpty(t.acc_manager)+"</span>"}},{data:null,render:function(t,a,e,n){return"<span class='text-left'>"+isEmpty(t.fiscal_year)+"</span>"}},{data:null,render:function(t,a,e,n){return"<span class='text-left'>"+isEmpty(t.month)+"</span>"}},{data:null,render:function(t,a,e,n){return"<span class='text-left'>"+isEmpty(t.doc_num)+"</span>"}},{data:null,render:function(t,a,e,n){return"<span class='text-left'>"+isEmpty(t.doc_date)+"</span>"}},{data:null,render:function(t,a,e,n){return"<span class='text-left'>"+isEmpty(t.baseref)+"</span>"}},{data:null,render:function(t,a,e,n){return"<span class='text-left'>"+isEmpty(t.customer_po)+"</span>"}},{data:null,render:function(t,a,e,n){return"<span class='text-left'>"+isEmpty(t.item_code)+"</span>"}},{data:null,render:function(t,a,e,n){return"<span class='text-left'>"+isEmpty(t.description)+"</span>"}},{data:null,render:function(t,a,e,n){return"<span class='text-left'>"+t.quantity+"</span>"}},{data:null,render:function(t,a,e,n){return"<span class='text-left'>"+isEmpty(t.pricevat)+"</span>"}},{data:null,render:function(t,a,e,n){return"<span class='text-left'>"+isEmpty(t.vat)+"</span>"}},{data:null,render:function(t,a,e,n){return"<span class='text-left'>"+isEmpty(t.gross)+"</span>"}},{data:null,render:function(t,a,e,n){return"<span class='text-left'>"+isEmpty(t.net)+"</span>"}}],deferRender:!0,preDrawCallback:function(t){$(".dt-company-excel, .dt-button-machinesearch, .dt-machine-print").removeClass("dt-button").addClass("btn btn-primary btn-flat btn-sm").css({"margin-bottom":"0.5em","margin-right":"0.5em"}),$(".dt-machine-print").text("").html("<i class='glyphicon glyphicon-print'></i>").attr("title","Print"),$(".dt-company-excel").text("").html("<i class='fa fa-file-excel-o'></i>").attr("title","Export to Excel")}}),this},actions:function(){return $("table#dtSalesHistory").on("click","button",function(t){t.preventDefault();var a=$(this),e=a.text().toLowerCase();a.closest("tr").hasClass("selected")||(self.dtSalesHistory.dtInstance.$("tr.selected").removeClass("selected"),a.closest("tr").addClass("selected")),"search"==e?(console.log("clicked"),self.dtSalesHistory.dtInstance.ajax.reload(null,!0)):"reset"==e&&($(".dt-headsearch input[type='text']").val(""),self.dtSalesHistory.dtInstance.ajax.reload(null,!0))}),this}},dtBrand={dtInstance:{},render:function(){return this.dtInstance=$("#dtBrand").DataTable({dom:"flrtip",autoWidth:!1,responsive:!0,pageLength:10,lengthMenu:[[10,25,50,-1],[10,25,50,"All"]],oLanguage:{bProcessing:!0,sLoadingRecords:'<i class="fa fa-spinner fa-pulse fa-3x fa-fw"></i><span class="sr-only">Please wait - loading...</span>',sInfoEmpty:"No entries to show"},bDestroy:!0,bStateSave:!0,ordering:!1,ajax:{url:assets+"php/settings/brand.php",type:"GET",data:{action:"view-all"}},columns:[{data:null,render:function(t,a,e,n){return n.row+1}},{data:null,render:function(t,a,e,n){return"<span class='text-center'>"+t.brand_name+"</span>"}},{data:null,render:function(t,a,e,n){return 1==t.status?"<span class='text-left'> Active </span>":"<span class='text-left' style='color:#dd4b39'> Inactive </span>"}},{data:null,render:function(t,a,e,n){return"<button class='btn btn-xs btn-success btn-flat btnUpdateBrand' data-brand='"+t.id+"'>Update</button>"}}],columnDefs:[{responsivePriority:1,target:0},{responsivePriority:2,width:"20%",target:1}],deferRender:!0,preDrawCallback:function(t){$(".dt-button-addbrand").removeClass("dt-button").addClass("btn btn-primary btn-flat btn-sm").css({"margin-bottom":"0.5em","margin-right":"0.5em"})}}),this},modalShow:function(t){$("#displayFormBrand").load(pages+"settings/form-brand.html",function(a,e,n){$("#modalFormBrand").modal("show"),null!=t?($(this).find(".modal-title").text("Update Brand"),$.ajax({type:"GET",url:assets+"php/settings/brand.php",data:{action:"view",idbrand:t},dataType:"json",success:function(t){$.each(t.aaData,function(t,a){$("#hdnIdBrand").val(a.id),$("#txtSettingsBrand").val(a.brand_name),$("#hdnOldBrand").val(a.brand_name),$("#slctBrandStatus").val(a.status)})},error:function(t,a,e){}})):$(this).find(".modal-title").text("Add Brand")})},update:function(){var t={action:"update",idbrand:$("#hdnIdBrand").val(),brandname:$("#txtSettingsBrand").val(),status:$("#slctBrandStatus option:selected").val()};$.ajax({type:"POST",url:assets+"php/settings/brand.php",data:t,dataType:"json",success:function(t){self.dtBrand.dtInstance.ajax.reload(null,!1),autoDrpDown.cacheOptBrands.splice(0,1)},error:function(t,a,e){console.log(a+e)}})},add:function(){var t={action:"add",brandname:$("#txtSettingsBrand").val(),status:$("#slctBrandStatus option:selected").val()};$.ajax({type:"POST",url:assets+"php/settings/brand.php",data:t,dataType:"json",success:function(t){self.dtBrand.dtInstance.ajax.reload(null,!1).page("last"),autoDrpDown.cacheOptBrands.splice(0,1)},error:function(t,a,e){console.log(a+e)},complete:function(){resetForm("#frmSettingsBrand")}})},actions:function(){return $(".box-brand").on("click","button",function(){var t=$(this);if(t.closest("tr").hasClass("selected")||(self.dtBrand.dtInstance.$("tr.selected").removeClass("selected"),t.closest("tr").addClass("selected")),"Update"==t.text()){var a=$(this).data("brand");self.dtBrand.modalShow(a)}else self.dtBrand.modalShow()}),this}},dtBranch={dtInstance:{},pageDetails:function(){return $(".content-header h1").text("Machine in Field"),$(".content-header h1").append("<small>Settings</small>"),this},render:function(){return this.dtInstance=$("#dtBranch").DataTable({dom:"flrtip",autoWidth:!1,responsive:!0,pageLength:10,lengthMenu:[[10,25,50,-1],[10,25,50,"All"]],oLanguage:{bProcessing:!0,sLoadingRecords:'<i class="fa fa-spinner fa-pulse fa-3x fa-fw"></i><span class="sr-only">Please wait - loading...</span>',sInfoEmpty:"No entries to show"},bDestroy:!0,bStateSave:!0,ordering:!1,ajax:{url:assets+"php/misc/locations.php",type:"GET"},columns:[{data:null,render:function(t,a,e,n){return n.row+1}},{data:null,render:function(t,a,e,n){return"<span class='text-center'>"+t.branch_name+"</span>"}},{data:null,render:function(t,a,e,n){return 1==t.status?"<span class='text-left'> Active </span>":"<span class='text-left' style='color:#dd4b39'> Inactive </span>"}},{data:null,render:function(t,a,e,n){return 1!=t.id?"<button class='btn btn-xs btn-success btn-flat btnUpdateBranch' data-branch='"+t.id+"'>Update</button>":""}}],columnDefs:[{responsivePriority:1,target:0},{responsivePriority:2,width:"20%",target:1}],deferRender:!0,preDrawCallback:function(t){$(".dt-button-addbranch").removeClass("dt-button").addClass("btn btn-primary btn-flat btn-sm").css({"margin-bottom":"0.5em","margin-right":"0.5em"})}}),this},modalShow:function(t){$("#displayFormBranch").load(pages+"settings/form-branch.html",function(a,e,n){$("#modalFormBranch").modal("show"),null!=t?($(this).find(".modal-title").text("Update Location"),$.ajax({type:"GET",url:assets+"php/settings/location.php",data:{action:"view",idbranch:t},dataType:"json",success:function(t){$.each(t.aaData,function(t,a){$("#hdnId").val(a.id),$("#txtSettingsBranch").val(a.branch_name),$("#hdnOldBranch").val(a.branch_name),$("#slctLocationStatus").val(a.status)})},error:function(t,a,e){}})):$(this).find(".modal-title").text("Add Location")})},update:function(){var t={action:"update",idbranch:$("#hdnId").val(),branchname:$("#txtSettingsBranch").val(),status:$("#slctLocationStatus option:selected").val()};$.ajax({type:"POST",url:assets+"php/settings/location.php",data:t,dataType:"json",success:function(t){self.dtBranch.dtInstance.ajax.reload(null,!1),autoDrpDown.cacheOptBranch.splice(0,1),autoDrpDown.cacheOptBranchOne.splice(0,1)},error:function(t,a,e){alert(a+e)}})},add:function(){var t={action:"add",branchname:$("#txtSettingsBranch").val(),status:$("#slctLocationStatus option:selected").val()};$.ajax({type:"POST",url:assets+"php/settings/location.php",data:t,dataType:"json",success:function(t){self.dtBranch.dtInstance.ajax.reload(null,!1).page("last"),autoDrpDown.cacheOptBranch.splice(0,1),autoDrpDown.cacheOptBranchOne.splice(0,1)},error:function(t,a,e){alert(a+e)},complete:function(){resetForm("#frmSettingsBranch")}})},actions:function(){return $("table#dtBranch").on("click","button",function(){var t=$(this);if(t.closest("tr").hasClass("selected")||(self.dtBranch.dtInstance.$("tr.selected").removeClass("selected"),t.closest("tr").addClass("selected")),"Update"==t.text()){var a=$(this).data("branch");self.dtBranch.modalShow(a)}}),$("#addBranch").click(function(t){self.dtBranch.modalShow()}),this}},dtStatus={dtInstance:{},render:function(){return this.dtInstance=$("#dtStatus").DataTable({dom:"flrtip",autoWidth:!1,responsive:!0,pageLength:10,lengthMenu:[[10,25,50,-1],[10,25,50,"All"]],oLanguage:{bProcessing:!0,sLoadingRecords:'<i class="fa fa-spinner fa-pulse fa-3x fa-fw"></i><span class="sr-only">Please wait - loading...</span>',sInfoEmpty:"No entries to show"},bDestroy:!0,bStateSave:!0,ordering:!1,ajax:{url:assets+"php/misc/machinestatus.php",type:"GET"},columns:[{data:null,render:function(t,a,e,n){return n.row+1}},{data:null,render:function(t,a,e,n){return"<span class='text-center'>"+t.status_name+"</span>"}},{data:null,render:function(t,a,e,n){return"<button class='btn btn-xs btn-success btn-flat btnUpdateStatus' data-status='"+t.id+"'>Update</button>"}}],columnDefs:[{responsivePriority:1,target:0},{responsivePriority:2,width:"20%",target:1}],deferRender:!0,preDrawCallback:function(t){$(".dt-button-addStatus").removeClass("dt-button").addClass("btn btn-primary btn-flat btn-sm").css({"margin-bottom":"0.5em","margin-right":"0.5em"})}}),this},modalShow:function(t){$("#displayFormStatus").load(pages+"settings/form-machine-status.html",function(a,e,n){$("#modalFormStatus").modal("show"),null!=t?($(this).find(".modal-title").text("Update Status"),$.ajax({type:"GET",url:assets+"php/settings/machineStatus.php",data:{action:"view-id",id:t},dataType:"json",success:function(t){$.each(t.aaData,function(t,a){$("#hdnIdStatus").val(a.id),$("#txtSettingStatus").val(a.status_name),$("#hdnOldStatus").val(a.status_name),$("input[name='optradioStatus'][value="+a.set_default+"]").prop("checked",!0)})},error:function(t,a,e){}})):$(this).find(".modal-title").text("Add Status")})},update:function(){var t={action:"update",id:$("#hdnIdStatus").val(),status_name:$("#txtSettingStatus").val(),status_action:$("input[name='optradioStatus']:checked").val()};$.ajax({type:"POST",url:assets+"php/settings/machineStatus.php",data:t,dataType:"json",success:function(t){self.dtStatus.dtInstance.ajax.reload(null,!1),autoDrpDown.cacheOptRemoveMachine.splice(0,1)},error:function(t,a,e){console.log(a+e)}})},add:function(){var t={action:"add",status_name:$("#txtSettingStatus").val(),status_action:$("input[name='optradioStatus']:checked").val()};$.ajax({type:"POST",url:assets+"php/settings/machineStatus.php",data:t,dataType:"json",success:function(t){self.dtStatus.dtInstance.ajax.reload(null,!1),autoDrpDown.cacheOptRemoveMachine.splice(0,1)},error:function(t,a,e){resetForm("#frmSettingStatus")}})},actions:function(){return $("table#dtStatus").on("click","button",function(t){var a=$(this);if(a.closest("tr").hasClass("selected")||(self.dtStatus.dtInstance.$("tr.selected").removeClass("selected"),a.closest("tr").addClass("selected")),$(a[0]).hasClass("btnUpdateStatus")){var e=$(this).data("status");self.dtStatus.modalShow(e)}}),$("#addStatus").click(function(t){self.dtStatus.modalShow()}),this}},dtSapCustomer={dtInstance:{},render:function(){return this.dtInstance=$("#dtSapCustomer").DataTable({dom:"flrtip",autoWidth:!1,responsive:!0,pageLength:10,lengthMenu:[[10,25,50,-1],[10,25,50,"All"]],oLanguage:{bProcessing:!0,sLoadingRecords:'<i class="fa fa-spinner fa-pulse fa-3x fa-fw"></i><span class="sr-only">Please wait - loading...</span>',sInfoEmpty:"No entries to show"},bDestroy:!0,ordering:!1,ajax:{url:assets+"php/settings/sap_master_details.php",type:"GET",data:{action:"view-all"}},columns:[{data:null,render:function(t,a,e,n){return n.row+1}},{data:null,render:function(t,a,e,n){return"<span class='text-center'>"+(t.sap_code||"---")+"</span>"}},{data:null,render:function(t,a,e,n){return"<span class='text-center'>"+(t.company_name||"---")+"</span>"}},{data:null,render:function(t,a,e,n){return"<span class='text-center'>"+(t.location||"---")+"</span>"}},{data:null,render:function(t,a,e,n){return"<span class='text-center'>"+(t.address||"---")+"</span>"}}],columnDefs:[{responsivePriority:1,target:0},{responsivePriority:2,width:"20%",target:1}],deferRender:!0}),this}},dtToner={dtInstance:{},render:function(){return this.dtInstance=$("#dtToner").DataTable({dom:"flrtip",autoWidth:!1,responsive:!0,pageLength:10,lengthMenu:[[10,25,50,-1],[10,25,50,"All"]],oLanguage:{bProcessing:!0,sLoadingRecords:'<i class="fa fa-spinner fa-pulse fa-3x fa-fw"></i><span class="sr-only">Please wait - loading...</span>',sInfoEmpty:"No entries to show"},bDestroy:!0,bStateSave:!0,ordering:!1,ajax:{url:assets+"php/settings/tonerModel.php",type:"GET",data:{action:"view-all"}},columns:[{data:null,render:function(t,a,e,n){return n.row+1}},{data:null,render:function(t,a,e,n){return"<span class='text-center'>"+t.toner_code+"</span>"}},{data:null,render:function(t,a,e,n){return"<span class='text-center'>"+t.type+"</span>"}},{data:null,render:function(t,a,e,n){return"<span class='text-left'>"+t.model+"</span>"}},{data:null,render:function(t,a,e,n){return"<button class='btn btn-xs btn-success btn-flat btnUpdateToner' data-tonerid='"+t.id+"'>Update</button>"}}],columnDefs:[{responsivePriority:1,target:0},{responsivePriority:2,width:"20%",target:1},{targets:3,className:"none"}],deferRender:!0,preDrawCallback:function(t){$(".dt-button-addtoner").removeClass("dt-button").addClass("btn btn-primary btn-flat btn-sm").css({"margin-bottom":"0.5em","margin-right":"0.5em"})}}),this},modalShow:function(t){$("#displayFormTonerModel").load(pages+"settings/form-toner-model.html",function(a,e,n){$("#modalFormToner").modal("show");var s=$(this);$.when(autoDrpDown.getTonerModel("#slctSettingsModel")).done(function(a){""!=t?(s.find(".modal-title").text("Update Toner Model"),$.ajax({type:"GET",url:assets+"php/settings/tonerModel.php",data:{action:"view-id",toner:t},dataType:"json",success:function(t){$.each(t.aaData,function(t,a){$("#hdnTonerId").val(a.id),$("#txtSettingsToner").val(a.toner_code),$("#hdnOldToner").val(a.toner_code),$("#slctSettingsModel").val(null==a.model?null:a.model.split(",")).trigger("chosen:updated"),$("#hdnOldModel").val(a.model),$("#slctSettingsType").val(a.type)})},error:function(t,a,e){}})):s.find("h4.modal-title").text("Add Toner Model")})})},update:function(){var t=$("#hdnTonerId").val(),a=$("#txtSettingsToner").val(),e=$("#slctSettingsModel").chosen().val()?$("#slctSettingsModel").chosen().val().toString():"",n=$("#hdnOldModel").val(),s={action:"update",tonerid:t,toner:a,model:e,type:$("#slctSettingsType option:selected").val(),old_model:n};$.ajax({type:"POST",url:assets+"php/settings/tonerModel.php",data:s,dataType:"json",success:function(t){self.dtToner.dtInstance.ajax.reload(null,!1)},error:function(t,a,e){console.log(a+e)}})},add:function(){var t={action:"add",toner:$("#txtSettingsToner").val(),model:$("#slctSettingsModel").chosen().val()?$("#slctSettingsModel").chosen().val().toString():"",type:$("#slctSettingsType option:selected").val()};$.ajax({type:"POST",url:assets+"php/settings/tonerModel.php",data:t,dataType:"json",success:function(t){self.dtToner.dtInstance.ajax.reload(null,!1).page("last")},error:function(t,a,e){console.log(a+e)},complete:function(){$("#txtSettingsToner").val(""),$("#slctSettingsModel").val(0).trigger("chosen:updated")}})},actions:function(){return $(".box-toner").on("click","button",function(){var t=$(this);if(t.closest("tr").hasClass("selected")||(self.dtToner.dtInstance.$("tr.selected").removeClass("selected"),t.closest("tr").addClass("selected")),"Update"==t.text()){var a=$(this).data("tonerid");self.dtToner.modalShow(a)}else self.dtToner.modalShow("")}),this}},dtAccounts={dtInstance:{},dtInstanceLogs:null,pageDetails:function(){return $(".content-header h1").text("Accounts"),$(".content-header h1").append("<small>Company</small>"),this},render:function(){return this.dtInstance=$("#dtAccount").DataTable({dom:"fBlrtip",autoWidth:!1,responsive:!0,pageLength:10,lengthMenu:[[10,25,50,-1],[10,25,50,"All"]],oLanguage:{bProcessing:!0,sLoadingRecords:'<i class="fa fa-spinner fa-pulse fa-3x fa-fw"></i><span class="sr-only">Please wait - loading...</span>',sInfoEmpty:"No entries to show"},bDestroy:!0,ordering:!1,ajax:{url:assets+"php/accounts/company.php",type:"GET",data:{action:"view-all"}},buttons:[{text:"Add New Account",className:"dt-button-addaccount",action:function(t,a,e,n){self.dtAccounts.modalShow()}}],columns:[{data:null,render:function(t,a,e,n){return n.row+1}},{data:null,render:function(t,a,e,n){return"<span class='text-left'>"+t.username+"</span>"}},{data:null,render:function(t,a,e,n){return"<span class='text-left'>"+t.firstname+" "+t.middlename+" "+t.lastname+"</span>"}},{data:null,render:function(t,a,e,n){return"<div class='text-left dt-column-branches'>"+t.location+"</div>"}},{data:null,render:function(t,a,e,n){return"<div class='text-left'>"+t.branch+"</div>"}},{data:null,render:function(t,a,e,n){return"<span class='text-left'>"+t.accountrole+"</span>"}},{data:null,render:function(t,a,e,n){return"<span class='text-left'>"+t.created_at+"</span>"}},{data:null,render:function(t,a,e,n){return"<button class='btn btn-xs btn-success btn-flat btnUpdateAcc' data-acc='"+t.id+"'>Update</button>"}}],columnDefs:[{responsivePriority:1,target:0},{responsivePriority:2,width:"20%",target:1}],deferRender:!0,fnCreatedRow:function(t,a){$("td:eq(0)",t).attr("data-id-account",a.id)},preDrawCallback:function(t){$(".dt-button-addaccount").removeClass("dt-button").addClass("btn btn-primary btn-flat btn-sm").css({"margin-bottom":"0.5em","margin-right":"0.5em"})}}),this},modalShow:function(t){$("#displayFormAccount").load(pages+"accounts/form.html",function(a,e,n){$("#modalFormAccount").modal("show"),autoDrpDown.getBranchNameMulti("#slctAccountLocation","100%",0,!1),autoDrpDownInvnt.getBranch("#slctAccountBranch"),autoDrpDownInvnt.getBranch("#slctAccountBranchMrf"),autoDrpDownInvnt.getBranch("#slctAccountBranchPm",null,[1]),autoDrpDownMrf.getAccountDept("#slctAccountDept"),$("input[name='radioMifActions']").click(function(t){var a=$("#slctAccountDept option:selected").attr("data-group-mif");"r"==$(this).val()?"view"==a&&$("#slctAccountLocation").val(1).prop("disabled",!0).trigger("chosen:updated"):$("#slctAccountLocation").val(0).prop("disabled",!1).trigger("chosen:updated")}),$("#slctAccountDept").change(function(t){var a=$(":selected",this);"view"==a.attr("data-group-mif")?($("input[name='radioMifActions'][value='r']").prop("checked",!0),$("#slctAccountLocation").val(1).prop("disabled",!0).trigger("chosen:updated")):$("#slctAccountLocation").val(0).prop("disabled",!1).trigger("chosen:updated"),"approver"==a.attr("data-group")?($("#slctAccountBranchMrf option[value=1]").show(),$("#slctAccountBranchMrf").val(1).prop("disabled",!0)):($("#slctAccountBranchMrf option").filter(function(t){return t<=1}).hide(),$("#slctAccountBranchMrf").val("").prop("disabled",!1))}),$("#slctPmType").change(function(t){"MONITOR"==$(":selected",this).val()?($("#slctAccountBranchPm option[value=1]").show(),$("input[name='radioPmActions'][value='r']").prop("checked",!0),$("input[name='radioPmActions'][value='wr']").prop("disabled",!0)):($("#slctAccountBranchPm option[value=1]").hide(),$("#slctAccountBranchPm").val(""),$("input[name='radioPmActions'][value='wr']").prop("disabled",!1))}),null!=t?($(this).find(".modal-title").text("Update Account"),$.ajax({type:"GET",url:assets+"php/accounts/company.php",data:{action:"view-id",idaccount:t},dataType:"json",success:function(t){$.each(t.aaData,function(t,a){var e=parseInt(a.app_mif)||null,n=parseInt(a.app_pm)||null,s=parseInt(a.app_inventory)||null,l=parseInt(a.app_mrf)||null;$("#hdnIdAccount").val(a.id),$("#hdnOldUsername").val(a.username),$("#txtUsername").val(a.username),$("#txtFname").val(a.firstname),$("#txtMname").val(a.middlename),$("#txtLname").val(a.lastname),$("#txtEmail").val(a.email),$("#slctStatus").val(a.status),$("#slctAccountRole").val(a.accountrole),$("#slctPmType").val(a.pm_type),$("#txtDateCreated").text(a.created_at),$("#chkAppMif").prop("checked",null!=e),$("#chkAppPm").prop("checked",null!=n),$("#chkAppInventory").prop("checked",null!=s),$("#chkAppMrf").prop("checked",null!=l),$("#slctAccountLocation").prop("disabled",null==e),$("#slctAccountDept").val(a.account_type).trigger("change"),$("#slctAccountLocation").val(null==a.location?null:a.location.split(",")).trigger("chosen:updated"),$("#slctAccountBranch").val(a.branch).prop("disabled",null==s),$("#slctAccountBranchPm").val(a.branch_pm).prop("disabled",null==n),$("#slctAccountBranchMrf").val(a.branch_mrf).prop("disabled",!(null!=l&&l>0&&a.account_type>1)),""!=a.action_mif&&$("input[name='radioMifActions'][value="+a.action_mif+"]").prop("checked",!0),""!=a.action_invnt&&$("input[name='radioInvntActions'][value="+a.action_invnt+"]").prop("checked",!0),""!=a.action_mrf&&$("input[name='radioMrfActions'][value="+a.action_mrf+"]").prop("checked",!0),""!=a.action_pm&&$("input[name='radioPmActions'][value="+a.action_pm+"]").prop("checked",!0)})},error:function(t,a,e){alert("Something went wrong.")}})):($(this).find(".modal-title").text("Add Account"),$("#slctAccountLocation").val(0).trigger("chosen:updated"),$("#txtDateCreated").text(getTodayDate()))})},update:function(){var t=$("button[type='submit']"),a=$("#hdnIdAccount").val(),e=$("#txtUsername").val(),n=$("#txtPassword").val(),s=$("#txtFname").val(),l=$("#txtMname").val(),o=$("#txtLname").val(),r=$("#txtEmail").val(),c=$("#slctAccountRole option:selected").val(),i=$("#slctPmType option:selected").val(),d=$("#slctStatus option:selected").val(),p=$("input[name='chkAppMif']:checked").val()||"",u=$("input[name='chkAppPm']:checked").val()||"",m=$("#slctAccountLocation").chosen().val()?$("#slctAccountLocation").chosen().val().toString():"",h=$("input[name='chkAppInventory']:checked").val()||"",f=$("#slctAccountBranch option:selected").val(),v=$("#slctAccountBranchPm option:selected").val(),g=$("input[name='chkAppMrf']:checked").val()||"",b=$("#slctAccountBranchMrf option:selected").val(),y=$("#slctAccountDept option:selected").val(),x=$("input[name='radioMifActions']:checked").val(),C=$("input[name='radioPmActions']:checked").val(),_=$("input[name='radioInvntActions']:checked").val(),S=$("input[name='radioMrfActions']:checked").val(),w={action:"update",idaccount:a,username:e,pass:n,fname:s,mname:l,lname:o,email:r,app_mif:p,app_pm:u,action_pm:C,location:m,app_invt:h,branch:f,branch_pm:v,app_mrf:g,branch_mrf:b,accrole:c,status:d,acc_type_mrf:y,action_mif:x,action_invnt:_,action_mrf:S,pm_type:i};$.ajax({type:"POST",url:assets+"php/accounts/company.php",data:w,dataType:"json",beforeSend:function(){t.button("loading")},success:function(t){1==t.aaData.check_location?promptMSG("custom","Can't update due the <strong>ALL</strong> location can't combined.","<i class='fa fa-warning'></i>",null,!1,!0):self.dtAccounts.dtInstance.ajax.reload(function(){promptMSG("success-update","Company Account",null,"",!1,!0);var t=Cookies.get("user_id");a==t&&(Cookies.clear("location"),Cookies.set("location",m,.5))},!1)},error:function(t,a){alert("Something went wrong.")},complete:function(){t.button("reset")}})},add:function(){var t=$("button[type='submit']"),a={action:"add",username:$("#txtUsername").val(),pass:$("#txtPassword").val(),fname:$("#txtFname").val(),mname:$("#txtMname").val(),lname:$("#txtLname").val(),email:$("#txtEmail").val(),app_mif:$("input[name='chkAppMif']:checked").val()||"",location:$("#slctAccountLocation").chosen().val()?$("#slctAccountLocation").chosen().val().toString():"",app_invt:$("input[name='chkAppInventory']:checked").val()||"",branch:$("#slctAccountBranch option:selected").val(),app_mrf:$("input[name='chkAppMrf']:checked").val()||"",branch_mrf:$("#slctAccountBranchMrf option:selected").val(),accrole:$("#slctAccountRole option:selected").val(),status:$("#slctStatus option:selected").val(),acc_type_mrf:$("#slctAccountDept option:selected").val(),action_mif:$("input[name='radioMifActions']:checked").val(),action_invnt:$("input[name='radioInvntActions']:checked").val(),action_mrf:$("input[name='radioMrfActions']:checked").val(),pm_type:$("#slctPmType option:selected").val(),action_pm:$("input[name='radioPmActions']:checked").val(),branch_pm:$("#slctAccountBranchPm option:selected").val(),app_pm:$("input[name='chkAppPm']:checked").val()||""},e=!1;$.ajax({type:"POST",url:assets+"php/accounts/company.php",data:a,dataType:"json",beforeSend:function(){t.button("loading")},success:function(t,a,n){1==t.aaData.check_location?promptMSG("custom","Can't add due the <strong>ALL</strong> location can't combined.","<i class='fa fa-warning'></i>",null,!1,!0):(self.dtAccounts.dtInstance.ajax.reload(function(){promptMSG("success-add","Company Account",null,"",!1,!0)},!1).page("last"),e=!0)},error:function(t,a){alert("Something went wrong.")},complete:function(){e&&resetForm("#frmAccount"),t.button("reset")}})},actions:function(){return $("table#dtAccount").on("click","button",function(){var t=$(this);if(t.closest("tr").hasClass("selected")||(self.dtAccounts.dtInstance.$("tr.selected").removeClass("selected"),t.closest("tr").addClass("selected")),"Update"==t.text()){var a=$(this).data("acc");self.dtAccounts.modalShow(a)}}),this},login_logs:function(){return this.dtInstanceLogs=$("#dtAccLoginLogs").DataTable({dom:"<'search-toolbar'>lrtip",processing:!0,serverSide:!0,ordering:!1,destroy:!0,responsive:!1,ajax:{url:assets+"php/accounts/accountLoginLogs.php",type:"POST",dataSrc:"records",data:function(t){t.search={value:$("#txtSearchLogs").val()||null}}},columns:[{data:null},{data:"fullname"},{data:"date_log"},{data:"description"},{data:"ip_address"}],columnDefs:[{targets:0,render:function(t,a,e,n){return n.row+1}}]}),$("div.search-toolbar").html("<div class='pull-right'><input type='search' id='txtSearchLogs' placeholder='Search' style='margin-right:10px'/><a href='#' class='btn btn-flat btn-xs btn-primary' id='btnSearchLogs'><i class='fa fa-search' title='Search'></i></a></div>"),$("#btnSearchLogs").click(function(t){t.preventDefault(),self.dtAccounts.dtInstanceLogs.ajax.reload()}),this},changePassword:function(t){var a=$("button[type='submit']"),e=$("#txtConfirmPassword").val(),n=t;return $.ajax({type:"POST",url:assets+"php/accounts/company.php",data:{action:"change_password",idaccount:n,pass:e},dataType:"json",beforeSend:function(){a.button("loading")},success:function(t){"success"==t.status?promptMSG("success-update","Password",null,"",!1,!0):alert("Error, missing data paramaters.")},error:function(t,a){alert("Something went wrong.")},complete:function(){a.button("reset")}}),this}},dtAccClient={dtInstance:{},dtInstanceLogs:null,pageDetails:function(){return $(".content-header h1").text("Accounts"),$(".content-header h1").append("<small>Manager</small>"),this},render:function(){return this.dtInstance=$("#dtClient").DataTable({dom:"fBlrtip",autoWidth:!1,responsive:!0,pageLength:10,lengthMenu:[[10,25,50,-1],[10,25,50,"All"]],oLanguage:{bProcessing:!0,sLoadingRecords:'<i class="fa fa-spinner fa-pulse fa-3x fa-fw"></i><span class="sr-only">Please wait - loading...</span>',sInfoEmpty:"No entries to show"},bDestroy:!0,ordering:!1,ajax:{url:assets+"php/accounts/manager/manager.php",type:"POST",data:{action:"view-all"}},buttons:[{text:"Add New Manager",className:"dt-button-addaccount",action:function(t,a,e,n){self.dtAccClient.modalShow()}}],columns:[{data:null,render:function(t,a,e,n){return n.row+1}},{data:null,render:function(t,a,e,n){return"<span class='text-left'>"+t.fullname+"</span>"}},{data:null,render:function(t,a,e,n){return"<span class='text-left'>"+t.company+"</span>"}},{data:null,render:function(t,a,e,n){return 1==t.status?"<span class='text-left'> Active </span>":"<span class='text-left' style='color:#dd4b39'> Inactive </span>"}},{data:null,render:function(t,a,e,n){return"<span class='text-left'>"+t.created_at+"</span>"}},{data:null,render:function(t,a,e,n){return"<button class='btn btn-xs btn-success btn-flat btnUpdateAcc' data-acc-client='"+t.id+"'>Update</button>"}}],columnDefs:[{responsivePriority:1,target:0},{responsivePriority:2,width:"20%",target:1},{targets:2,className:"none"}],deferRender:!0,fnCreatedRow:function(t,a){$("td:eq(0)",t).attr("data-id-account",a.id)},preDrawCallback:function(t){$(".dt-button-addaccount").removeClass("dt-button").addClass("btn btn-primary btn-flat btn-sm").css({"margin-bottom":"0.5em","margin-right":"0.5em"})}}),this},modalShow:function(t){$("#displayFormAccClient").load(pages+"accounts/form-client.html",function(a,e,n){autoDrpDown.getAllCompany("#slctClientCompany","100%"),autoDrpDown.getAssignAccountManager("#slctAcctMngrName"),$("#modalFormAccClient").modal("show"),null!=t?($(this).find(".modal-title").text("Update Manager"),$.ajax({type:"GET",url:assets+"php/accounts/manager/manager.php",data:{action:"view-id",idclient:t},dataType:"json",success:function(t){$.each(t.aaData,function(t,a){$("#hdnClientId").val(a.id),$("#hdnOldSlctAcctMngrName").val(a.account_id),$("#slctAcctMngrName").val(a.account_id).trigger("chosen:updated"),$("#txtClientDateCreated").text(a.created_at),$("#hdnClientOldCompany").val(a.company),$("#slctClientCompany").val(a.company.split(",")).trigger("chosen:updated")})},error:function(t,a,e){}})):($(this).find(".modal-title").text("Add Manager"),$("#txtClientDateCreated").text(getTodayDate()))})},update:function(){var t=$("button[type='submit']"),a=$("#hdnClientId").val(),e=$("#slctAcctMngrName").chosen().val()?$("#slctAcctMngrName").chosen().val():null,n=$("#slctClientCompany").chosen().val()?$("#slctClientCompany").chosen().val().toString():"",s=$("#hdnClientOldCompany").val(),l=$("#hdnOldSlctAcctMngrName").val(),o={action:"update",idclient:a,account_id:e,companies:n,old_companies:s,old_account_id:l};$.ajax({type:"POST",url:assets+"php/accounts/manager/manager.php",data:o,dataType:"json",beforeSend:function(){t.button("loading")},success:function(t){return 1==t.aaData.has_value_accmngr?(promptMSG("custom","<strong>Company already taken: </strong><span style='color:#d24d3c'>"+t.aaData.exist_company+"</span>","<i class='fa fa-warning'></i>"),!1):"true"==t.aaData.isNameExist?(promptMSG("warning","Name is already exist.",null,"",!1,!0),!1):($("#hdnClientOldCompany").val(n),$("#hdnOldSlctAcctMngrName").val(e),void self.dtAccClient.dtInstance.ajax.reload(function(){promptMSG("success-update","Account Manager",null,"",!1,!0),autoDrpDown.cacheOptClient.splice(0,1)},!1))},error:function(t,a){alert(t+a)},complete:function(){t.button("reset")}})},add:function(){var t=$("button[type='submit']"),a={action:"add",account_id:$("#slctAcctMngrName").chosen().val()?$("#slctAcctMngrName").chosen().val():null,companies:$("#slctClientCompany").chosen().val()?$("#slctClientCompany").chosen().val().toString():""};return $.ajax({type:"POST",url:assets+"php/accounts/manager/manager.php",data:a,dataType:"json",beforeSend:function(){t.button("loading")},success:function(t,a,e){return 1==t.aaData.has_value_accmngr?(promptMSG("custom","<strong>Company already taken: </strong><span style='color:#d24d3c'>"+t.aaData.exist_company+"</span>","<i class='fa fa-warning'></i>"),!1):"true"==t.aaData.isNameExist?(promptMSG("warning","Name is already exist.",null,"",!1,!0),!1):(self.dtAccClient.dtInstance.ajax.reload(function(){promptMSG("success-add","Account Manager",null,"",!1,!0),autoDrpDown.cacheOptClient.splice(0,1)},!1).page("last"),void resetForm("#frmAccountClient"))},error:function(t,a,e){alert(t+a+e.text)},complete:function(){t.button("reset")}}),this},actions:function(){return $("table#dtClient").on("click","button",function(){var t=$(this);if(t.closest("tr").hasClass("selected")||(self.dtAccClient.dtInstance.$("tr.selected").removeClass("selected"),t.closest("tr").addClass("selected")),"Update"==t.text()){var a=$(this).data("acc-client");self.dtAccClient.modalShow(a)}}),this},login_logs:function(){return this.dtInstanceLogs=$("#dtAccMngrLoginLogs").DataTable({dom:"<'search-toolbar'>lrtip",processing:!0,serverSide:!0,ordering:!1,destroy:!0,responsive:!1,ajax:{url:assets+"php/accounts/manager/accountMngrLoginLogs.php",type:"POST",dataSrc:"records",data:function(t){t.search={value:$("#txtSearchLogs").val()||null}}},columns:[{data:null},{data:"fullname"},{data:"date_log"},{data:"description"},{data:"ip_address"}],columnDefs:[{targets:0,render:function(t,a,e,n){return n.row+1}}]}),$("div.search-toolbar").html("<div class='pull-right'><input type='search' id='txtSearchLogs' placeholder='Search' style='margin-right:10px'/><a href='#' class='btn btn-flat btn-xs btn-primary' id='btnSearchLogs'><i class='fa fa-search' title='Search'></i></a></div>"),$("#btnSearchLogs").click(function(t){t.preventDefault(),self.dtAccClient.dtInstanceLogs.ajax.reload()}),this}};