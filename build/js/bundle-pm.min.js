var dtArchivePM={dtInstance:{},render:function(e,t){return this.dtInstance=$("#dtArchivePM").DataTable({dom:"Blrtip",autoWidth:!1,responsive:!0,pageLength:25,lengthMenu:[[10,25,50,-1],[10,25,50,"All"]],language:{processing:'<i class="fa fa-spinner fa-pulse fa-2x fa-fw"></i><span class="sr-only">Please wait - loading...</span>',infoEmpty:"No entries to show"},processing:!0,serverSide:!0,bDestroy:!0,ordering:!1,ajax:{url:assets+"php/pm/getPMList.php",type:"POST",dataSrc:"records",beforeSend:function(){$(".dt-buttons a").addClass("disabled")},data:function(n){n.action="archive",n.pm_number=e,n.company_id=t,n.serialnumber=$("#search-archive-pm-serial").val()||"",n.brand=$("#search-archive-pm-brand").val()||"",n.model=$("#search-archive-pm-model").val()||""},complete:function(e){$(".dt-buttons a").removeClass("disabled")}},buttons:[{text:'<i class="fa fa-refresh" aria-hidden="true" title="Refresh"></i>',tag:"a",className:"btn-archive-refresh-pm",action:function(e,t,n,a){self.dtArchivePM.dtInstance.ajax.reload(null,!0)}},{extend:"print",exportOptions:{columns:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15]},className:"dt-archive-pm-print hidden-xs",customize:function(e){var t=$(e.document.body);t.find("h1").remove(),t.prepend("<h4>Preventive Maintenance</h4>")}},{text:"Open Search Filter",className:"dt-button-archive-pmsearch",action:function(e,t,n,a){$("#dt-head-search").slideToggle("fast",function(){$(this).is(":visible")?n[0].innerText="Close Search Filter":(n[0].innerText="Open Search Filter",$("#dt-head-search input[type='text']").val(""))})}}],columns:[{data:null,render:function(e,t,n,a){return a.row+1}},{data:null,render:function(e,t,n,a){return"<span class=''>"+e.serialnumber+"</span>"}},{data:null,render:function(e,t,n,a){return"<span class='text-center'>"+e.brand_name+"</span>"}},{data:null,render:function(e,t,n,a){return"<span class='text-center'>"+e.model+"</span>"}},{data:null,render:function(e,t,n,a){return"<span class='text-center'>"+e.location_area+"</span>"}},{data:null,render:function(e,t,n,a){return"<span class='text-center'>"+e.department+"</span>"}},{data:null,render:function(e,t,n,a){return"<span class='text-center'>"+e.no_of_user+"</span>"}},{data:null,render:function(e,t,n,a){return"<span class='text-center'>"+("0000-00-00"!=e.date_installed&&null!=e.date_installed?e.date_installed:"")+"</span>"}},{data:null,render:function(e,t,n,a){return"<span class='text-center'>"+e.unit_owned+"</span>"}},{data:null,render:function(e,t,n,a){return"<span class='text-center'>"+("0000-00-00"!=e.manufacture_date&&null!=e.manufacture_date?e.manufacture_date:"")+"</span>"}},{data:null,render:function(e,t,n,a){return"<span class='text-center'>"+e.remarks+"</span>"}},{data:null,render:function(e,t,n,a){return"<span class='text-center'>"+(e.page_count||"")+"</span>"}},{data:null,render:function(e,t,n,a){return"<span class='text-center'>"+e.toner_use+"</span>"}},{data:null,render:function(e,t,n,a){return"<span class='text-center'>"+("0000-00-00 00:00:00"!=e.time_in&&null!=e.time_in?e.time_in:"")+"</span>"}},{data:null,render:function(e,t,n,a){return"<span class='text-center'>"+("0000-00-00 00:00:00"!=e.time_out&&null!=e.time_out?e.time_out:"")+"</span>"}}],columnDefs:[{responsivePriority:1,target:1}],deferRender:!0,fnCreatedRow:function(e,t){$("td:eq(10)",e).addClass("border-left")},preDrawCallback:function(e){$(".dt-button-archive-pmsearch, .dt-archive-pm-print, .btn-archive-refresh-pm").removeClass("dt-button").addClass("btn btn-primary btn-flat btn-sm").css({"margin-bottom":"0.5em","margin-right":"0.5em"}),$(".dt-archive-pm-print").text("").html("<i class='glyphicon glyphicon-print'></i>").attr("title","Print")}}),this},actions:function(){return $("#modalArchivePMList").on("click","button, a",function(e){e.preventDefault();var t=$(this).text().toLowerCase();"search"==t&&self.dtArchivePM.dtInstance.ajax.reload(null,!0),"reset"==t&&($("#dt-head-search input[type='text']").val(""),self.dtArchivePM.dtInstance.ajax.reload(null,!0))}),this}},dtArchiveSched={dtInstance:{},pageDetails:function(){return $(".content-header h1").text("Preventive Maintenance"),$(".content-header h1").append("<small>Archive</small>"),this},render:function(){return this.dtInstance=$("#dtArchiveSched").DataTable({dom:"Blrtip",autoWidth:!1,responsive:!0,pageLength:25,lengthMenu:[[10,25,50,-1],[10,25,50,"All"]],language:{processing:'<i class="fa fa-spinner fa-pulse fa-2x fa-fw"></i><span class="sr-only">Please wait - loading...</span>',infoEmpty:"No entries to show"},processing:!0,serverSide:!0,bDestroy:!0,ordering:!1,ajax:{url:assets+"php/pm/getScheduleList.php",type:"POST",dataSrc:"records",beforeSend:function(){$(".dt-buttons a").addClass("disabled")},data:function(e){e.action="archive",e.pm_number=$("#search-archive-sched-pmnumber").val()||"",e.company_name=$("#search-archive-sched-company").val()||"",e.sched_date=$("#search-archive-sched-schedule").val()||"",e.technician=$("#search-archive-sched-technician").val()||"",e.branch=Cookies.get("branch_pm"),e.pm_type=Cookies.get("pm_type"),e.userid=Cookies.get("user_id")},complete:function(){$(".dt-buttons a").removeClass("disabled")}},buttons:[{text:'<i class="fa fa-refresh" aria-hidden="true" title="Refresh"></i>',tag:"a",className:"btn-archive-refresh-pm",action:function(e,t,n,a){self.dtArchiveSched.dtInstance.ajax.reload(null,!0)}},{extend:"print",exportOptions:{columns:[0,1,2,3,4,5,6]},className:"dt-archive-sched-print hidden-xs",customize:function(e){var t=$(e.document.body);t.find("h1").remove(),t.prepend("<h4>Preventive Maintenance <small>schedule list</small></h4>")}},{text:"Open Search Filter",className:"dt-archive-button-schedsearch",action:function(e,t,n,a){$("#dt-head-archive-schedsearch").slideToggle("fast",function(){$(this).is(":visible")?n[0].innerText="Close Search Filter":(n[0].innerText="Open Search Filter",$("#dt-head-archive-schedsearch input[type='text']").val(""))})}}],columns:[{data:null,render:function(e,t,n,a){return a.row+1}},{data:null,render:function(e,t,n,a){return"<span class=''>"+e.pm_number+"</span>"}},{data:null,render:function(e,t,n,a){return"<span class='text-center'>"+e.company_name+"</span>"}},{data:null,render:function(e,t,n,a){return"<span class='text-center'>"+e.schedule_date+"</span>"}},{data:null,render:function(e,t,n,a){return"<span class='text-center'>"+(e.technician||"")+"</span>"}},{data:null,render:function(e,t,n,a){return"<span class='text-center'>"+e.date_entered+"</span>"}},{data:null,render:function(e,t,n,a){var r="",s=e.status.toUpperCase()||"";return"CLOSE"==s?(r="badge-green",s="CLOSE PM"):"CANCEL"==s&&(r="badge-orange"),"<span class='badge "+r+"'>"+s+"</span>"}},{data:null,render:function(e,t,n,a){var r=JSON.parse(Cookies.get("app_module_action"));return r&&"wr"==r.action_pm?"<button class='btn btn-xs btn-success btn-flat btnPM' data-pmnumber='"+e.pm_number+"' data-comp-id='"+e.company_id+"' data-toggle='modal' data-target='#modalArchivePMList'>PM</button>":""}}],columnDefs:[{responsivePriority:1,target:0}],deferRender:!0,preDrawCallback:function(e){$(".dt-archive-button-schedsearch, .dt-archive-sched-print, .btn-archive-refresh-pm").removeClass("dt-button").addClass("btn btn-primary btn-flat btn-sm").css({"margin-bottom":"0.5em","margin-right":"0.5em"}),$(".dt-archive-sched-print").text("").html("<i class='glyphicon glyphicon-print'></i>").attr("title","Print")}}),this},modalShow:function(){return $("#displayPMList").load(pages+"pm/archive/pm.html",function(){dtArchivePM.actions(),$("#modalArchivePMList").on("hidden.bs.modal",function(){$(this).find("input[type='hidden']").val("")})}),this},actions:function(){return $("table#dtArchiveSched").on("click","button, a",function(e){e.preventDefault();var t=$(this),n=t.text().toLowerCase();if(t.closest("tr").hasClass("selected")||(self.dtArchiveSched.dtInstance.$("tr.selected").removeClass("selected"),t.closest("tr").addClass("selected")),"pm"==n){var a=$(this).data("comp-id"),r=$(this).data("pmnumber");dtArchivePM.render(r,a)}"search"==n&&self.dtArchiveSched.dtInstance.ajax.reload(null,!0),"reset"==n&&($("#dt-head-archive-schedsearch input[type='text']").val(""),self.dtArchiveSched.dtInstance.ajax.reload(null,!0))}),this}},dtCurrentPM={dtInstance:{},dtInstanceAddPm:{},detachBtnAdd:null,render:function(e,t){return $("#hdnPmNumber").val(e),$("#hdnPmCompanyId").val(t),this.dtInstance=$("#dtCurrentPM").DataTable({initComplete:function(e,t){"false"==t.enabledMultiSelectAdd?$("#btnAddPm").hide():$("#btnAddPm").show()},dom:"Blrtip",autoWidth:!1,responsive:!0,pageLength:25,lengthMenu:[[10,25,50,-1],[10,25,50,"All"]],language:{processing:'<i class="fa fa-spinner fa-pulse fa-2x fa-fw"></i><span class="sr-only">Please wait - loading...</span>',infoEmpty:"No entries to show"},processing:!0,serverSide:!0,bDestroy:!0,ordering:!1,ajax:{url:assets+"php/pm/getPMList.php",type:"POST",dataSrc:"records",beforeSend:function(){$(".dt-buttons a").addClass("disabled")},data:function(n){n.action="current",n.pm_number=e,n.company_id=t,n.serialnumber=$("#search-pm-serial").val()||"",n.brand=$("#search-pm-brand").val()||"",n.model=$("#search-pm-model").val()||""},complete:function(e){$(".dt-buttons a").removeClass("disabled")}},buttons:[{text:'<i class="fa fa-refresh" aria-hidden="true" title="Refresh"></i>',tag:"a",className:"btn-refresh-pm",action:function(e,t,n,a){self.dtCurrentPM.dtInstance.ajax.reload(null,!0)}},{extend:"print",exportOptions:{columns:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15]},className:"dt-pm-print hidden-xs",customize:function(e){var t=$(e.document.body);t.find("h1").remove(),t.prepend("<h4>Preventive Maintenance</h4>")}},{text:"Add PM Machine",tag:"a",className:"btn-header-add-pm",action:function(e,t,n,a){var r=$("#hdnPmNumber").val(),s=$("#hdnPmCompanyId").val();self.dtCurrentPM.renderAddPm(r,s)}},{text:"Open Search Filter",className:"dt-button-pmsearch",action:function(e,t,n,a){$("#dt-head-search").slideToggle("fast",function(){$(this).is(":visible")?n[0].innerText="Close Search Filter":(n[0].innerText="Open Search Filter",$("#dt-head-search input[type='text']").val(""))})}}],columns:[{data:null,render:function(e,t,n,a){return'<input class="chckbox-pm-sn" type="checkbox" name="sn[]" value="'+e.serialnumber+'">'}},{data:null,render:function(e,t,n,a){return a.row+1}},{data:null,render:function(e,t,n,a){return"<span class=''>"+e.serialnumber+"</span>"}},{data:null,render:function(e,t,n,a){return"<span class='text-center'>"+e.brand_name+"</span>"}},{data:null,render:function(e,t,n,a){return"<span class='text-center'>"+e.model+"</span>"}},{data:null,render:function(e,t,n,a){return"<span class='text-center'>"+e.location_area+"</span>"}},{data:null,render:function(e,t,n,a){return"<span class='text-center'>"+e.department+"</span>"}},{data:null,render:function(e,t,n,a){return"<span class='text-center'>"+e.no_of_user+"</span>"}},{data:null,render:function(e,t,n,a){return"<span class='text-center'>"+("0000-00-00"!=e.date_installed&&null!=e.date_installed?e.date_installed:"")+"</span>"}},{data:null,render:function(e,t,n,a){return"<span class='text-center'>"+e.unit_owned+"</span>"}},{data:null,render:function(e,t,n,a){return"<span class='text-center'>"+("0000-00-00"!=e.manufacture_date&&null!=e.manufacture_date?e.manufacture_date:"")+"</span>"}},{data:null,render:function(e,t,n,a){return"<span class='text-center'>"+e.remarks+"</span>"}},{data:null,render:function(e,t,n,a){return"<span class='text-center'>"+(e.page_count||"")+"</span>"}},{data:null,render:function(e,t,n,a){return"<span class='text-center'>"+e.toner_use+"</span>"}},{data:null,render:function(e,t,n,a){return"<span class='text-center'>"+("0000-00-00 00:00:00"!=e.time_in&&null!=e.time_in?e.time_in:"")+"</span>"}},{data:null,render:function(e,t,n,a){return"<span class='text-center'>"+("0000-00-00 00:00:00"!=e.time_out&&null!=e.time_out?e.time_out:"")+"</span>"}},{data:null,render:function(e,t,n,a){var r=JSON.parse(Cookies.get("app_module_action"));return r&&"wr"==r.action_pm&&"true"==e.enabled_update?"<button class='btn btn-xs btn-success btn-flat btnUpdatePM' data-id='"+e.id+"' data-toggle='modal' data-target='#modalFormCurrentPM'>Update</button>":""}}],columnDefs:[{responsivePriority:1,target:1}],deferRender:!0,fnCreatedRow:function(e,t){$("td:eq(10)",e).addClass("border-left")},preDrawCallback:function(e){$(".dt-button-pmsearch, .dt-pm-print, .dt-button-add, .btn-refresh-pm, .btn-header-add-pm").removeClass("dt-button").addClass("btn btn-primary btn-flat btn-sm").css({"margin-bottom":"0.5em","margin-right":"0.5em"}),$(".dt-pm-print").text("").html("<i class='glyphicon glyphicon-print'></i>").attr("title","Print")},fnDrawCallback:function(){var e=Cookies.get("pm_type");""==e||"technician"==e.toLowerCase()?this.api().buttons(".btn-header-add-pm").remove():this.api().button(".btn-header-add-pm").nodes().attr({"data-toggle":"modal","data-target":"#modalHeaderAddPm"})}}),$("#select-all-row").on("click",function(){var e=dtCurrentPM.dtInstance.rows({search:"applied"}).nodes(),t=$('input[type="checkbox"]',e).prop("checked",this.checked);$(this).is(":checked")?$(t).parent("td").addClass("chkboxes-background"):$(t).parent("td").removeClass("chkboxes-background")}),dtCurrentPM.dtInstance.on("click",'input[type="checkbox"]',function(e){$(this).closest("td").toggleClass("chkboxes-background")}),this},renderAddPm:function(e,t){return $("#hdnAddPmNumber").val(e),$("#hdnAddPmCompanyId").val(t),this.dtInstanceAddPm=$("#dtCurrentHeaderAddPm").DataTable({dom:"lrtip",autoWidth:!1,responsive:!0,pageLength:25,lengthMenu:[[10,25,50,-1],[10,25,50,"All"]],language:{processing:'<i class="fa fa-spinner fa-pulse fa-2x fa-fw"></i><span class="sr-only">Please wait - loading...</span>',infoEmpty:"No entries to show"},processing:!0,serverSide:!0,bDestroy:!0,ordering:!1,ajax:{url:assets+"php/pm/getPMList.php",type:"POST",dataSrc:"records",beforeSend:function(){$(".dt-buttons a").addClass("disabled")},data:function(n){n.action="current-header",n.pm_number=e,n.company_id=t},complete:function(e){$(".dt-buttons a").removeClass("disabled")}},columns:[{data:null,render:function(e,t,n,a){return'<input class="chckbox-header-pm-sn" type="checkbox" name="sn[]" value="'+e.serialnumber+'">'}},{data:null,render:function(e,t,n,a){return a.row+1}},{data:null,render:function(e,t,n,a){return"<span class=''>"+e.serialnumber+"</span>"}},{data:null,render:function(e,t,n,a){return"<span class='text-center'>"+e.brand_name+"</span>"}},{data:null,render:function(e,t,n,a){return"<span class='text-center'>"+e.model+"</span>"}}],columnDefs:[{responsivePriority:1,target:1}],deferRender:!0}),$("#header-select-all-row").on("click",function(){var e=dtCurrentPM.dtInstanceAddPm.rows({search:"applied"}).nodes(),t=$('input[type="checkbox"]',e).prop("checked",this.checked);$(this).is(":checked")?$(t).parent("td").addClass("chkboxes-background"):$(t).parent("td").removeClass("chkboxes-background")}),dtCurrentPM.dtInstanceAddPm.on("click",'input[type="checkbox"]',function(e){$(this).closest("td").toggleClass("chkboxes-background")}),this},modalShow:function(){},getDataPM:function(e){if(null!=e){var t=$("button[type='submit']");$.ajax({type:"GET",url:assets+"php/pm/pm.php",data:{action:"view-id",pm_id:e},dataType:"json",beforeSend:function(){t.button("loading")},success:function(e){var t=e.aaData[0];$("#hdnCurPMId").val(t.id),$("#hdnCurSchedPmNum2").val(t.pm_number),$("#pm-serialnum").val(t.serialnumber),$("#pm-brand").val(t.brand_name),$("#pm-model").val(t.model),$("#pm-remarks").val(t.remarks),$("#pm-page").val(t.page_count),$("#pm-toner").val(t.toner_use),"0000-00-00"!=t.manufacture_date&&null!=t.manufacture_date?$("#pm-manufacture").val(t.manufacture_date):$("#pm-manufacture").val(""),"0000-00-00 00:00:00"!=t.time_in&&null!=t.time_in?$("#pm-date-in").datetimepicker("setDate",dateFormat(Date.parse(t.time_in),"mm/dd/yyyy h:MM TT")):$("#pm-date-in").datetimepicker("setDate",""),"0000-00-00 00:00:00"!=t.time_out&&null!=t.time_out?$("#pm-date-out").datetimepicker("setDate",dateFormat(Date.parse(t.time_out),"mm/dd/yyyy h:MM TT")):$("#pm-date-out").datetimepicker("setDate","")},error:function(e,t,n){promptMSG("warning","ID PM not exist.")},complete:function(){t.button("reset")}})}},add:function(){var e=$("#hdnPmNumber").val()||"",t=$("#hdnPmCompanyId").val()||"";if(""!=e&&""!=t){var n=$("button"),a={action:"add",serialnum:self.dtCurrentPM.getMultipleSerial("dtInstance",".chckbox-pm-sn"),pmnumber:e,company_id:t};$.ajax({type:"POST",url:assets+"php/pm/pm.php",data:a,dataType:"json",beforeSend:function(){n.button("loading")},success:function(e,t,n){"success"==e.aaData&&(self.dtCurrentPM.dtInstance.ajax.reload(function(){dtCurrentSched.dtInstance.ajax.reload(null,!1)},!1),promptMSG("success-add","PM Machines",null,null,!0,!0))},error:function(e,t){alert(e+t)},complete:function(e,t){n.button("reset")}})}else alert("PM number is empty.");return this},addPM:function(){var e=$("#hdnAddPmNumber").val()||"",t=$("#hdnAddPmCompanyId").val()||"";if(""!=e&&""!=t){var n=$("button"),a={action:"add",serialnum:self.dtCurrentPM.getMultipleSerial("dtInstanceAddPm",".chckbox-header-pm-sn"),pmnumber:e,company_id:t};$.ajax({type:"POST",url:assets+"php/pm/pm.php",data:a,dataType:"json",beforeSend:function(){n.button("loading")},success:function(e,t,n){"success"==e.aaData&&(self.dtCurrentPM.dtInstanceAddPm.ajax.reload(null,!1),self.dtCurrentPM.dtInstance.ajax.reload(null,!1),promptMSG("success-add","PM Machines",null,null,!0,!0))},error:function(e,t){alert(e+t)},complete:function(e,t){n.button("reset")}})}else alert("PM number is empty.");return this},update:function(e){if(null!=e){$("button[type='submit']");var t=$("#pm-manufacture").val(),n=$("#pm-remarks").val(),a=$("#pm-page").val(),r=$("#pm-toner").val(),s=$("#hdnCurSchedPmNum2").val(),d={action:"update",pm_id:e,manufacture:t,remarks:n,page:a,toner:r,time_in:$("#pm-date-in").datetimepicker("getDate")?dateFormat($("#pm-date-in").datetimepicker("getDate"),"yyyy-mm-dd HH:MM"):"",time_out:$("#pm-date-out").datetimepicker("getDate")?dateFormat($("#pm-date-out").datetimepicker("getDate"),"yyyy-mm-dd HH:MM"):"",pmnumber:s};$.ajax({type:"POST",url:assets+"php/pm/pm.php",data:d,dataType:"json",success:function(e){self.dtCurrentPM.dtInstance.ajax.reload(function(){dtCurrentSched.dtInstance.ajax.reload(null,!1)},!1),promptMSG("success-update","PM Machine",null,null,!0,!0)},error:function(e,t){alert("Something went wrong!")}})}else alert("ID PM is empty.")},getMultipleSerial:function(e,t){var n=dtCurrentPM[e].rows({search:"applied"}).nodes();return $(t+":checked",n).map(function(){return this.value}).get().join('","')},actions:function(){return $("#modalCurrentPMList").on("click","button, a",function(e){e.preventDefault();var t=$(this),n=t.text().toLowerCase();if(t.closest("tr").hasClass("selected")||(self.dtCurrentPM.dtInstance.$("tr.selected").removeClass("selected"),t.closest("tr").addClass("selected")),"update"==n){var a=$(this).data("id");self.dtCurrentPM.getDataPM(a)}"search"==n&&self.dtCurrentPM.dtInstance.ajax.reload(null,!0),"add"==n&&self.dtCurrentPM.add(),"reset"==n&&($("#dt-head-search input[type='text']").val(""),self.dtCurrentPM.dtInstance.ajax.reload(null,!0))}),this},actionsAddPm:function(){return $("#modalHeaderAddPm").on("click","#btn-header-pm-save",function(e){e.preventDefault(),self.dtCurrentPM.addPM(),self.dtCurrentPM.dtInstanceAddPm.ajax.reload(null,!0)}),this}},dtCurrentSched={dtInstance:{},pageDetails:function(){return $(".content-header h1").text("Preventive Maintenance"),$(".content-header h1").append("<small>Current</small>"),this},render:function(){return this.dtInstance=$("#dtCurrentSched").DataTable({dom:"Blrtip",autoWidth:!1,responsive:!0,pageLength:25,lengthMenu:[[10,25,50,-1],[10,25,50,"All"]],language:{processing:'<i class="fa fa-spinner fa-pulse fa-2x fa-fw"></i><span class="sr-only">Please wait - loading...</span>',infoEmpty:"No entries to show"},processing:!0,serverSide:!0,bDestroy:!0,ordering:!1,ajax:{url:assets+"php/pm/getScheduleList.php",type:"POST",dataSrc:"records",beforeSend:function(){$(".dt-buttons a").addClass("disabled")},data:function(e){e.action="current",e.pm_number=$("#search-sched-pmnumber").val()||"",e.company_name=$("#search-sched-company").val()||"",e.sched_date=$("#search-sched-schedule").val()||"",e.technician=$("#search-sched-technician").val()||"",e.branch=Cookies.get("branch_pm"),e.pm_type=Cookies.get("pm_type"),e.userid=Cookies.get("user_id")},complete:function(){$(".dt-buttons a").removeClass("disabled")}},buttons:[{text:'<i class="fa fa-refresh" aria-hidden="true" title="Refresh"></i>',tag:"a",className:"btn-refresh-pm",action:function(e,t,n,a){self.dtCurrentSched.dtInstance.ajax.reload(null,!0)}},{extend:"print",exportOptions:{columns:[0,1,2,3,4,5,6]},className:"dt-sched-print hidden-xs",customize:function(e){var t=$(e.document.body);t.find("h1").remove(),t.prepend("<h4>Preventive Maintenance <small>schedule list</small></h4>")}},{text:"Add Schedule",className:"btn btn-primary btn-flat btn-sm dt-button-add",action:function(e,t,n,a){$("#btn_cancel_sched, #btn_close_pm").hide(),$("#modalFormCurrentSched .modal-title").text("Add Schedule"),$("#modalFormCurrentSched #sched-date-entered").text(getTodayDateStandard())}},{text:"Open Search Filter",className:"dt-button-schedsearch",action:function(e,t,n,a){$("#dt-head-schedsearch").slideToggle("fast",function(){$(this).is(":visible")?n[0].innerText="Close Search Filter":(n[0].innerText="Open Search Filter",$("#dt-head-schedsearch input[type='text']").val(""))})}}],columns:[{data:null,render:function(e,t,n,a){return a.row+1}},{data:null,render:function(e,t,n,a){return"<span class=''>"+e.pm_number+"</span>"}},{data:null,render:function(e,t,n,a){return"<span class='text-center'>"+e.company_name+"</span>"}},{data:null,render:function(e,t,n,a){return"<span class='text-center'>"+e.schedule_date+"</span>"}},{data:null,render:function(e,t,n,a){return"<span class='text-center'>"+(e.technician||"")+"</span>"}},{data:null,render:function(e,t,n,a){return"<span class='text-center'>"+e.date_entered+"</span>"}},{data:null,render:function(e,t,n,a){var r="",s=e.status.toUpperCase()||"";return"DONE"==s?s="PM DONE":"PENDING"==s?r="badge-red":"IN-PROGRESS"==s&&(r="badge-orange"),"<span class='badge "+r+"'>"+s+"</span>"}},{data:null,render:function(e,t,n,a){var r=JSON.parse(Cookies.get("app_module_action")),s=Cookies.get("pm_type");return r&&"wr"==r.action_pm&&"controller"==s.toLowerCase()?"<button class='btn btn-xs btn-success btn-flat btnEditPM' data-id='"+e.id+"' data-pmnumber='"+e.pm_number+"' data-toggle='modal' data-target='#modalFormCurrentSched'>Edit</button>":""}},{data:null,render:function(e,t,n,a){var r=JSON.parse(Cookies.get("app_module_action"));return r&&"wr"==r.action_pm?"<button class='btn btn-xs btn-success btn-flat btnPM' data-pmnumber='"+e.pm_number+"' data-comp-id='"+e.company_id+"' data-toggle='modal' data-target='#modalCurrentPMList'>PM</button>":""}}],columnDefs:[{responsivePriority:1,target:0}],deferRender:!0,preDrawCallback:function(e){$(".dt-button-schedsearch, .dt-sched-print, .dt-button-add, .btn-refresh-pm").removeClass("dt-button").addClass("btn btn-primary btn-flat btn-sm").css({"margin-bottom":"0.5em","margin-right":"0.5em"}),$(".dt-sched-print").text("").html("<i class='glyphicon glyphicon-print'></i>").attr("title","Print")},fnDrawCallback:function(){var e=Cookies.get("pm_type");""==e||"technician"==e.toLowerCase()?(this.api().buttons(".dt-button-add").nodes().remove(),$("#btnAddPm").remove()):this.api().button(".dt-button-add").nodes().attr({"data-toggle":"modal","data-target":"#modalFormCurrentSched"})}}),this},modalShow:function(){return $("#displayFormSchedule").load(pages+"pm/current/form.html",function(){autoDrpDown.getAllCompany("#sched-company","100%"),autoDrpDownPM.getTechnician("#sched-technician"),self.dtCurrentSched.update_cancel().update_close(),$(this).find("#modalFormCurrentSched").on("hidden.bs.modal",function(){$("body").addClass("modal-open"),resetForm("#frmCurrentSched"),$("#sched-company").val(0).trigger("chosen:updated"),$("#sched-number").text("..."),$(this).find("#frmCurrentSched input[type='hidden']").val("")})}),$("#displayPMList").load(pages+"pm/current/pm.html",function(){dtCurrentPM.actions().actionsAddPm(),$("#modalCurrentPMList").on("hidden.bs.modal",function(){$(this).find("input[type='hidden']").val("")}),$("#modalHeaderAddPm").on("hidden.bs.modal",function(){$(this).find("input[type='hidden']").val(""),$("body").addClass("modal-open")})}),$("#displayFormPM").load(pages+"pm/current/form-pm.html",function(){var e=$("#pm-date-in"),t=$("#pm-date-out");$("#modalFormCurrentPM").on("hidden.bs.modal",function(){$("body").addClass("modal-open"),e.datetimepicker("option","maxDate",null),t.datetimepicker("option","minDate",null)}),$("#pm-manufacture").datepicker({dateFormat:"yy-mm-dd"}),$.timepicker.datetimeRange(e,t,{controlType:"select",minInterval:6e4,timeFormat:"hh:mm tt",start:{},end:{}})}),this},getDataSched:function(e){if(null!=e){var t=$("button[type='submit']");$.ajax({type:"GET",url:assets+"php/pm/schedule.php",data:{action:"view-id",id_pm:e},dataType:"json",beforeSend:function(){t.button("loading")},success:function(e){var t=e.aaData[0];$("#hdnCurSchedId").val(t.id),$("#hdnCurSchedPmNum").val(t.pm_number),$("#sched-number").text(t.pm_number),$("#sched-company").val(t.company_id).trigger("chosen:updated"),$("#sched-schedule").val(t.schedule_date),$("#sched-technician").val(t.technician),$("#sched-date-entered").text(t.date_entered),$("#sched-contact-name").val(t.contact_name),$("#sched-contact-num").val(t.contact_number),$("#sched-contact-email").val(t.email_address),$("#sched-contact-dept").val(t.department)},error:function(e,t,n){promptMSG("warning","ID Schedule not exist.")},complete:function(){t.button("reset")}})}},edit:function(e){$("button[type='submit']");var t={action:"edit",id_pm:e,company:$("#sched-company").chosen().val()?$("#sched-company").chosen().val().toString():"",sched_date:$("#sched-schedule").val(),technician:$("#sched-technician option:selected").val(),contact_name:$("#sched-contact-name").val(),contact_no:$("#sched-contact-num").val(),email:$("#sched-contact-email").val(),department:$("#sched-contact-dept").val()};$.ajax({type:"POST",url:assets+"php/pm/schedule.php",data:t,dataType:"json",success:function(e){self.dtCurrentSched.dtInstance.ajax.reload(null,!1),promptMSG("success-update","Schedule",null,null,!0,!0)},error:function(e,t){alert("Something went wrong!")}})},add:function(){var e=$("button[type='submit']"),t={action:"add",company:$("#sched-company").chosen().val()?$("#sched-company").chosen().val().toString():"",sched_date:$("#sched-schedule").val(),technician:$("#sched-technician option:selected").val(),contact_name:$("#sched-contact-name").val(),contact_no:$("#sched-contact-num").val(),email:$("#sched-contact-email").val(),department:$("#sched-contact-dept").val(),user_id:Cookies.get("user_id"),branch:Cookies.get("branch_pm")};$.ajax({type:"POST",url:assets+"php/pm/schedule.php",data:t,dataType:"json",beforeSend:function(){e.button("loading")},success:function(e,t,n){self.dtCurrentSched.dtInstance.ajax.reload(null,!1),promptMSG("success-add","Schedule",null,null,!0,!0)},error:function(e,t){alert("Something went wrong!")},complete:function(){resetForm("#frmCurrentSched"),$("#sched-company").val(0).trigger("chosen:updated"),e.button("reset"),$("#sched-number").text("...")}})},update_cancel:function(){return $("#btn_cancel_sched").click(function(){var e=$(this);promptMSG("custom","Are you sure you want to <strong>"+e.text()+"</strong>?","Confirmation","yn",!1,!0,function(){var e=$("#hdnCurSchedId").val()||"",t=$("#hdnCurSchedPmNum").val()||"";""!=e?$.ajax({type:"POST",dataType:"json",data:{action:"update_cancel",id_pm:e,pmnumber:t},url:assets+"php/pm/schedule.php",async:!1,beforeSend:function(){$("#modalFormCurrentSched").modal("hide"),$(".mif-modalPromptMSG").modal("hide")},success:function(e,t){setTimeout(function(){"true"==e.aaData.result?(promptMSG("success-custom",e.aaData.message),self.dtCurrentSched.dtInstance.ajax.reload(null,!1)):promptMSG("custom",e.aaData.message,"Warning!")},300)}}):alert("ID form is empty.")})}),this},update_close:function(){return $("#btn_close_pm").click(function(){var e=$(this);promptMSG("custom","Are you sure you want to <strong>"+e.text()+"</strong>?","Confirmation","yn",!1,!0,function(){var e=$("#hdnCurSchedId").val()||"",t=$("#hdnCurSchedPmNum").val()||"";""!=e?$.ajax({type:"POST",dataType:"json",data:{action:"update_close",id_pm:e,pmnumber:t},url:assets+"php/pm/schedule.php",async:!1,beforeSend:function(){$("#modalFormCurrentSched").modal("hide"),$(".mif-modalPromptMSG").modal("hide")},success:function(e,t){setTimeout(function(){"true"==e.aaData.result?(promptMSG("success-custom",e.aaData.message),self.dtCurrentSched.dtInstance.ajax.reload(null,!1)):promptMSG("custom",e.aaData.message,"Warning!")},300)}}):alert("ID form is empty.")})}),this},actions:function(){return $("table#dtCurrentSched").on("click","button, a",function(e){e.preventDefault();var t=$(this),n=t.text().toLowerCase();if(t.closest("tr").hasClass("selected")||(self.dtCurrentSched.dtInstance.$("tr.selected").removeClass("selected"),t.closest("tr").addClass("selected")),"edit"==n){var a=$(this).data("id"),r=$(this).data("pmnumber");$("#modalFormCurrentSched .modal-title").text("Edit Schedule"),$("#btn_cancel_sched, #btn_close_pm").show(),self.dtCurrentSched.getDataSched(a,r)}if("pm"==n){var s=$(this).data("comp-id"),d=$(this).data("pmnumber");self.dtCurrentPM.render(d,s)}"search"==n&&self.dtCurrentSched.dtInstance.ajax.reload(null,!0),"reset"==n&&($("#dt-head-schedsearch input[type='text']").val(""),self.dtCurrentSched.dtInstance.ajax.reload(null,!0))}),this}};