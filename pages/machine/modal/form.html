<!-- Modal -->
<div class="modal fade" id="modalFormMachine"  class="modalFormMachine" data-backdrop="static" data-keyboard="false" tabindex="-1" role="dialog" aria-labelledby="modalFormMachine">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="modalFormMachine" data-update-opt=""></h4>
      </div>
        <form id="frmMachine" class="form-horizontal">
        <div class="modal-body">
              <input type="hidden" name="hdnId" id='hdnId'>
              <input type="hidden" name="hdnOldSerial" id="hdnOldSerial">

              <div class="form-group">
                <label class="col-sm-4 control-label" for="slctCompany">Company</label>
                <div class="col-sm-8">
                  <select id="slctCompany" class="required" data-placeholder="Company" name="slctCompany"></select>
                </div>
              </div>

              <div class="form-group">
                <label class="col-sm-4 control-label" for="txtSerialNum">S/N</label>
                <div class="col-sm-5">
                  <input type="text" class="form-control" id="txtSerialNum" name="txtSerialNum" placeholder="S/N" />
                </div>
              </div>

              <div class="form-group">
                <label class="col-sm-4 control-label" for="slctBrands">Brand</label>
                <div class="col-sm-5">
                  <select id="slctBrands" class="form-control required" name="slctBrands"></select>
                </div>
              </div>

              <div class="form-group">
                <label class="col-sm-4 control-label" for="txtModel">Model</label>
                <div class="col-sm-5">
                  <input type="text" class="form-control" id="txtModel" name="txtModel" placeholder="Model" />
                </div>
              </div>

              <div class="form-group">
                <label class="col-sm-4 control-label" for="slctCategory">Category</label>
                <div class="col-sm-5">
                  <select id='slctCategory' class='form-control' name="slctCategory">
                    <option value=""></option>
                    <option value="MFP">MFP</option>
                    <option value="SFP">SFP</option>
                  </select>
                </div>
              </div>

              <div class="form-group">
                <label class="col-sm-4 control-label" for="slctType">Type</label>
                <div class="col-sm-5">
                  <select id='slctType' class='form-control' name="slctType">
                    <option value=""></option>
                    <option value="MONOCHROME">MONOCHROME</option>
                    <option value="COLOR">COLOR</option>
                  </select>
                </div>
              </div>

              <div class="form-group">
                <label class="col-sm-4 control-label" for="txtPageCount">Page Count</label>
                <div class="col-sm-5">
                  <input type="text" class="form-control" id="txtPageCount" name="txtPageCount" placeholder="Page Count" />
                </div>
              </div>

              <div class="form-group">
                <label class="col-sm-4 control-label" for="txtLocation">Location Area</label>
                <div class="col-sm-5">
                  <textarea class="form-control" id="txtLocation" name="txtLocation" placeholder="Location Area" style="resize: vertical;"></textarea>
                </div>
              </div>

              <div class="form-group">
                <label class="col-sm-4 control-label" for="txtDepartment">Department</label>
                <div class="col-sm-5">
                  <input type="text" class="form-control" id="txtDepartment" name="txtDepartment" placeholder="Department" />
                </div>
              </div>

              <div class="form-group">
                <label class="col-sm-4 control-label" for="txtNoUser">No. of User</label>
                <div class="col-sm-5">
                  <input type="text" class="form-control" id="txtNoUser" name="txtNoUser" placeholder="No. of User" />
                </div>
              </div>

              <div class="form-group">
                <label class="col-sm-4 control-label" for="txtRemarks">Remarks</label>
                <div class="col-sm-5">
                  <input type="text" class="form-control" id="txtRemarks" name="txtRemarks" placeholder="Remarks" />
                </div>
              </div>

              <div class="form-group">
                <label class="col-sm-4 control-label" for="txtDateInstall">Date Installed</label>
                <div class="col-sm-5">
                  <input type="text" class="form-control" id="txtDateInstall" name="txtDateInstall" placeholder="Date Installed" />
                </div>
              </div>

                <div class="form-group">
                <label class="col-sm-4 control-label" for="txtUnitOwn">Unit Owned</label>
                <div class="col-sm-5">
                  <input type="text" class="form-control" id="txtUnitOwn" name="txtUnitOwn" placeholder="Unit Owned"/>
                </div>
              </div>

              <div class="form-group">
                <label class="col-sm-4 control-label" for="slctBilling">Billing Type</label>
                <div class="col-sm-5">
                  <select id='slctBilling' class='form-control' name="slctBilling">
                    <option value=""></option>
                    <option value="FSMA">FSMA</option>
                    <option value="METER READING">METER READING</option>
                    <option value="PER CARTRIDGE">PER CARTRIDGE</option>
                    <option value="FIXED MONTHLY">FIXED MONTHLY</option>
                    <option value="OUTRIGHT">OUTRIGHT</option>
                  </select>
                </div>
              </div>

              <div class="form-group">
                <label class="col-sm-4 control-label" for="txtBranch">Location</label>
                <div class="col-sm-5">
                  <select class="chosen-select" id="txtBranch" name="txtBranch" data-placeholder="Location"> </select>
                </div>
              </div>

      </div><!--end of modal body -->
              <div class="modal-footer">
               <div class="col-sm-6 col-xs-12 col-sm-offset-6">
                <button type="button" class="btn btn-sm btn-flat btn-danger" data-dismiss="modal">Close</button>
                <button type="submit" class="btn btn-sm btn-flat btn-info" id="btnSubmit">Save</button>
              </div>
              </div>
          </form>
    </div>
  </div>
</div>

<script type="text/javascript">
   $('#modalFormMachine').on('hidden.bs.modal', function () {
      $('body').addClass('modal-open');
      $(this).find("#frmMachine").trigger('reset');//Reset form when modal hidden
      $(this).find("#frmMachine input:hidden").val('');
      $(this).find("input, select").parent('.col-sm-5').removeClass('has-error has-success');
      $(this).find("input").next().remove('em');
   });
   // Client-side edit form validation.
  $( document ).ready( function () {

      $( "#frmMachine" ).validate( {
        onkeyup: false,
        submitHandler: function (form) {
          var modalTitle = $('#modalFormMachine').find('h4.modal-title');
          var id = $("#hdnId").val();
            if(id == '' || id == null){
                 dtMachine.add();
                 $("#txtSerialNum").removeData("previousValue");//Clear cache of previous value in the 2nd time input of the remote call..
            }
            else {
              if($(modalTitle).data('update-opt') == '1'){ //Get the update option in form machine.
                  dtMachine.update();
              }else{
                 dtFilterMachine.update();
              }
                 var updated_sn = $("#txtSerialNum").val();
                 $("#hdnOldSerial").val(updated_sn);//Replicate the value with the updated.
            }
        },
        rules: {
          slctCompany: {
            required: true
          },
          txtSerialNum: {
            required: true,
            maxlength: 50,
            remote: {
                url: assets+'php/machine/machine.php',
                type: 'POST',
                cache: false,
                data: { 
                    action_exist: function(){ 
                         var id = $("#hdnId").val();
                         return (id == '' || id == null ? 'add' : 'update');
                    }, 
                    old_serial: function(){ return $("#hdnOldSerial").val(); },
                    action: 'check_exist'
                  }
            }
          },
          slctBrands: {
            required: true
          },
          txtPageCount: {
            numbersonly: true
          },
          txtBranch: {
            required: true
          }
        },
        messages: {
          slctCompany: {
            required: "This field is required."            
          },
          txtSerialNum: {
            required: "This field is required.",
            maxlength: "Please enter no more than {0} characters.",
            remote: jQuery.validator.format("{0} is already exist.")

          },
          slctBrands: {
            required: "This field is required."
          },
          txtPageCount: {
            numbersonly: "Please enter only numbers."
          },
          txtBranch: {
            required: "This field is required."
          }

           
        },
        errorElement: "em",
        errorPlacement: function ( error, element ) {
          // Add the `help-block` class to the error element
          error.addClass( "help-block" ).css('margin-top','0px');
          error.css({'font-size':'11px','margin-bottom':'0px'});

          if ( element.prop( "type" ) === "checkbox" ) {
            error.insertAfter( element.parent( "label" ) );
          } else {
            error.insertAfter( element );
          }
        },
        highlight: function ( element, errorClass, validClass ) {
          $( element ).parents( ".col-sm-5" ).addClass( "has-error" ).removeClass( "has-success" );
        },
        unhighlight: function (element, errorClass, validClass) {
          $( element ).parents( ".col-sm-5" ).addClass( "has-success" ).removeClass( "has-error" );
        }
      } );
  } );
                 
</script>